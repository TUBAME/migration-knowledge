<HTML xmlns:knowhow="http://generated.model.biz.knowhow.tubame/knowhow" xmlns:doc="http://docbook.org/ns/docbook">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Tomcat6.0.xから7.0.xへのマイグレーションガイド</title>
<link href="css/knowhow.css" type="text/css" rel="stylesheet">
<script type="text/javascript" src="js/prettify.js"></script>
<meta content="DocBook XSL Stylesheets V1.78.1" name="generator">
</HEAD>
<BODY>
<H1 class="title">Tomcat6.0.xから7.0.xへのマイグレーションガイド</H1>
<div class="toc">
<p>
<b>Index</b>
</p>
<dl class="toc">
<dt>
<span class="1."><a href="#tubame_1.">1.はじめに</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1."><a href="#tubame_1.1.">1.1.本ドキュメントについて</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1.1."><a href="#tubame_1.1.1.">1.1.1.Javaバージョンについて</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2."><a href="#tubame_1.1.2.">1.1.2.設定ファイルについて</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dt>
<span class="2."><a href="#tubame_2.">2.Java API 関連</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.1."><a href="#tubame_2.1.">2.1.Java6必須</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="3."><a href="#tubame_3.">3.Java6必須</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.1."><a href="#tubame_3.1.">3.1.Java6必須</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.2."><a href="#tubame_3.2.">3.2.非推奨API</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.2.1."><a href="#tubame_3.2.1.">3.2.1.Servlet非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.2.2."><a href="#tubame_3.2.2.">3.2.2.JSP非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.2.3."><a href="#tubame_3.2.3.">3.2.3.Servlet、JSP以外の非推奨API</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dt>
<span class="4."><a href="#tubame_4.">4.Servlet 3.0 API</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="4.1."><a href="#tubame_4.1.">4.1.Servlet 3.0 API</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="5."><a href="#tubame_5.">5.正規表現</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="5.1."><a href="#tubame_5.1.">5.1.正規表現</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="6."><a href="#tubame_6.">6.デプロイメント</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="6.1."><a href="#tubame_6.1.">6.1.デプロイメント</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="7."><a href="#tubame_7.">7.Managerアプリケーション</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="7.1."><a href="#tubame_7.1.">7.1.Managerアプリケーション</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="8."><a href="#tubame_8.">8.Host Managerアプリケーション</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="8.1."><a href="#tubame_8.1.">8.1.Host Managerアプリケーション</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="9."><a href="#tubame_9.">9.Session Managerコンフィグレーション</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="9.1."><a href="#tubame_9.1.">9.1.セッションマネージャコンフィグレーション</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="10."><a href="#tubame_10.">10.Session Cookieコンフィグレーション</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="10.1."><a href="#tubame_10.1.">10.1.Session Cookieコンフィグレーション</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="11."><a href="#tubame_11.">11.Cookies</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="11.1."><a href="#tubame_11.1.">11.1.Cookies</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="12."><a href="#tubame_12.">12.Request属性</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="12.1."><a href="#tubame_12.1.">12.1.Request属性</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="13."><a href="#tubame_13.">13.Comet</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="13.1."><a href="#tubame_13.1.">13.1.Comet</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="14."><a href="#tubame_14.">14.XMLバリデーション</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="14.1."><a href="#tubame_14.1.">14.1.XMLバリデーション</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="15."><a href="#tubame_15.">15.システムプロバティ</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="15.1."><a href="#tubame_15.1.">15.1.システムプロパティ</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="16."><a href="#tubame_16.">16.conf/web.xmlファイル処理</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="16.1."><a href="#tubame_16.1.">16.1.conf/web.xmlファイル処理</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="17."><a href="#tubame_17.">17.Welcomeファイル処理</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="17.1."><a href="#tubame_17.1.">17.1.Welcomeファイル処理</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="18."><a href="#tubame_18.">18.アノテーション・スキャン</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="18.1."><a href="#tubame_18.1.">18.1.アノテーション・スキャン</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="19."><a href="#tubame_19.">19.TLD処理</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="19.1."><a href="#tubame_19.1.">19.1.TLD処理</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="20."><a href="#tubame_20.">20.内部API</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="20.1."><a href="#tubame_20.1.">20.1.内部API</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="21."><a href="#tubame_21.">21.JSPコンパイラ</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="21.1."><a href="#tubame_21.1.">21.1.JSPコンパイラ</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="22."><a href="#tubame_22.">22.その他注意点</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="22.1."><a href="#tubame_22.1.">22.1.コネクタとスレッドプール</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.2."><a href="#tubame_22.2.">22.2.アクセスログ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.3."><a href="#tubame_22.3.">22.3.レルム</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.4."><a href="#tubame_22.4.">22.4.セッションの最終アクセス時間</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.5."><a href="#tubame_22.5.">22.5.ライフサイクルリスナ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.6."><a href="#tubame_22.6.">22.6.クラスタ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.7."><a href="#tubame_22.7.">22.7.Valve</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.8."><a href="#tubame_22.8.">22.8.スレッドローカル削除</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="22.9."><a href="#tubame_22.9.">22.9.クラスローダの優先順位</a></span>
</dt>
</dl>
</dd>
</dl>
</div>
<HR>
<a name="tubame_1."></a>
<h2 class="title">1.はじめに</h2>
<br>
<a name="tubame_1.1." id="category_43"></a>
<h3 class="title">1.1.本ドキュメントについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>本マイグレーションガイドはTomcat間（6.0-7.0）のマイグレーション時に注意すべき項目について整理したものである。</p>
<p>本内容はTomcatコミュニティのMigration Guideの情報を参考に作成している。</p>
<p>
            
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/migration.html" target="_top">http://tomcat.apache.org/migration.html</a></strong></span>
        
</p>
<p>
            
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/migration-7.html" target="_top">http://tomcat.apache.org/migration-7.html</a></strong></span>
        
</p>
</div>
<br>
<br>
<a name="tubame_1.1.1." id="category_44"></a>
<h3 class="title">1.1.1.Javaバージョンについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Apache Tomcatのあるメジャーバージョンから新しいバージョンのものへアップデートをするとき、システムにインストールされているJVMが必要なJavaバージョンをサポートしていることを確認する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2." id="category_45"></a>
<h3 class="title">1.1.2.設定ファイルについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Apache Tomcatのあるメジャーバージョンから他のバージョンへマイグレーション（例：Tomcat
			6からTomcat 7）するとき、古いバージョンの設定ファイルをむやみにコピーすべきではありません。</p>
<p>推奨されているアプローチはApache
			Tomcatの新しいバージョンのデフォルト設定ファイルを必要に応じて修正する方法である。</p>
<p></p>
<p>本ドキュメントでは対象外であるが、同じメジャーバージョン内であるマイナーバージョンから別のマイナーバージョンへマイグレーション（例；Tomcat 6.0.41からTomcat 6.0.43）するとき、設定ファイルは再利用することが可能である。</p>
<p>しかし、デフォルト値が変更されていないか、また、新たな要素が追加されていないかを確認するべきである。</p>
<p>確認結果に応じて設定ファイルを修正するべきである。</p>
</div>
<br>
<br>
<a name="tubame_2."></a>
<h2 class="title">2.Java API 関連</h2>
<br>
<a name="tubame_2.1." id="category_13"></a>
<h3 class="title">2.1.Java6必須</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0は、実行環境としてJava6以降が必須となる。</p>
<p>古いバージョンのJavaを利用している場合はアップデートを行う必要がある。</p>
</div>
<br>
<br>
<a name="tubame_3."></a>
<h2 class="title">3.Java6必須</h2>
<br>
<a name="tubame_3.1." id="category_13"></a>
<h3 class="title">3.1.Java6必須</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0は、実行環境としてJava6以降が必須となる。</p>
<p>古いバージョンのJavaを利用している場合はアップデートを行う必要がある。</p>
</div>
<br>
<br>
<a name="tubame_3.2." id="category_9"></a>
<h3 class="title">3.2.非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0は、Servlet
			3.0、JSP2.2およびEL2.2仕様をサポートしている。</p>
<p>
			
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/whichversion.html" target="_top">http://tomcat.apache.org/whichversion.html
			</a></strong></span>
		
</p>
<p>これらの仕様で非推奨となったAPIを利用している場合は代替APIを利用するように変更する必要がある。
		</p>
</div>
<br>
<br>
<a name="tubame_3.2.1." id="category_10"></a>
<h3 class="title">3.2.1.Servlet非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0は、Servlet3.0仕様をサポートしている。</p>
<p>以下は、Servlet3.0で非推奨となったAPIの一覧であり、これらのAPIを利用している場合には、代替となるAPIを利用するように修正する必要がある。
		</p>
<p>推奨されていないインタフェース</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.http.HttpSessionContext</p>
</li>
<li class="listitem">
<p>javax.servlet.SingleThreadModel</p>
</li>
</ul>
</div>
<p>推奨されていないクラス</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.http.HttpUtils</p>
</li>
</ul>
</div>
<p>推奨されていないメソッド</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.http.HttpServletRequest.isRequestedSessionIdFromUrl()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletRequestWrapper.isRequestedSessionIdFromUrl()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponse.encodeRedirectUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponse.encodeUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponse.setStatus(int,
					String)</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponseWrapper.encodeRedirectUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponseWrapper.encodeUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponseWrapper.setStatus(int,
					String)</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.getSessionContext()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.getValue(String)</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.getValueNames()</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.putValue(String, Object)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.removeValue(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSessionContext.getIds()</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSessionContext.getSession(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.getServlet(String)</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.getServletNames()</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.getServlets()</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.log(Exception, String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletRequest.getRealPath(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletRequestWrapper.getRealPath(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.UnavailableException.getServlet()</p>
</li>
</ul>
</div>
<p>推奨されていないコンストラクタ</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.UnavailableException(int, Servlet, String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.UnavailableException(Servlet, String)
				</p>
</li>
</ul>
</div>
<p>詳細は下記URLを参照のこと。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html
					</a></strong></span>
				
</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_3.2.2." id="category_11"></a>
<h3 class="title">3.2.2.JSP非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0は、JSP2.2仕様をサポートしている。</p>
<p>以下は、JSP2.2で非推奨となったAPIの一覧であり、これらAPIを利用している場合には、代替となるAPIを利用するように修正する必要がある。
		</p>
<p>推奨されていないインタフェース</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.jsp.el.FunctionMapper</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.VariableResolver</p>
</li>
</ul>
</div>
<p>推奨されていないクラス</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.jsp.el.Expression</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.ExpressionEvaluator</p>
</li>
</ul>
</div>
<p>推奨されていない例外</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.jsp.el.ELException</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.ELParseException</p>
</li>
</ul>
</div>
<p>推奨されていないフィールド</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_TAG</p>
</li>
</ul>
</div>
<p>推奨されていないメソッド</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.jsp.JspContext.getExpressionEvaluator()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.JspContext.getVariableResolver()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.JspContext.getRootCause()</p>
</li>
</ul>
</div>
<p>詳細は下記URLを参照のこと。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html
					</a></strong></span>
				
</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_3.2.3." id="category_12"></a>
<h3 class="title">3.2.3.Servlet、JSP以外の非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet、JSP以外にも、非推奨となっているAPIを利用している場合は、代替となるAPIを利用するように修正する必要がある。
		</p>
<p>詳細は下記URLを参照のこと。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html</a></strong></span>
				
</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_4."></a>
<h2 class="title">4.Servlet 3.0 API</h2>
<br>
<a name="tubame_4.1." id="category_14"></a>
<h3 class="title">4.1.Servlet 3.0 API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>ワイルドカード (*) のimport構文を使用するJSPページでは、Servlet APIに追加された新しいクラスとWebアプリケーションに含まれるクラスが競合する可能性がある。</p>
<p>例えば、パッケージ「a」にPartクラスが含まれている場合、以下のJSPページはTomcat7でコンパイルできなくなる。</p>
<pre class="programlisting">

&lt;%@page import="a.*"%&gt;
&lt;% Part page = new Part(); %&gt;

		</pre>
<p>これは、javax.servlet.http.*の暗黙的なimportとa.*の明示的なimportにおいて、Servlet3.0で追加されたPartクラスの定義が競合するために発生する問題である。</p>
<p>Tomcatは、JSPからServletファイル（.java）へのコンパイルの際、デフォルトのimportとして javax.servlet.*、javax.servlet.http.*、javax.servlet.jsp.* を設定するため、JSPにおいてワイルドカードのimport文を使用すると、Servlet3.0で追加されたクラスと衝突してしまう。</p>
<p>この問題を解決するには、明示的なimport（この例では、import="a.Part"）を利用する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_5."></a>
<h2 class="title">5.正規表現</h2>
<br>
<a name="tubame_5.1." id="category_15"></a>
<h3 class="title">5.1.正規表現</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>正規表現を使用するすべての設定オプションは、コンマあるいはセミコロン区切りのリストではなく、単一の正規表現（java.util.regex
			を利用）を用いて指定する必要がある。
		</p>
<p>以下の属性が関係するため、正規表現を見直す必要がある。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#Remote_Address_Filter" target="_top">RemoteAddrFilter</a></strong></span>
					、
					<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#Remote_Host_Filter" target="_top">RemoteHostFilter</a></strong></span>
					と
					<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html#Remote_Address_Filter" target="_top">RemoteAddrValve</a></strong></span>
					、
					<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html#Remote_Host_Filter" target="_top">RemoteHostValve</a></strong></span>
					のallow属性とdeny属性
				</p>
</li>
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#Remote_IP_Filter" target="_top">RemoteIpFilter</a></strong></span>
					、
					<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html#Remote_IP_Valvel" target="_top">RemoteIpValve</a></strong></span>
					のinternalProxies属性とtrustedProxies属性
				</p>
</li>
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/cluster-valve.html#org.apache.catalina.ha.tcp.ReplicationValve" target="_top">ReplicationValve</a></strong></span>
					のfilter属性
				</p>
</li>
<li class="listitem">
<p>
					
<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_top">HTTP Connector</a></strong></span>
					のrestrictedUserAgents属性とnoCompressionUserAgents属性
				</p>
</li>
</ul>
</div>
<p>また、「|」演算子を用いて、個別の正規表現を連結することが可能である。</p>
</div>
<br>
<br>
<a name="tubame_6."></a>
<h2 class="title">6.デプロイメント</h2>
<br>
<a name="tubame_6.1." id="category_16"></a>
<h3 class="title">6.1.デプロイメント</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
        Tomcat7において、Hostに追加されたxmlBase属性、copyXML属性によって、デフォルトの動作が変更されたので注意が必要となる。
        </p>
<p>xmlBase属性によって、Hostのコンフィグレーションファイルの配置場所が変更可能になった。デフォルトは未設定で、Tomcat6と同様「$CATALINA_BASE/conf/Engine名/Host名」となる。</p>
<p>copyXML属性によって、 META-INF/context.xml をxmlBaseにコピーするかどうかを決定する。デフォルトはfalseで、デプロイしたWARファイルやディレクトリからcontext.xmlはコピーされない。</p>
<p>したがって、Tomcat6 &rarr; Tomcat7へのバージョンアップで、META-INF/context.xmlの取扱いが変更されたこととなる。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Tomcat6では、META-INF/context.xmlを$CATALINA_BASE/conf/Engine名/Host名に&lt; コンテキスト名&gt;.xmlとしてコピーする。リデプロイのチェック対象は、&lt; コンテキスト名&gt;.xmlとなる。</p>
</li>
<li class="listitem">
<p>Tomcat7では、META-INF/context.xmlをパースだけしコピーはしない。リデプロイのチェック対象は、META-INF/context.xmlとなる。copyXMLがtrueの場合にのみxmlBaseへcontext.xmlをコピーする。</p>
</li>
</ul>
</div>
<p>Tomcat6のデフォルトの振る舞いに戻したい場合は、HostのcopyXML属性をtrueに変更する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_7."></a>
<h2 class="title">7.Managerアプリケーション</h2>
<br>
<a name="tubame_7.1." id="category_40"></a>
<h3 class="title">7.1.Managerアプリケーション</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Managerアプリケーションは、Tomcat7以降では再構成されており、いくつかのURLが変更されている。Managerアプリケーションへのアクセスに使用されるすべてのURLは、次のオプションのいずれかで始まる必要がある。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>&lt;ContextPath&gt;/html（HTML GUI）</p>
</li>
<li class="listitem">
<p>&lt;ContextPath&gt;/text（テキストインタフェース）</p>
</li>
<li class="listitem">
<p>&lt;ContextPath&gt;/jmxproxy（JMXプロキシ）</p>
</li>
<li class="listitem">
<p>&lt;ContextPath&gt;/status（statusページ）</p>
</li>
</ul>
</div>
<p>特に、テキストインタフェースのURLが、&lt;ContextPath&gt;/textに変更されていることに注意すること。</p>
<p>Managerアプリケーションを利用するために必要なロールは、単一のmanagerロールから次の4つのロールに変更され、アクセスしたい機能に必要なロールを割り当てる必要がある。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>manager-gui：HTML GUIとstatusページへのアクセスを許可</p>
</li>
<li class="listitem">
<p>manager-script：テキストインタフェースとstatusページへのアクセスを許可</p>
</li>
<li class="listitem">
<p>manager-jmx：JMXプロキシとstatusページへのアクセスを許可</p>
</li>
<li class="listitem">
<p>manager-status：statusページへのアクセスのみ許可</p>
</li>
</ul>
</div>
<p>HTMLインタフェースは、CSRF（Cross Site Request Forgeries）に対して保護されているが、テキストインタフェースとJMXインタフェースは保護されていない。</p>
<p>CSRFに対して保護するために、以下を確認すること。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>manager-guiロールが付与されているユーザには、manager-scriptあるいはmanager-jmxロールを付与しない</p>
</li>
<li class="listitem">
<p>Managerアプリケーションがmanager-scriptあるいはmanager-jmxロールが付与されているユーザからブラウザでアクセスされた場合には、
                セッションを終了させるために後でブラウザの全てのウィンドウを閉じる必要がある。</p>
</li>
</ul>
</div>
<p>rolesコマンドは、デフォルト設定では動作しないことと、ほとんどのレルムがロールリストのサポートをしていないため、Managerアプリケーションから削除された。HTMLインタフェースは、CSRF（Cross Site Request Forgeries）に対して保護されているが、テキストインタフェースとJMXインタフェースは保護されていない。</p>
</div>
<br>
<br>
<a name="tubame_8."></a>
<h2 class="title">8.Host Managerアプリケーション</h2>
<br>
<a name="tubame_8.1." id="category_17"></a>
<h3 class="title">8.1.Host Managerアプリケーション</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Host Managerアプリケーションは、Tomcat7以降では再構成されており、いくつかのURLが変更されている。Host Managerアプリケーションへのアクセスに使用されるすべてのURLは、次のオプションのいずれかで始まる必要がある。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>&lt;ContextPath&gt;/html（HTML GUI）</p>
</li>
<li class="listitem">
<p>&lt;ContextPath&gt;/text（テキストインタフェース）</p>
</li>
</ul>
</div>
<p>特に、テキストインタフェースのURLが、&lt;ContextPath&gt;/textに変更されていることに注意すること。</p>
<p>Host Managerアプリケーションを利用するために必要なロールが、単一のadminロールから次の2つのロールに変更され、アクセスしたい機能に必要なロールを割り当てる必要がある。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>admin-gui：HTML GUIとstatusページへのアクセスを許可</p>
</li>
<li class="listitem">
<p>admin-script：テキストインタフェースとstatusページへのアクセスを許可</p>
</li>
</ul>
</div>
<p>HTMLインタフェースは、CSRFに対して保護されているが、テキストインタフェースは保護されていない。</p>
<p>CSRFに対して保護するために、以下を確認すること。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>admin-guiロールが付与されているユーザには、admin-scriptロールを付与しない</p>
</li>
<li class="listitem">
<p>Host Managerアプリケーションがadmin-scriptロールが付与されているユーザからブラウザでアクセスされた場合には、
                セッションを終了させるために後でブラウザの全てのウィンドウを閉じる必要がある。</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_9."></a>
<h2 class="title">9.Session Managerコンフィグレーション</h2>
<br>
<a name="tubame_9.1." id="category_18"></a>
<h3 class="title">9.1.セッションマネージャコンフィグレーション</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>セッションの生成や破棄のパフォーマンスを改善するために、セッションID作成に対する変更など、セッションマネージャに対して多くの変更が実施された。</p>
<p>コンフィグレーションの変更点は、以下のとおり。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>ManagerのrandomClass属性は、secureRandomClassに変更。提供されるクラスは、java.secure.SecureRandomを拡張する必要がある</p>
</li>
<li class="listitem">
<p>追加されたsecureRandomAlgorithm属性とsecureRandomProvider属性は、SecureRandom実装の選択を可能とする</p>
</li>
<li class="listitem">
<p>algorithm属性、entropy属性は削除</p>
</li>
</ul>
</div>
<p>セッションID作成処理が大幅に変更となったため、旧バージョンとの互換性がなくなり、上記設定を行っているユーザは、設定ファイルの変更が必須となる。</p>
</div>
<br>
<br>
<a name="tubame_10."></a>
<h2 class="title">10.Session Cookieコンフィグレーション</h2>
<br>
<a name="tubame_10.1." id="category_19"></a>
<h3 class="title">10.1.Session Cookieコンフィグレーション</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet 3.0仕様におけるSessionCookieConfigの追加により、コンフィグレーションおよびコードの複雑さを軽減するために、いくつかのSession Cookie設定オプションは削除された。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>ConnectorのemptySessionPath：本属性は削除された。$CATALINA_BASE/conf/context.xmlにおいて、sessionCookiePath="/"を設定することによって、同等の結果を得ることが可能</p>
</li>
<li class="listitem">
<p>org.apache.catalina.SESSION_COOKIE_NAME システムプロパティ：本プロパティは削除された。$CATALINA_BASE/conf/context.xmlにおいて、sessionCookieName属性を設定することによって、同等の結果を得ることが可能</p>
</li>
<li class="listitem">
<p>org.apache.catalina.SESSION_PARAMETER_NAME システムプロパティ：本プロパティは削除された。$CATALINA_BASE/conf/context.xmlにおいて、sessionCookieName属性を設定することによって、同等の結果を得ることが可能</p>
</li>
<li class="listitem">
<p>ContextのdisableURLRewriting：本属性は削除された。Webアプリケーションあるいは$CATALINA_BASE/conf/web.xmlにおいて、&lt;session-config&gt;&lt;tracking-mode&gt; 要素を設定することによって、同等の結果を得ることが可能</p>
</li>
</ul>
</div>
<p>Tomcat7のセッションおよびSSO Cookieは、JavaScriptからのアクセスを防ぐために、デフォルトでHttpOnlyフラグで送信されてくる。この機能は、Context要素のuseHttpOnly属性によって制御することができる（この機能は、Tomcat6.0の最新バージョンでは、デフォルトでオフとなっているため、有効にするには、Web アプリケーションあるいは$CATALINA_BASE/conf/context.xml のContext 要素のuseHttpOnly 属性にtrueを設定すればよい）。</p>
</div>
<br>
<br>
<a name="tubame_11."></a>
<h2 class="title">11.Cookies</h2>
<br>
<a name="tubame_11.1." id="category_20"></a>
<h3 class="title">11.1.Cookies</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat は仕様に準拠していない名前だけ（値のない）のCookie をデフォルトで許容しない。</p>
<p>ただし、新たなシステムプロパティ「org.apache.tomcat.util.http.ServerCookie.ALLOW_NAME_ONLY」が追加され、名前だけのCookie を許容するように利用できる。</p>
</div>
<br>
<br>
<a name="tubame_12."></a>
<h2 class="title">12.Request属性</h2>
<br>
<a name="tubame_12.1." id="category_21"></a>
<h3 class="title">12.1.Request属性</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet仕様において、標準Request属性javax.servlet.request.ssl_session_idが新しく定義されたため、SSLセッションIDにアクセスするために提供されているカスタムRequest属性javax.servlet.request.ssl_sessionは廃止となった。</p>
<p>このカスタム属性は、Tomcat8で削除されている。</p>
</div>
<br>
<br>
<a name="tubame_13."></a>
<h2 class="title">13.Comet</h2>
<br>
<a name="tubame_13.1." id="category_22"></a>
<h3 class="title">13.1.Comet</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>セキュリティマネージャの下で、Cometが正しく動作することを可能にするために、Cometのクラスは、org.apache.catalinaパッケージからorg.apache.catalina.cometパッケージに移動された。</p>
<p>Cometを使用するコードは更新し、新しいパッケージ名を反映するように再コンパイルする必要がある。</p>
</div>
<br>
<br>
<a name="tubame_14."></a>
<h2 class="title">14.XMLバリデーション</h2>
<br>
<a name="tubame_14.1." id="category_23"></a>
<h3 class="title">14.1.XMLバリデーション</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>XMLバリデーションの構成が簡素化され、xmlValidationとxmlNamespaceAware属性は、Host要素から削除された。</p>
<p>これらの属性は、tldValidationとtldNamespaceAware属性とともに、Context要素ごとに設定される。デフォルト値は、各属性とも変更されておらず、falseである。</p>
</div>
<br>
<br>
<a name="tubame_15."></a>
<h2 class="title">15.システムプロバティ</h2>
<br>
<a name="tubame_15.1." id="category_24"></a>
<h3 class="title">15.1.システムプロパティ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat6.0では、org.apache.catalina.STRICT_SERVLET_COMPLIANCEシステムプロパティによって、統一的に仕様制約を制御していた。
        ただし、それでは柔軟な設定ができないということで、Tomcat7.0では、org.apache.catalina.STRICT_SERVLET_COMPLIANCEシステムプロパティで
        デフォルト値を設定し、仕様制約ごとのシステムプロパティや設定で上書きできるように変更された。</p>
<p>Tomcat7.0で、org.apache.catalina.STRICT_SERVLET_COMPLIANCEシステムプロパティがデフォルトを設定する制約は、以下のとおり。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.apache.catalina.core.ApplicationContext.GET_RESOURCE_REQUIRE_SLASH</p>
</li>
<li class="listitem">
<p>org.apache.catalina.core.ApplicationDispatcher.WRAP_SAME_OBJECT</p>
</li>
<li class="listitem">
<p>org.apache.catalina.core.StandardHostValve.ACCESS_SESSION</p>
</li>
<li class="listitem">
<p>org.apache.catalina.session.StandardSession.ACTIVITY_CHECK</p>
</li>
<li class="listitem">
<p>org.apache.catalina.session.StandardSession.LAST_ACCESS_AT_START</p>
</li>
<li class="listitem">
<p>org.apache.tomcat.util.http.ServerCookie.ALWAYS_ADD_EXPIRES</p>
</li>
<li class="listitem">
<p>org.apache.tomcat.util.http.ServerCookie.FWD_SLASH_OS_SEPARATOR</p>
</li>
<li class="listitem">
<p>org.apache.tomcat.util.http.ServerCookie.STRICT_NAMING</p>
</li>
<li class="listitem">
<p>Context要素のresourceOnlyServlets属性</p>
</li>
<li class="listitem">
<p>Context要素のtldNamespaceAware属性</p>
</li>
<li class="listitem">
<p>Context要素のtldValidation属性</p>
</li>
<li class="listitem">
<p>Context要素のxmlNamespaceAware属性</p>
</li>
<li class="listitem">
<p>Context要素のxmlValidation属性</p>
</li>
</ul>
</div>
<p>org.apache.coyote.MAX_TRAILER_SIZEシステムプロパティは削除され、Connector要素のmaxTrailerSize属性によって置き換えられる。</p>
</div>
<br>
<br>
<a name="tubame_16."></a>
<h2 class="title">16.conf/web.xmlファイル処理</h2>
<br>
<a name="tubame_16.1." id="category_25"></a>
<h3 class="title">16.1.conf/web.xmlファイル処理</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet3.0仕様では、web fragmentおよびアノテーションからどのようにアプリケーションのweb.xmlファイルを組合わせることができるかを定義する。</p>
<p>それらの規則を実装した結果、サーバ全体に渡るデフォルトを定義するグローバルなconf/web.xmlファイルの処理は変更された。</p>
<p>ひとつ顕著な違いとしては、conf/web.xmlに定義されているFilterではなく、Webアプリケーションに定義されているものに従うといったものである。</p>
</div>
<br>
<br>
<a name="tubame_17."></a>
<h2 class="title">17.Welcomeファイル処理</h2>
<br>
<a name="tubame_17.1." id="category_26"></a>
<h3 class="title">17.1.Welcomeファイル処理</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet3.0仕様において、welcomeファイルに対する処理が変更され、Context要素のresourceOnlyServlets属性が追加された。</p>
</div>
<br>
<br>
<a name="tubame_18."></a>
<h2 class="title">18.アノテーション・スキャン</h2>
<br>
<a name="tubame_18.1." id="category_28"></a>
<h3 class="title">18.1.アノテーション・スキャン</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet3.0仕様にて必要となるアノテーション・スキャンは、Webアプリケーションの起動時間に影響を与えるだけでなく、スキャンされるクラスをロードするために多くのメモリ容量が必要となる可能性がある。</p>
<p>この問題に対する対処策はいくつか存在する。</p>
<p>1つ目の推奨方法は、WebアプリケーションのWEB-INF/web.xmlにおいて次の手順を実施することにより、アノテーション・スキャンを必要としないアプリケーションをマークすることである。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>WebアプリケーションがServlet 3.0仕様を使用していることを示すために、web-app要素を更新する。内容はデフォルトのconf/web.xmlからversion、xsi:schemaLocation、xmlns、xmlns:xsi属性の値をコピーできる。</p>
</li>
<li class="listitem">
<p>web-app要素に、属性metadata-complete="true"を追加する。</p>
</li>
<li class="listitem">
<p>空の&lt;absolute-ordering /&gt;要素を追加する。</p>
</li>
</ul>
</div>
<p>2つ目の推奨方法は、特定のJARファイルを無視するように、JarScannerコンポーネントを設定することである。通常、<span class="command"><strong><a class="command" href="http://tomcat.apache.org/tomcat-7.0-doc/config/systemprops.html#JAR_Scanning" target="_top">tomcat.util.scan.DefaultJarScanner.jarsToSkipシステムプロパティ</a></strong></span> は、conf/catalina.propertiesファイルに設定する。</p>
</div>
<br>
<br>
<a name="tubame_19."></a>
<h2 class="title">19.TLD処理</h2>
<br>
<a name="tubame_19.1." id="category_29"></a>
<h3 class="title">19.1.TLD処理</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0 ではTLD 処理のためのいくつかの改善が行われている。一貫性の改善や重複の排除のためのリファクタリングに加えて、いくつかの機能改善が行われている。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>タグファイルに含まれるEL 処理は、タグファイルに宣言されたJSP バージョンと矛盾しない。</p>
</li>
<li class="listitem">
<p>TLDファイルをWEB-INF/libあるいはWEB-INF/classesディレクトリに配置することは許可されていない。</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_20."></a>
<h2 class="title">20.内部API</h2>
<br>
<a name="tubame_20.1." id="category_30"></a>
<h3 class="title">20.1.内部API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7の内部APIが、Tomcat6と広く互換性をもっている一方、詳細レベルに多くの変更がありバイナリ互換ではない。</p>
<p>Tomcat内部APIを利用しているカスタムコンポーネントについては、関連するAPIのJavaDocを確認する必要がある。特に注目すべき点は以下のとおり。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>すべてのコンポーネントが拡張するLifecycleインタフェースの標準実装のリファクタリング。Lifecycle インタフェースをコンテナのほとんどのコンポーネントが実装することで、ライフサイクル（初期化、起動、停止、削除、定期イベントなど）を共通処理として実装するようにリファクタリングした。Tomcat6 とは全くの別物と考えた方が良いと思われる。</p>
</li>
<li class="listitem">
<p>Generics の利用</p>
</li>
<li class="listitem">
<p>Host 内のContext のためのユニークな識別子として、Context パスではなく、Context 名を利用。パラレルデプロイメントの実装によって、1 つのコンテキストパスに対して複数のコンテキストが持てるようになったため、名前で識別するようになった。したがって、TomcatのAPI を利用してアプリを開発している利用者（Context やManager を継承して独自実装を組み込んでいる、カスタムValve などを作成しているなど）は、互換性がないので注意が必要である。</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_21."></a>
<h2 class="title">21.JSPコンパイラ</h2>
<br>
<a name="tubame_21.1." id="category_31"></a>
<h3 class="title">21.1.JSPコンパイラ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JspServletの初期化パラメータが、genStrAsCharArrayからgenStringAsCharArrayに変更された。</p>
</div>
<br>
<br>
<a name="tubame_22."></a>
<h2 class="title">22.その他注意点</h2>
<br>
<a name="tubame_22.1." id="category_32"></a>
<h3 class="title">22.1.コネクタとスレッドプール</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>今まで統一されていなかったコネクタの実装をリファクタリングにより統一された実装とした。また、独自のスレッドプールの実装からjava標準のExecutorベースのスレッドプールに変更された。</p>
<p>その結果、以下のような変更があり注意が必要である。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>コネクタの設定からmaxSpareThreads属性が削除された</p>
</li>
<li class="listitem">
<p>スレッドプールを参照するためのObjectNameも変更された</p>
<p>具体的には、Tomcat7からnameが(ajp/http)-(bio/nio/apr)+encodedAddr+endpoint.getPort()となった</p>
</li>
<li class="listitem">
<p>各コネクタでLogfullメッセージも出力されない</p>
</li>
<li class="listitem">
<p>AJPコネクタは、registerRequests属性が無効となった</p>
</li>
</ul>
</div>
<p>また、特にjk系のパッケージは全て削除されたため、今までのJKコネクタとはまったく異なる実装となっており、以前のノウハウは利用できないものが多くなった。</p>
</div>
<br>
<br>
<a name="tubame_22.2." id="category_33"></a>
<h3 class="title">22.2.アクセスログ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>デフォルトで無効から有効に変更され、ログのフォーマットもcommonから "%h %l %u %t &amp;quot;%r&amp;quot; %s %b" に変更された。</p>
</div>
<br>
<br>
<a name="tubame_22.3." id="category_34"></a>
<h3 class="title">22.3.レルム</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0では、デフォルトで、LockOutRealmが有効に設定されているため、認証失敗の回数に制限がかかる。</p>
</div>
<br>
<br>
<a name="tubame_22.4." id="category_35"></a>
<h3 class="title">22.4.セッションの最終アクセス時間</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>LAST_ACCESS_AT_STARTシステムプロパティの追加により、セッションの最終アクセス時間とアイドル時間の算出方法が変更となった。</p>
<p>LAST_ACCESS_AT_START がtrue なら、最終アクセス時間の値は前のリクエストの開始から計算される。アイドル時間の基準値が最終アクセス時間になる。LAST_ACCESS_AT_START がfalse なら、最終アクセス時間の値は前のリクエストの終了から計算される。アイドル時間の基準値は現在のアクセス時間（6.0 と同様）のままとなる。</p>
<p>セッションタイムアウトをチェックするためのセッションアイドル時間は、LAST_ACCESS_AT_STARTの値を元に決定される。</p>
<div class="table">
<a name="N12B18"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;LAST_ACCESS_AT_STARTによる動作の違い</b>
</p>
<div class="table-contents">
<table summary="LAST_ACCESS_AT_STARTによる動作の違い" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td>&nbsp;</td><td>LAST_ACCESS_AT_START=true</td><td>LAST_ACCESS_AT_START=false</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>セッションアクセス時</td><td>thisAccessTimeにカレントタイムを設定</td><td>thisAccessTimeにカレントタイムを設定</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>セッションアクセス終了時</td><td>lastAccessTimeにthisAcccessTimeを設定し、thisAccessTimeにカレントタイムを設定</td><td>lastAccessTimeとthisAccessTimeにカレントタイムを設定</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>セッションアイドル時間の算出</td><td>lastAccessTimeからの経過時間</td><td>thisAccessTimeからの経過時間</td><td class="auto-generated">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_22.5." id="category_36"></a>
<h3 class="title">22.5.ライフサイクルリスナ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>org.apache.catalina.mbeans.ServerLifecycleListenerが、ライフサイクルのリファクタリングによって不要となったため、削除された。</p>
<p>Tomcat6.0では、デフォルトでserver.xmlに設定されているため、server.xmlをそのまま利用することができない。</p>
</div>
<br>
<br>
<a name="tubame_22.6." id="category_37"></a>
<h3 class="title">22.6.クラスタ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>BackupManagerが返却するアクティブなセッションの数が変更され、Tomcat6.0ではプライマリセッションのみであったが、Tomcat7.0からはプライマリ＋バックアップセッションとなった。</p>
</div>
<br>
<br>
<a name="tubame_22.7." id="category_38"></a>
<h3 class="title">22.7.Valve</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>RequestDumperValveとWebdavFixValveは削除され、代わりにorg.apache.catalina.filtersパッケージのFilterとして実装された。。Filter なので設定ファイルもserver.xml（context.xml）からweb.xmlに変更となる。</p>
<p>また、FastCommonAccessLogValveが削除された。</p>
</div>
<br>
<br>
<a name="tubame_22.8." id="category_39"></a>
<h3 class="title">22.8.スレッドローカル削除</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>clearReferencesThreadLocals属性（デフォルト：false）が削除され、org.apache.catalina.core.ThreadLocalLeakPreventionListenerが追加された。</p>
</div>
<br>
<br>
<a name="tubame_22.9." id="category_41"></a>
<h3 class="title">22.9.クラスローダの優先順位</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Tomcat7.0.51 以降、Web アプリケーションクラスローダによるクラスローディングはSystem クラス
ローダより優先されます。</p>
</div>
<br>
<br>
</BODY>
</HTML>
