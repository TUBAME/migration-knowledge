<HTML xmlns:knowhow="http://generated.model.biz.knowhow.tubame/knowhow" xmlns:doc="http://docbook.org/ns/docbook">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JBossEAP4.3からJBossEAP6へのマイグレーションガイド</title>
<link href="css/knowhow.css" type="text/css" rel="stylesheet">
<meta content="DocBook XSL Stylesheets V1.78.1" name="generator">
</HEAD>
<BODY>
<H1 class="title">JBossEAP4.3からJBossEAP6へのマイグレーションガイド</H1>
<div class="toc">
<p>
<b>Index</b>
</p>
<dl class="toc">
<dt>
<span class="1."><a href="#tubame_1.">1.はじめに</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1."><a href="#tubame_1.1.">1.1.本ガイドについて</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2."><a href="#tubame_1.2.">1.2.JBoss概要</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.3."><a href="#tubame_1.3.">1.3.JavaEE仕様について</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="2."><a href="#tubame_2.">2.サーバ設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.1."><a href="#tubame_2.1.">2.1.JDBCドライバ移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2."><a href="#tubame_2.2.">2.2.データソース移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.1."><a href="#tubame_2.2.1.">2.2.1.データソース(no-tx-datasource)の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.1.1."><a href="#tubame_2.2.1.1.">2.2.1.1.データソース(no-tx-datasource)の属性値移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.2."><a href="#tubame_2.2.2.">2.2.2.データソース(local-tx-datasource)の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.2.1."><a href="#tubame_2.2.2.1.">2.2.2.1.データソース(local-tx-datasource)の属性値移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.3."><a href="#tubame_2.2.3.">2.2.3.データソース(xa-datasource)の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.3.1."><a href="#tubame_2.2.3.1.">2.2.3.1.XAデータソース(xa-datasource)の属性値移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.4."><a href="#tubame_2.2.4.">2.2.4.HAデータソース設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.4.1."><a href="#tubame_2.2.4.1.">2.2.4.1.HAデータソース(ha-local-tx-datasource)移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.4.2."><a href="#tubame_2.2.4.2.">2.2.4.2.HAデータソース(ha-xa-datasource)移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3."><a href="#tubame_2.3.">2.3.JBossWebコンテナ設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.1."><a href="#tubame_2.3.1.">2.3.1.HTTPコネクタの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.2."><a href="#tubame_2.3.2.">2.3.2.AJPコネクタ移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.3."><a href="#tubame_2.3.3.">2.3.3.HTTP/AJPコネクタの属性値移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.4."><a href="#tubame_2.3.4.">2.3.4.Valve移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.4.1."><a href="#tubame_2.3.4.1.">2.3.4.1.JBoss独自のValve移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.4.2."><a href="#tubame_2.3.4.2.">2.3.4.2.JBoss独自(Catalina)のValve移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.5."><a href="#tubame_2.3.5.">2.3.5.Realm移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.5.1."><a href="#tubame_2.3.5.1.">2.3.5.1.JBoss独自のRealm移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.5.2."><a href="#tubame_2.3.5.2.">2.3.5.2.JBoss独自(Catalina)のRealm移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.6."><a href="#tubame_2.3.6.">2.3.6.Context設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.6.1."><a href="#tubame_2.3.6.1.">2.3.6.1.ContextのdocBase移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4."><a href="#tubame_2.4.">2.4.JBossWebデプロイヤー設定移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5."><a href="#tubame_2.5.">2.5.JBossWebクラスタ設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.5.1."><a href="#tubame_2.5.1.">2.5.1.JGroups設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.5.1.1."><a href="#tubame_2.5.1.1.">2.5.1.1.JGroupsプロトコルスタックの設定移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5.1.2."><a href="#tubame_2.5.1.2.">2.5.1.2.JGroupsのFC設定</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5.2."><a href="#tubame_2.5.2.">2.5.2.レプリケーション設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.5.2.1."><a href="#tubame_2.5.2.1.">2.5.2.1.レプリケーションのモード設定移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5.2.2."><a href="#tubame_2.5.2.2.">2.5.2.2.レプリケーションの同期設定移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.6."><a href="#tubame_2.6.">2.6.サーバログ移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.7."><a href="#tubame_2.7.">2.7.EJBコンテナの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.7.1."><a href="#tubame_2.7.1.">2.7.1.Beanのインスタンスプールの設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.7.1.1."><a href="#tubame_2.7.1.1.">2.7.1.1.SLSBインスタンスプールの設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.7.1.1.1."><a href="#tubame_2.7.1.1.1.">2.7.1.1.1.SLSBインスタンスプール設定移行(インスタンスプール未設定)</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.7.1.1.2."><a href="#tubame_2.7.1.1.2.">2.7.1.1.2.SLSBインスタンスプール設定移行(インスタンスプール設定あり)</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.7.1.2."><a href="#tubame_2.7.1.2.">2.7.1.2.MDBインスタンスプールの設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.7.1.2.1."><a href="#tubame_2.7.1.2.1.">2.7.1.2.1.MDBインスタンスプール設定移行(インスタンスプール未設定)</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.7.1.2.2."><a href="#tubame_2.7.1.2.2.">2.7.1.2.2.MDBインスタンスプール設定移行(インスタンスプール設定あり)</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.7.2."><a href="#tubame_2.7.2.">2.7.2.EntityBeanコンテナ設定移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.8."><a href="#tubame_2.8.">2.8.セキュリティ設定移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.8.1."><a href="#tubame_2.8.1.">2.8.1.セキュリティドメイン移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dt>
<span class="3."><a href="#tubame_3.">3.アプリケーション移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.1."><a href="#tubame_3.1.">3.1.Servlet移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.1.1."><a href="#tubame_3.1.1.">3.1.1.Servlet非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.1.2."><a href="#tubame_3.1.2.">3.1.2.Servlet下位互換パラメータ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.1.3."><a href="#tubame_3.1.3.">3.1.3.Servlet Cookieに関連する下位互換パラメータ</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.2."><a href="#tubame_3.2.">3.2.JSP移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.2.1."><a href="#tubame_3.2.1.">3.2.1.JSP非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.2.2."><a href="#tubame_3.2.2.">3.2.2.EL非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.2.3."><a href="#tubame_3.2.3.">3.2.3.JSP下位互換パラメータ</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.3."><a href="#tubame_3.3.">3.3.JAVAEE非推奨APIの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.3.1."><a href="#tubame_3.3.1.">3.3.1.Servlet、JSP以外の非推奨API</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.4."><a href="#tubame_3.4.">3.4.JNDI移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.4.1."><a href="#tubame_3.4.1.">3.4.1.EJBのJNDI名移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.4.2."><a href="#tubame_3.4.2.">3.4.2.JNDIクライアント移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.4.3."><a href="#tubame_3.4.3.">3.4.3.JNDIクライアント(jnpプロトコル)移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.5."><a href="#tubame_3.5.">3.5.HA-JNDI移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.6."><a href="#tubame_3.6.">3.6.EJB移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.6.1."><a href="#tubame_3.6.1.">3.6.1.EJB(IIOP)移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.6.1.1."><a href="#tubame_3.6.1.1.">3.6.1.1.IIOPクライアントの移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.7."><a href="#tubame_3.7.">3.7.JMS移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.8."><a href="#tubame_3.8.">3.8.Webサービス移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.9."><a href="#tubame_3.9.">3.9.CORBA連携移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.10."><a href="#tubame_3.10.">3.10.JMX移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.11."><a href="#tubame_3.11.">3.11.JBossCache移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12."><a href="#tubame_3.12.">3.12.デプロイメントディスクリプタ移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.12.1."><a href="#tubame_3.12.1.">3.12.1.web.xml移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.12.1.1."><a href="#tubame_3.12.1.1.">3.12.1.1.JBossWeb(catalina)のServlet移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.1.2."><a href="#tubame_3.12.1.2.">3.12.1.2.JBossWebのServlet移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.1.3."><a href="#tubame_3.12.1.3.">3.12.1.3.JBossWebのServletパラメータ移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.2."><a href="#tubame_3.12.2.">3.12.2.jboss-web.xml移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.12.2.1."><a href="#tubame_3.12.2.1.">3.12.2.1.Webコンテナとして一般的なWeb設定(context-root、virtual-hostタグ、use-session-cookiesタグ、resource-refタグ)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.2.2."><a href="#tubame_3.12.2.2.">3.12.2.2.JBoss独自のセキュリティ設定(security-domainタグ、jacc-star-role-allowタグ、run-as-principalタグ)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.2.3."><a href="#tubame_3.12.2.3.">3.12.2.3.JBoss独自のサービス依存性設定(dependsタグ)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.2.4."><a href="#tubame_3.12.2.4.">3.12.2.4.JBoss独自のセッションレプリケーション設定(replication-configタグ)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.2.5."><a href="#tubame_3.12.2.5.">3.12.2.5.JBoss独自クラスロード設定(class-loadingタグ)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.2.6."><a href="#tubame_3.12.2.6.">3.12.2.6.J2EEモジュール(EJB,MDB,WebService)の設定(ejb-refタグ、ejb-local-refタグ、message-destination-refタグ、message-destinationタグ、webservice-descriptionタグ)の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.3."><a href="#tubame_3.12.3.">3.12.3.context.xml移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.4."><a href="#tubame_3.12.4.">3.12.4.jboss.xml移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.5."><a href="#tubame_3.12.5.">3.12.5.j2eeクライアントデプロイメントディスクリプタ移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.12.6."><a href="#tubame_3.12.6.">3.12.6.jbosscmp-jdbc.xml移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.13."><a href="#tubame_3.13.">3.13.デプロイメント移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.13.1."><a href="#tubame_3.13.1.">3.13.1.Web ARchive(WAR)移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.13.2."><a href="#tubame_3.13.2.">3.13.2.Enterprise ARchive(EAR)移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.13.3."><a href="#tubame_3.13.3.">3.13.3.Resource Adapter aRchive(RAR)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.13.4."><a href="#tubame_3.13.4.">3.13.4.Service ARchive(SAR)の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.14."><a href="#tubame_3.14.">3.14.アプリケーションの参照ライブラリの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="3.15."><a href="#tubame_3.15.">3.15.アプリケーションロギング移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="3.15.1."><a href="#tubame_3.15.1.">3.15.1.Log4jの設定をアプリケーション内で完結させる方法</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</div>
<HR>
<a name="tubame_1."></a>
<h2 class="title">1.はじめに</h2>
<br>
<a name="tubame_1.1." id="category_189"></a>
<h3 class="title">1.1.本ガイドについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			本ガイドは、TUBAMEコミュニティから公開さている「JBossEAP4.3からJBossEAP6へのマイグレーションガイド」である。

			</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>本ガイドは、TUBAMEコミュニティで提供されているナレッジ管理ツールにより、TUBAME形式のナレッジ(xml)から自動生成されたものである
				</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
<p>TUBAMEコミュニティではナレッジベース検索ツールを提供しており、本ナレッジを利用して、修正項目を抽出し、修正規模を算出することが可能である。
			ナレッジベース検索ツールでは、修正項目から、マイグレーションガイドへのリンクも可能となっています。TUBAMEの詳細は以下をご確認ください。
		</p>
<p>
			
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>TUBAMEコミュニティ</p>
<p>
                        
<span class="command"><strong><a class="command" href="http://tubame.github.io/ja/index/" target="_top">http://tubame.github.io/ja/index/</a></strong></span>
                    
</p>
</li>
</ul>
</div>
<p>
			

			
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>ナレッジベース検索ツールを利用した移植検討を行う際は、業務アプリケーションのソースコードに合わせ、JBossの設定ファイルも必須となる。
				</p>
<p>
					
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
								JBossEAP4.3では以下の構造のように、all,default,minimal,productionのプロファイルがデフォルトで提供されている。移植検討外の不必要な検出を防ぐため、利用しているプロファイルの設定ファイルのみを検索対象とする必要がある。
								なお、本資料では、利用するプロファイルをmyserverプロファイルとして記載する。
								</p>
<div class="figure">
<a name="N16C92"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP4.3のデフォルトプロファイルについて</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
[JBOSS_HOME]
	|-- bin/
	|-- client/
	|-- docs/
	|-- lib/
	|-- server/
		|-- all/
		|-- default/
		|-- minimal/
		|-- production
									</pre>
</div>
</div>
<p>
<br class="figure-break">
							
</p>
</li>
</ul>
</div>
<p>
				
</p>
</td>
</tr>
</table>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.2." id="category_180"></a>
<h3 class="title">1.2.JBoss概要</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP6では、JBossEAP4系及び5系の基盤アーキテクチャを見直し、ゼロから新しい基盤アーキテクチャが採用されている。JBossEAP6への移植にあたり、JBossEAP4、5及び6系のJBoss概要を示す。


			</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>設定方法についても、JBossEAP4及び5までは、設定ファイルによる設定を行っていたが、JBossEAP6系からは、管理CLI(jboss-cli.sh)によるCUIレベルでの
					設定を推奨している。
				</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
<p>

			
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossEAP4</p>
<p>
						JBoss EAP4は、JMX(Java Management
						Extentions)を基にしたマイクロカーネル・アーキテクチャを採用している。

						</p>
<div class="figure">
<a name="N16B2E"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP43基盤アーキテクチャ</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="500">
<tr>
<td><img src="images/jboss43_arc.png" width="500" alt="JBossEAP43基盤アーキテクチャ"></td>
</tr>
</table>
</div>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
<p>
						JBossを構成するコンポーネントはサービス定義ファイル(jboss-service.xml)より、MBeanとしてサービスに登録される。
						以下にMBeanの特徴を述べる。

						</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>MBean間を疎結合にする。</p>
</li>
<li class="listitem">
<p>MBeanの追加・削除により構成変更を可能にする。</p>
</li>
<li class="listitem">
<p>JMXによるMBean等コンポーネントの管理・監視を可能にする。</p>
</li>
</ol>
</div>
<p>
					
</p>
</li>
<li class="listitem">
<p>JBossEAP5</p>
<p>
						JBoss EAP 5のアーキテクチャは、従来採用していたJMX(Java Management
						Extentions)だけでなく、OSGi(Open Services Gateway
						Initiative)やSpringなどのコンポーネントも実行可能なように、JBossマイクロコンテナが新規に開発された。


						</p>
<div class="figure">
<a name="N16B4E"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossEAP5基盤アーキテクチャ</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="500">
<tr>
<td><img src="images/jboss5_arc.png" width="500" alt="JBossEAP5基盤アーキテクチャ"></td>
</tr>
</table>
</div>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
<p>
						以下にJBossマイクロコンテナの特徴を述べる。

						</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>JBoss EAP 4.3まではサービスはJMX MBean化する必要があったが、JBoss EAP
									5からはPOJO(Plain Old Java Object)でサービスを提供できるようになった。
								</p>
</li>
<li class="listitem">
<p>MBeanの追加・削除により構成変更を可能にする。</p>
</li>
<li class="listitem">
<p>POJOであるため、単体試験が容易に行えるようになった。</p>
</li>
</ol>
</div>
<p>
					
</p>
</li>
<li class="listitem">
<p>JBossEAP6</p>
<p>
						JBossEAP6の基盤アーキテクチャを見直し、ゼロから新しい基盤アーキテクチャであるJBossモジューラサービスコンテナ(JBoss
						MSC)を作成した。


						</p>
<div class="figure">
<a name="N16B6E"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;JBossEAP6基盤アーキテクチャ</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="500">
<tr>
<td><img src="images/jboss6_arc.png" width="500" alt="JBossEAP5基盤アーキテクチャ"></td>
</tr>
</table>
</div>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
<p>
						モジュールベースのアーキテクチャになったことにより、アプリケーションサーバのコア（サーバ・コントローラ）及び管理以外の機能はサブシステムと呼ばれるモジュールとして扱われる。また、ユーザアプリケーションもモジュールとして扱われる。


					</p>
</li>
</ul>
</div>
<p>



			
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>基盤アーキテクチャの互換性</p>
<p>
								JBossEAP6のJBossモジュールサービスコンテナは、JBossEAP5のマイクロカーネル、マイクロコンテナとの互換性を一部保持する。
								これはJBossEAP6のモジューラサービスとしてorg.jboss.as.pojoが登録されており、このモジューラサービスで互換性を保っている。
								ただし、JBossEAP6で動作させるためには、マイクロコンテナ用のPOJOのデプロイメントデスクリプタのスキーマ定義を
								JBossEAP6のMSC POJO Service用の定義に変更する必要があり、完全な互換性はない。
								</p>
<div class="figure">
<a name="N16B88"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;JBossEAP6における従来の基盤アーキテクチャ(マイクロカーネル、マイクロコンテナ)の利用について
									</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="500">
<tr>
<td><img src="images/jboss5_jboss6_arc_compati.png" width="500" alt="JBossEAP5基盤アーキテクチャ"></td>
</tr>
</table>
</div>
</div>
</div>
<p>
<br class="figure-break">
							
</p>
</li>
</ul>
</div>
<p>


				
</p>
</td>
</tr>
</table>
</div>
<p>

			
		
</p>
</div>
<br>
<br>
<a name="tubame_1.3." id="category_90"></a>
<h3 class="title">1.3.JavaEE仕様について</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossは、JavaEEアプリケーションサーバとして、多くの
			仕様をサポートしており、Servlet、JSPのほかに、JCA、JTA、EJB、JMS、Webサービスといった機能が利用可能である。

			</p>
<div class="table">
<a name="N16353"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JBossの仕様(一部抜粋)</b>
</p>
<div class="table-contents">
<table summary="JBossの仕様(一部抜粋)" border="1">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>仕様</th><th>JBossEAP4.3</th><th>JBossEAP5</th><th>JBossEAP6</th>
</tr>
</thead>
<tbody>
<tr>
<td>J2EE</td><td>1.4準拠</td><td>1.5準拠</td><td>1.6準拠</td>
</tr>
<tr>
<td>Servet</td><td>2.4</td><td>2.5</td><td>3.0</td>
</tr>
<tr>
<td>JSP</td><td>2.1</td><td>2.1</td><td>2.2</td>
</tr>
<tr>
<td>JCA</td><td>1.5</td><td>1.5</td><td>1.6</td>
</tr>
<tr>
<td>EJB</td><td>3.0、2.1および2.0</td><td>3.0、2.1および2.0</td><td>3.1、3.0、 2.1及び 2.0</td>
</tr>
<tr>
<td>JTA</td><td>1.0</td><td>1.1</td><td>1.1</td>
</tr>
<tr>
<td>JMS</td><td>1.1</td><td>1.1</td><td>1.1</td>
</tr>
<tr>
<td>JAX-RPC</td><td>1.1</td><td>1.1</td><td>1.1</td>
</tr>
<tr>
<td>JAX-WS</td><td>2.0</td><td>2.1</td><td>2.2</td>
</tr>
<tr>
<td>JAX-RS</td><td>-</td><td>1.0</td><td>1.1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_2."></a>
<h2 class="title">2.サーバ設定移行</h2>
<br>
<a name="tubame_2.1." id="category_67"></a>
<h3 class="title">2.1.JDBCドライバ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JDBCドライバーは、JBossでは以下のフォルダに配置する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのJDBCドライバー配置場所</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/server/myserver/lib</p>
</li>
</ul>
</div>
<p>
		
</p>
<p>JBoss EAP6の場合、JDBCドライバをモジュールとして登録するか、JDBCドライバをモジュールとして登録する。JBoss EAP6にPostgesSQLのJDBCドライバをモジュールとして登録する方法を示す。
        
        
         </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JDBCドライバモジュール定義ファイル(module.xml)を作成する</p>
<div class="figure">
<a name="N15FCB"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;PostgresSQLのJDBCドライバ用module.xml</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
&lt;module xmlns="urn:jboss:module:1.0" name="org.postgresql"&gt;
  &lt;resources&gt;  
    &lt;resource-root path="postgresql-9.0-801.jdbc4.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
     &lt;module name="javax.api"/&gt;
     &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;
					</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>JDBCドライバモジュールの登録に必要なファイルを配置する</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>JBossのモジュールディレクトリ配下に$jboss.modules.dir/org/postgresqlフォルダを作成
						</p>
</li>
<li class="listitem">
<p>module.xmlを$jboss.modules.dir/org/postgresql配下にコピー
						</p>
</li>
<li class="listitem">
<p>JDBCドライバ(jdbc4*.jar)を$jboss.modules.dir/org/postgresql配下にコピーする
						</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>管理CLIよりJDBCドライバモジュールの登録を行う</p>
<div class="figure">
<a name="N15FE5"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBoss EAP6の管理CLIよりJDBCドライバモジュールの登録を行う。ドライバー名は任意で、{driver-name}と表記する。</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
/subsystem=datasources/jdbc-driver={driver-name}:add(driver-name={driver-name},driver-xa-datasource-class-name=org.postgresql.xa.PGXADataSource,driver-module-name=org.postgresql)
					</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
        
		
		
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
		
</p>
<div class="itemizedlist">
<p class="title">
<b>サポートしているJDBCバージョン</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossEAP4.3</p>
<p>JDBC 2.1及び3.0</p>
</li>
<li class="listitem">
<p>JBossEAP6</p>
<p>JDBC 4</p>
</li>
</ul>
</div>
<p>
		
</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_2.2." id="category_68"></a>
<h3 class="title">2.2.データソース移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではデータソース定義ファイル(*-ds.xml)を以下のフォルダに配置する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのデータソース定義ファイルの配置場所</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/server/myserver/deploy</p>
</li>
</ul>
</div>
<p>
			移行対象は業務アプリケーションで利用しているデータソース定義ファイルとなるため、hsqldb-ds.xmlなどのようにJBossデフォルト設定で有効と
			なっているが、利用していないデータソース設定は移植対象とならない。

		</p>
<p>JBossEAP4.3のデータソース定義ファイルはそのままJBoss EAP
			6で利用することは推奨されないため、既存のデータソース定義ファイルを参考に、管理CLIを利用してデータソース設定を行う必要がある。
		</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBoss EAP4.3
					データソース定義ファイルに、non-tx-datasourceタグが設定されている場合は管理CLIのdata-sourceコマンドを利用して、データソースの登録設定を行う。
				</p>
</li>
<li class="listitem">
<p>JBoss EAP4.3の
					データソース定義ファイルに、local-tx-datasourceタグまたはtx-datasourcタグが設定されている場合は管理CLIのdata-sourceコマンドを利用して、データソースの登録設定を行う。
				</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_2.2.1." id="category_172"></a>
<h3 class="title">2.2.1.データソース(no-tx-datasource)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではデータソース定義ファイル(*-ds.xml)を以下のフォルダに配置する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのデータソース定義ファイルの配置場所</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/server/myserver/deploy</p>
</li>
</ul>
</div>
<p>

		
</p>
<p>
			

			non-tx-datasourceタグが設定されている場合は管理CLIよりdata-sourceコマンドを利用して、データソースの登録設定を行う。

			</p>
<div class="figure">
<a name="N1689E"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;data-sourceコマンドを利用したデータソース登録例。ドライバ名は{driver-name}として、データソース名は{datasource-name}と表記する
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
data-source add --name={datasource-name} --jndi-name=java:jboss/resources/jdbc/{datasource-name} --driver-name={driver-name} --use-java-context=true --jta=true --max-pool-size=100 --min-pool-size=100 --pool-prefill=true --idle-timeout-minutes=0 --check-valid-connection-sql="select 1" --prepared-statements-cache-size=50 --driver-class=org.postgresql.Driver --connection-url=jdbc:postgresql://localhost:5432/testdb --user-name=postgres --password=postgres
				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.2.1.1." id="category_173"></a>
<h3 class="title">2.2.1.1.データソース(no-tx-datasource)の属性値移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のデータソース(no-tx-datasource)とJBossEAP6のデータソースの属性値の対応について示す。JBossEAP4.3とJBossEAP6のデータソースの属性値の対応については以下を参照。
		</p>
<p>
			
</p>
<div class="table">
<a name="N167A7"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JBossEAP4.3のデータソース(no-tx-datasource)とJBossEAP6のデータソースの属性値の対応</b>
</p>
<div class="table-contents">
<table summary="JBossEAP4.3のデータソース(no-tx-datasource)とJBossEAP6のデータソースの属性値の対応" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>JBossEAP4.3の属性</th><th>JBossEAP6の属性</th><th>JBossEAP6で提供されているデータソース作成コマンドどのパラメータ(属性値)対応</th>
</tr>
</thead>
<tbody>
<tr>
<td>jndi-name</td><td>jndi-name</td><td>--jndi-name</td>
</tr>
<tr>
<td>use-java-context</td><td>use-java-context</td><td>--use-java-context</td>
</tr>
<tr>
<td>connection-url</td><td>connection-url</td><td>--connection-url</td>
</tr>
<tr>
<td>driver-class</td><td>driver-class</td><td>data-souceコマンドでは設定できないため、管理CLIで設定する</td>
</tr>
<tr>
<td>user-name</td><td>user-name</td><td>--user-name</td>
</tr>
<tr>
<td>password</td><td>password</td><td>--password</td>
</tr>
<tr>
<td>application-managed-security</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>security-domain</td><td>security-domain
							</td><td>--security-domain
							</td>
</tr>
<tr>
<td>security-domain-and-application</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>min-pool-size</td><td>min-pool-size</td><td>--min-pool-size
							</td>
</tr>
<tr>
<td>min-pool-size</td><td>プールで保持される最小接続数。デフォルトは0。</td><td>Resource 要素のminIdle 属性に対応。デフォルトは0。</td>
</tr>
<tr>
<td>max-pool-size</td><td>max-pool-size</td><td>--max-pool-size</td>
</tr>
<tr>
<td>blocking-timeout-millis
							</td><td>blocking-timeout-millis</td><td>TODO:調査
							</td>
</tr>
<tr>
<td>background-validation</td><td>background-validation</td><td>--background-validation

							</td>
</tr>
<tr>
<td>background-validation-minutes</td><td>background-validation-millis</td><td>--background-validation-millis</td>
</tr>
<tr>
<td>idle-timeout-minutes</td><td>idle-timeout-minutes</td><td>--idle-timeout-minutes</td>
</tr>
<tr>
<td>validate-on-match</td><td>validate-on-match</td><td>--validate-on-match</td>
</tr>
<tr>
<td>new-connection-sql</td><td>new-connection-sql</td><td>--new-connection-sql
							</td>
</tr>
<tr>
<td>check-valid-connection-sql</td><td>check-valid-connection-sql
							</td><td>--check-valid-connection-sql</td>
</tr>
<tr>
<td>valid-connection-checker-class-name</td><td>valid-connection-checker-class-name</td><td>--valid-connection-checker-class-name</td>
</tr>
<tr>
<td>exception-sorter-class-name</td><td>exception-sorter-class-name
							</td><td>--exception-sorter-class-name</td>
</tr>
<tr>
<td>track-statements</td><td>track-statements</td><td>--track-statements</td>
</tr>
<tr>
<td>prefill</td><td>prefill
							</td><td>--pool-prefill</td>
</tr>
<tr>
<td>prepared-statement-cache-size</td><td>prepared-statement-cache-size							</td><td>--prepared-statement-cache-size
							</td>
</tr>
<tr>
<td>share-prepared-statements</td><td>share-prepared-statements
							</td><td>--share-prepared-statements
							</td>
</tr>
<tr>
<td>set-tx-query-timeout</td><td>set-tx-query-timeout</td><td>--set-tx-query-timeout</td>
</tr>
<tr>
<td>query-timeout</td><td>query-timeout</td><td>--query-timeout</td>
</tr>
<tr>
<td>metadata</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>type-mapping</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>depends</td><td>なし</td><td>なし</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_2.2.2." id="category_174"></a>
<h3 class="title">2.2.2.データソース(local-tx-datasource)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossではデータソース定義ファイル(*-ds.xml)を以下のフォルダに配置する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのデータソース定義ファイルの配置場所</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/server/myserver/deploy</p>
</li>
</ul>
</div>
<p>

		
</p>
<p>

			local-tx-datasourceタグが設定されている場合は管理CLIよりdata-sourceコマンドを利用して、データソースの登録設定を行う。



			</p>
<div class="figure">
<a name="N16ACF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;data-sourceコマンドを利用したデータソース登録例。ドライバ名は{driver-name}として、データソース名は{datasource-name}と表記する
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
data-source add --name={datasource-name} --jndi-name=java:jboss/resources/jdbc/{datasource-name} --driver-name={driver-name} --use-java-context=true --jta=true --max-pool-size=100 --min-pool-size=100 --pool-prefill=true --idle-timeout-minutes=0 --check-valid-connection-sql="select 1" --prepared-statements-cache-size=50 --driver-class=org.postgresql.Driver --connection-url=jdbc:postgresql://localhost:5432/testdb --user-name=postgres --password=postgres
				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.2.2.1." id="category_176"></a>
<h3 class="title">2.2.2.1.データソース(local-tx-datasource)の属性値移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のデータソース(local-tx-datasource)とJBossEAP6のデータソースの属性値の対応について示す。JBossEAP4.3とJBossEAP6のデータソースの属性値の対応については以下を参照。
		
		</p>
<p>
					


			JBossEAP4.3とJBossEAP6の属性値の対応については以下を参照。
			</p>
<div class="table">
<a name="N168B7"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JBossEAP4.3のデータソース(local-tx-datasource)とJBossEAP6のデータソースの属性値の対応</b>
</p>
<div class="table-contents">
<table summary="JBossEAP4.3のデータソース(local-tx-datasource)とJBossEAP6のデータソースの属性値の対応" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>JBossEAP4.3の属性</th><th>JBossEAP6の属性</th><th>JBossEAP6で提供されているデータソース作成コマンドどのパラメータ(属性値)対応</th>
</tr>
</thead>
<tbody>
<tr>
<td>jndi-name</td><td>jndi-name</td><td>--jndi-name</td>
</tr>
<tr>
<td>use-java-context</td><td>use-java-context</td><td>--use-java-context</td>
</tr>
<tr>
<td>connection-url</td><td>connection-url</td><td>--connection-url</td>
</tr>
<tr>
<td>transaction-isolation</td><td>TODO:</td><td>--transaction-isolation</td>
</tr>
<tr>
<td>no-tx-separate-pools</td><td>なし</td><td>データソースはno-tx-separate-pool未対応、XAデータソースで対応可能</td>
</tr>
<tr>
<td>driver-class</td><td>driver-class</td><td>data-souceコマンドでは設定できないため、管理CLIで設定する</td>
</tr>
<tr>
<td>user-name</td><td>user-name</td><td>--user-name</td>
</tr>
<tr>
<td>password</td><td>password</td><td>--password</td>
</tr>
<tr>
<td>application-managed-security</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>security-domain</td><td>security-domain
							</td><td>--security-domain
</td>
</tr>
<tr>
<td>security-domain-and-application</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>min-pool-size</td><td>min-pool-size</td><td>--min-pool-size
							</td>
</tr>
<tr>
<td>min-pool-size</td><td>プールで保持される最小接続数。デフォルトは0。</td><td>Resource 要素のminIdle 属性に対応。デフォルトは0。</td>
</tr>
<tr>
<td>max-pool-size</td><td>max-pool-size</td><td>--max-pool-size</td>
</tr>
<tr>
<td>blocking-timeout-millis
</td><td>blocking-timeout-millis</td><td>TODO:調査
							</td>
</tr>
<tr>
<td>background-validation</td><td>background-validation</td><td>--background-validation
							
							</td>
</tr>
<tr>
<td>background-validation-minutes</td><td>background-validation-millis</td><td>--background-validation-millis</td>
</tr>
<tr>
<td>idle-timeout-minutes</td><td>idle-timeout-minutes</td><td>--idle-timeout-minutes</td>
</tr>
<tr>
<td>validate-on-match</td><td>validate-on-match</td><td>--validate-on-match</td>
</tr>
<tr>
<td>new-connection-sql</td><td>new-connection-sql</td><td>--new-connection-sql
							</td>
</tr>
<tr>
<td>check-valid-connection-sql</td><td>check-valid-connection-sql
							</td><td>--check-valid-connection-sql</td>
</tr>
<tr>
<td>valid-connection-checker-class-name</td><td>valid-connection-checker-class-name</td><td>--valid-connection-checker-class-name</td>
</tr>
<tr>
<td>exception-sorter-class-name</td><td>exception-sorter-class-name
							</td><td>--exception-sorter-class-name</td>
</tr>
<tr>
<td>track-statements</td><td>track-statements</td><td>--track-statements</td>
</tr>
<tr>
<td>prefill</td><td>prefill
							</td><td>--pool-prefill</td>
</tr>
<tr>
<td>prepared-statement-cache-size</td><td>prepared-statement-cache-size							</td><td>--prepared-statement-cache-size
							</td>
</tr>
<tr>
<td>share-prepared-statements</td><td>share-prepared-statements
							</td><td>--share-prepared-statements
							</td>
</tr>
<tr>
<td>set-tx-query-timeout</td><td>set-tx-query-timeout</td><td>--set-tx-query-timeout</td>
</tr>
<tr>
<td>query-timeout</td><td>query-timeout</td><td>--query-timeout</td>
</tr>
<tr>
<td>metadata</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>type-mapping</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>depends</td><td>なし</td><td>なし</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_2.2.3." id="category_175"></a>
<h3 class="title">2.2.3.データソース(xa-datasource)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossではデータソース定義ファイル(*-ds.xml)を以下のフォルダに配置する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのデータソース定義ファイルの配置場所</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/server/myserver/deploy</p>
</li>
</ul>
</div>
<p>

		
</p>
<p>

			xa-datasourceタグが設定されている場合は管理CLIよりxa-data-sourceコマンドを利用して、データソースの登録設定を行う。

			</p>
<div class="figure">
<a name="N16AEF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;xa-data-sourceコマンドを利用したXAデータソース登録およびxa-datasource-propertiesの設定例。ドライバ名は{driver-name}として、データソース名は{datasource-name}と表記する
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
xa-data-source add --name={datasource-name} --jndi-name=java:jboss/resources/jdbc/{datasource-name} --driver-name={driver-name} --use-java-context=true --jta=true --max-pool-size=100 --min-pool-size=100 --pool-prefill=true --idle-timeout-minutes=0 --check-valid-connection-sql="select 1" --prepared-statements-cache-size=50 --xa-datasource-class=org.postgresql.xa.PGXADataSource
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=ServerName:add(value="localhost")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=PortNumber:add(value="5432")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=DatabaseName:add(value="testdb")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=User:add(value="postgres")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=Password:add(value="postgres")
				</pre>
<p>なお、XA対応のxa-data-sourceコマンドではJBossEAP5のデータソース定義ファイルで設定しているconnection-urlで指定しているDBサーバ名、ポート、ユーザ名、パスワードは設定できないため、
					管理CLIの通常のオペレーションでxa-datasource-propertiesに追加設定を行っている。
				</p>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.2.3.1." id="category_177"></a>
<h3 class="title">2.2.3.1.XAデータソース(xa-datasource)の属性値移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossのデータソース定義ファイル(*-ds.xml)にxa-datasourceタグが設定されている場合、複数のリソースにまたがってトランザクションを管理するために、アプリケーションサーバ内のトランザクションマネージャが利用される。
		</p>
<p>
		
		 
			JBossEAP4.3のデータソース(xa-datasource)とJBossEAP6のデータソースの属性値の対応について示す。JBossEAP4.3とJBossEAP6のデータソースの属性値の対応については以下を参照。
		
		



			JBossEAP4.3とJBossEAP6の属性値の対応については以下を参照。
			</p>
<div class="table">
<a name="N169B5"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JBossEAP4.3のデータソース(xa-datasource)とJBossEAP6のデータソースの属性値の対応</b>
</p>
<div class="table-contents">
<table summary="JBossEAP4.3のデータソース(xa-datasource)とJBossEAP6のデータソースの属性値の対応" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>JBossEAP4.3の属性</th><th>JBossEAP6の属性</th><th>JBossEAP6で提供されているデータソース作成コマンドどのパラメータ(属性値)対応</th>
</tr>
</thead>
<tbody>
<tr>
<td>jndi-name</td><td>jndi-name</td><td>--jndi-name</td>
</tr>
<tr>
<td>use-java-context</td><td>use-java-context</td><td>--use-java-context</td>
</tr>
<tr>
<td>track-connection-by-tx</td><td>interleaving</td><td>--interleaving</td>
</tr>
<tr>
<td>transaction-isolation</td><td>TODO:</td><td>--transaction-isolation</td>
</tr>
<tr>
<td>no-tx-separate-pools</td><td>no-tx-separate-pools</td><td>--no-tx-separate-pools</td>
</tr>
<tr>
<td>xa-datasource-property</td><td>xa-datasource-property</td><td>xa-data-sourceコマンドでは未対応のため、管理CLIで設定</td>
</tr>
<tr>
<td>xa-datasource-class</td><td>xa-datasource-class</td><td>--xa-datasource-class</td>
</tr>
<tr>
<td>isSameRM-override-value</td><td>same-rm-override</td><td>--same-rm-override</td>
</tr>
<tr>
<td>xa-resource-timeout</td><td>xa-resource-timeout</td><td>--xa-resource-timeout</td>
</tr>
<tr>
<td>user-name</td><td>user-name</td><td>--user-name</td>
</tr>
<tr>
<td>password</td><td>password</td><td>--password</td>
</tr>
<tr>
<td>application-managed-security</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>security-domain</td><td>security-domain
							</td><td>--security-domain
							</td>
</tr>
<tr>
<td>security-domain-and-application</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>min-pool-size</td><td>min-pool-size</td><td>--min-pool-size
							</td>
</tr>
<tr>
<td>min-pool-size</td><td>プールで保持される最小接続数。デフォルトは0。</td><td>Resource 要素のminIdle 属性に対応。デフォルトは0。</td>
</tr>
<tr>
<td>max-pool-size</td><td>max-pool-size</td><td>--max-pool-size</td>
</tr>
<tr>
<td>blocking-timeout-millis
							</td><td>blocking-timeout-millis</td><td>TODO:調査
							</td>
</tr>
<tr>
<td>background-validation</td><td>background-validation</td><td>--background-validation

							</td>
</tr>
<tr>
<td>background-validation-minutes</td><td>background-validation-millis</td><td>--background-validation-millis</td>
</tr>
<tr>
<td>idle-timeout-minutes</td><td>idle-timeout-minutes</td><td>--idle-timeout-minutes</td>
</tr>
<tr>
<td>validate-on-match</td><td>validate-on-match</td><td>--validate-on-match</td>
</tr>
<tr>
<td>new-connection-sql</td><td>new-connection-sql</td><td>--new-connection-sql
							</td>
</tr>
<tr>
<td>check-valid-connection-sql</td><td>check-valid-connection-sql
							</td><td>--check-valid-connection-sql</td>
</tr>
<tr>
<td>valid-connection-checker-class-name</td><td>valid-connection-checker-class-name</td><td>--valid-connection-checker-class-name</td>
</tr>
<tr>
<td>exception-sorter-class-name</td><td>exception-sorter-class-name
							</td><td>--exception-sorter-class-name</td>
</tr>
<tr>
<td>track-statements</td><td>track-statements</td><td>--track-statements</td>
</tr>
<tr>
<td>prefill</td><td>prefill
							</td><td>--pool-prefill</td>
</tr>
<tr>
<td>prepared-statement-cache-size</td><td>prepared-statement-cache-size							</td><td>--prepared-statement-cache-size
							</td>
</tr>
<tr>
<td>share-prepared-statements</td><td>share-prepared-statements
							</td><td>--share-prepared-statements
							</td>
</tr>
<tr>
<td>set-tx-query-timeout</td><td>set-tx-query-timeout</td><td>--set-tx-query-timeout</td>
</tr>
<tr>
<td>query-timeout</td><td>query-timeout</td><td>--query-timeout</td>
</tr>
<tr>
<td>metadata</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>type-mapping</td><td>なし</td><td>なし</td>
</tr>
<tr>
<td>depends</td><td>なし</td><td>なし</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_2.2.4." id="category_99"></a>
<h3 class="title">2.2.4.HAデータソース設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3のデータソース定義ファイル(*-ds.xml)にha-local-tx-datasource、ha-xa-datasourceタグが設定されている場合、JBossのJBossJCADatabaseFailover機能により、データソースのフェイルオーバが可能となる。</p>
<p>TODO: JBossEAP6調査</p>
</div>
<br>
<br>
<a name="tubame_2.2.4.1." id="category_140"></a>
<h3 class="title">2.2.4.1.HAデータソース(ha-local-tx-datasource)移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>TODO:Please enter the text.</p>
</div>
<br>
<br>
<a name="tubame_2.2.4.2." id="category_141"></a>
<h3 class="title">2.2.4.2.HAデータソース(ha-xa-datasource)移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>TODO:Please enter the text.</p>
</div>
<br>
<br>
<a name="tubame_2.3." id="category_69"></a>
<h3 class="title">2.3.JBossWebコンテナ設定移行</h3>
<br>
<br>
<a name="tubame_2.3.1." id="category_100"></a>
<h3 class="title">2.3.1.HTTPコネクタの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
        JBossEAP4.3のHTTPコネクタは、以下ファイルのConnectorタグで設定する。protocol属性がHTTP/1.1の場合はHTTPコネクタが有効となる。
        
        </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/server.xml</p>
</li>
</ul>
</div>
<p>

　　　　　　　　
		</p>
<p>
		
		JBossEAP6のHTTPコネクタの移植方法については、<span class="command"><strong><a class="command" href="#HTTP_AJP_PORTING">HTTP/AJPコネクタ移行</a></strong></span>を参照
		</p>
</div>
<br>
<br>
<a name="tubame_2.3.2." id="category_101"></a>
<h3 class="title">2.3.2.AJPコネクタ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
         JBossEAP4.3のAJPコネクタは、以下ファイルのConnectorタグで設定する。protocol属性がAJP/1.3の場合はAJPコネクタが有効となる。
        
        </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/server.xml</p>
</li>
</ul>
</div>
<p>
　　　　　　　JBossEAP6のAJPコネクタの移植方法については、<span class="command"><strong><a class="command" href="#HTTP_AJP_PORTING">HTTP/AJPコネクタ移行</a></strong></span>を参照
		</p>
</div>
<br>
<br>
<a name="tubame_2.3.3." id="category_70"></a>
<h3 class="title">2.3.3.HTTP/AJPコネクタの属性値移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではJBossWebのHTTP/AJPコネクタ設定を以下ファイルのConnectorタグに設定する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/server.xml
					</p>
</li>
</ul>
</div>
<p>

		
</p>
<p>
<a name="HTTP_AJP_PORTING"></a>
			JBossEAP6では管理CLIにより、HTTP/AJPコネクタの属性の値を設定する。

			</p>
<div class="figure">
<a name="N16031"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;max-connections設定例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
[standalone@2e3799aba350:9999 /] /subsystem=web/connector=ajp/:write-attribute(name=max-connections,value=1000)
				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="table">
<a name="N1603C"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JBossEAP4.3とJBossEAP6のコネクタの属性の対応</b>
</p>
<div class="table-contents">
<table summary="JBossEAP4.3とJBossEAP6のコネクタの属性の対応" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>JBossEAP4.3の属性</th><th>JBossEAP6での対応</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>maxThreads</td><td>max-connection(管理CLIより属性値を設定)</td><td>EAP6のデフォルトは512 per CPU core</td>
</tr>
<tr>
<td>minSpareThreads</td><td>該当なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>maxSpareThreads</td><td>該当なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>maxHTTPHeaderSize</td><td>システムプロパティorg.apache.coyote.http11.Http11Protocol.MAX_HEADER_SIZEで設定
							</td><td>デフォルト値はEAP4.3及びEAP6で同じ(8KB)</td>
</tr>
<tr>
<td>maxKeepAliveRequests</td><td>システムプロパティorg.apache.coyote.http11.Http11Protocol.MAX_KEEP_ALIVE_REQUESTSで設定
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>connectionTimeout</td><td>システムプロパティorg.apache.coyote.ajp.DEFAULT_CONNECTION_TIMEOUTで設定
							</td><td>デフォルト値はEAP4.3及びEAP6で同じ（タイムアウトしない)</td>
</tr>
<tr>
<td>keepAliveTimeout</td><td>システムプロパティorg.apache.coyote.http11.DEFAULT_KEEP_ALIVE_TIMEOUTで設定
							</td><td>デフォルト値はEAP4.3及びEAP6で同じ（タイムアウトしない)</td>
</tr>
<tr>
<td>packetSize</td><td>システムプロパティorg.apache.coyote.ajp.MAX_PACKET_SIZEで設定</td><td>デフォルト値はEAP4.3及びEAP6で同じ（8192)</td>
</tr>
<tr>
<td>bufferSize</td><td>該当なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>maxPostSize</td><td>max-post-size(管理CLIより属性値を設定)</td><td>デフォルト値はEAP4.3及びEAP6で同じ（2MB)	</td>
</tr>
<tr>
<td>tomcatAuthentication</td><td>TODO:</td><td>&nbsp;</td>
</tr>
<tr>
<td>ciphers</td><td>TODO:</td><td>&nbsp;</td>
</tr>
<tr>
<td>useBodyEncodingForURI</td><td>システムプロパティorg.apache.catalina.connector.USE_BODY_ENCODING_FOR_QUERY_STRINGで設定
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>allowTrace</td><td>システムプロパティorg.apache.catalina.connector.ALLOW_TRACEで設定
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>xpoweredby</td><td>システムプロパティorg.apache.catalina.connector.X_POWERED_BYで設定
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>compression</td><td>システムプロパティorg.apache.coyote.http11.Http11Protocol.COMPRESSIONで設定
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>enableLookups</td><td>enable-lookups</td><td>デフォルト値はEAP4.3及びEAP6で同じ（false)</td>
</tr>
<tr>
<td>redirectPort</td><td>redirect-port</td><td>&nbsp;</td>
</tr>
<tr>
<td>tcpNoDelay</td><td>TODO:</td><td>&nbsp;</td>
</tr>
<tr>
<td>scheme</td><td>scheme(管理CLIより属性値を設定)</td><td>デフォルト値はEAP4.3及びEAP6で同じ(http)</td>
</tr>
<tr>
<td>secure</td><td>secure(管理CLIより属性値を設定)</td><td>デフォルト値はEAP4.3及びEAP6で同じ(false)</td>
</tr>
<tr>
<td>emptySessionPath</td><td>該当なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>acceptCount</td><td>該当なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>maxSavePostSize</td><td>max-save-post-size</td><td>&nbsp;</td>
</tr>
<tr>
<td>proxyName</td><td>proxy-name</td><td>&nbsp;</td>
</tr>
<tr>
<td>proxyPort</td><td>proxy-port</td><td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">



			
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>emptySessionPath</p>
<p>
						JBossEAP6ではemptySessionPathは削除されている。

						JBossEAP4.3のデフォルトは、emptySessionPathがtrue。emptySessionPathがtrueの場合、クッキーのパスに「/」が設定され、かつ以下のようにJSessionIDが再利用される仕様となり、セキュリティ的なリスクもあるため、業務要件を確認し、移行後の環境でも有効とすべきパラメータか確認する必要がある。

						</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
								
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>JSessionIDの再利用について</p>
<p>クライアントがアプリケーションにログインしセッションを払い出し、その後ログアウトした状態（クライアント側はログインした際に発行されたクッキーが存在し、そのなかにJSessionIDが埋め込まれている状態）で、JBossにセッション作成を行うような
											リクエストを送信した場合、JBossEAP4.3ではJSessionIDを再利用するため、同じIDでセッションを発行する。
										</p>
</li>
</ul>
</div>
<p>
							
</p>
</td>
</tr>
</table>
</div>
<p>
					
</p>
<p>JBossEAP6はJSessionIDの再利用はしない。クッキーのパスについては、デフォルトではアプリケーションのコンテキスト名が設定される。web.xmlのsession-config/cookie-config/pathに「/」を設定することで、、emptySessionPathがtrueの場合と同じにようにクッキーのパス設定を「/」にすることができる。
					</p>
</li>
<li class="listitem">
<p>acceptCount/backlog</p>
<p>JBoss Web
						subsystemはデフォルトで内部のスレッドプール(Workerモデル）を利用しており、この方法では、acceptCount(backlog)と同じ設定は、存在しない。acceptCountの設定が、移行後の環境で必須の場合は、JBossWEBのWorkerモデルのスレッドプール方式より
						Executor形式のスレッドプールの採用を検討する。
					</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.4." id="category_71"></a>
<h3 class="title">2.3.4.Valve移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではJBossWebのValve設定を以下ファイルのValveタグに設定する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/server.xml</p>
</li>
</ul>
</div>
<p>
			
		
</p>
<p>ValveにはJBossWebに含まれるTomcat(catalina)提供のValveとJBossWeb独自のValveが存在する。JBossWeb独自のValveが、移行後の環境であるJBossEAP6でも同等に必要となる場合は、移植方法を別途検討する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_2.3.4.1." id="category_72"></a>
<h3 class="title">2.3.4.1.JBoss独自のValve移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のJBossWeb独自で以下のValveクラスが提供されており、JBossWebのserver.xmlでは、CachedConnectionValveのみがデフォルトで有効になっている。


			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.jboss.web.tomcat.security.HttpServletRequestValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.SecurityAssociationValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.FormAuthValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.JaccContextValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.BasicAuthValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.CustomPrincipalValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.service.session.JvmRouteValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.service.session.ClusteredSessionValve
					</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.service.session.BatchReplicationClusteredSessionValve
					</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.filters.SemaphoreValve</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.service.session.ClusteredSessionValve
					</p>
</li>
</ul>
</div>
<p>

			CachedConnectionValveはコネクションクローズ漏れ検知のための機能である。JBossEAP6の場合では、jcaサブシステムにcached-connection-manager(CachedConnectionManager)が設定され、
			属性debugがtrueの場合、 JBoss がクローズ漏れコネクションをクローズする。
			</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					EAP 6.2.0 以降では non-jta (jta="false") なデータソースではuse-ccm 属性によらず CachedConnectionManager は無効化されるため、非XAデータソースではクローズ漏れ機能は動作しない
					
				</p>
</td>
</tr>
</table>
</div>
<p>

			CachedConnectionValve以外でJBossWeb独自のValveを利用している場合、JBossEAP6での代替案を検討する必要がある。なおJBossEAP6では、org.jboss.web.tomcatパッケージのクラスは提供されていない。

			

		</p>
</div>
<br>
<br>
<a name="tubame_2.3.4.2." id="category_73"></a>
<h3 class="title">2.3.4.2.JBoss独自(Catalina)のValve移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3で提供されているTomcat(Catalina)のValveを利用している場合も、JBossEAP6で利用可能かどうか調査する必要がある。</p>
<p>
			JBossEAPでは以下のValveを提供している。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossEAP4.3提供ValveとJBossEAP6のValve</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.apache.catalina.valves.AccessLogValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.CometConnectionManagerValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.ErrorReportValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.ExtendedAccessLogValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.FastCommonAccessLogValve(depricated)
					</p>
<p>FastCommonAccessLogValveはJBossEAP4.3のJBossWebですでに非推奨になっており、AccessLogValveを利用する。</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.JDBCAccessLogValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.PersistentValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.RemoteAddrValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.RemoteHostValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.RequestDumperValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
<li class="listitem">
<p>org.apache.catalina.valves.RequestFilterValve</p>
<p>JBossEAP6でも同じValveは存在する</p>
</li>
</ul>
</div>
<p>

			
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.5." id="category_74"></a>
<h3 class="title">2.3.5.Realm移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
        	JBossEAP4.3ではJBossWebのRealm設定を以下ファイルのRealmタグに設定する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/server.xml</p>
</li>
</ul>
</div>
<p>
            
       
</p>
<p>RealmにはJBossWebに含まれるTomcat(catalina)提供のRealmとJBossWeb独自のRealmが存在する。JBossWeb独自のRealmが、移行後の環境であるJBossEAP6でも同等に必要となる場合は、移植方法を別途検討する必要がある。
        
        </p>
</div>
<br>
<br>
<a name="tubame_2.3.5.1." id="category_75"></a>
<h3 class="title">2.3.5.1.JBoss独自のRealm移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
            JBossEAP4.3はJBossWeb独自で以下のRealmクラスが提供されており、JBossWebのserver.xmlでは、JBossSecurityMgrRealmがデフォルトで有効になっている。
			これらのクラスは、JBossの認証、認可機構を利用するためのクラスで、アプリケーションでJBossの認証、認可機構を利用している場合以外は移行対象とならない。
			システム要件を確認して、JBossの認証、認可機構を利用している場合は、代替案を別途、検討する必要がある。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.jboss.web.tomcat.security.JBossSecurityMgrRealm</p>
<p>JBossSecurityMgrRealmは、JBossのJNDIにバインド(securityMgr)されているセキュリティマネジャーを利用してX509証明書を利用した認証・認可機能を提供する。</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.JaccAuthorizationRealm</p>
</li>
<li class="listitem">
<p>org.jboss.web.tomcat.security.ExtendedJaccAuthorizationRealm</p>
</li>
</ul>
</div>
<p>

		
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JBossWebのWEBアプリケーション設定(jboss-web.xml)でセキュリティドメインを明示的に設定して利用している場合は、
アプリケーションでJBossの認証、認可機構を利用している可能性がある。</p>
<p>JBossEAP6にはorg.jboss.web.tomcat.securityパッケージのクラスは提供されていない</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.5.2." id="category_76"></a>
<h3 class="title">2.3.5.2.JBoss独自(Catalina)のRealm移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
            
			JBossEAP4.3のJBossWebに含まれるTomcat(Catalina)のRealmは以下のクラスが存在するが、JBossEAP4.3で同梱されていたRealmの実装クラスは、JBossEAP6では提供されていない。
			JBossEAP4.3で同梱されていたRealmの実装クラスが必要の場合、移行元の環境でどのようなセキュリティ要件があるか確認し、
			JBossEAP6の環境でも同等なセキュリティ要件を満たすことができるかは、別途確認が必要である。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossWeb提供のRealm</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.apache.catalina.Realm</p>
</li>
<li class="listitem">
<p>org.apache.catalina.realm.JNDIRealm</p>
</li>
<li class="listitem">
<p>org.apache.catalina.realm.DataSourceRealm</p>
</li>
<li class="listitem">
<p>org.apache.catalina.realm.UserDatabaseRealm</p>
</li>
<li class="listitem">
<p>org.apache.catalina.realm.MemoryRealm</p>
</li>
<li class="listitem">
<p>org.apache.catalina.realm.JAASRealm</p>
</li>
<li class="listitem">
<p>org.apache.catalina.realm.JDBCRealm</p>
</li>
</ul>
</div>
<p>


		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.6." id="category_142"></a>
<h3 class="title">2.3.6.Context設定移行</h3>
<br>
<br>
<a name="tubame_2.3.6.1." id="category_143"></a>
<h3 class="title">2.3.6.1.ContextのdocBase移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3では、server.xmlのContextタグ設定で、docBaseにディレクトリパスを指定することで、WebアプリケーションがdocBaseで指定されたパスに
			格納されたファイルにアクセス可能となる。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/server.xml
					</p>
<div class="figure">
<a name="N16554"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP4.3のContextタグによるdocBase設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;Context path="/myapp/txt" docBase="/data/txt" /&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
		
</p>
<p>

			JBossEAP6ではserver.xmlによるContextタグ設定は出来ないため、jboss-web.xmlのoverlay設定で同等なことが実現できる。


			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>docBaseの値が絶対パスの場合の移植方法</p>
<p>
						前提条件を以下と仮定する

						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>/data/txtフォルダが存在し、/data/txt配下にファイルが存在する。なお/data/txtフォルダの権限は正しく付与されていること(/data/txtフォルダに対して、JBossの起動ユーザの権限が適切に付与されていること）
								</p>
</li>
<li class="listitem">
<p>GETリクエストで、リクエストURL「/myapp/txt/foo.txt」でアクセス可能とする。</p>
</li>
</ul>
</div>
<p>

						jboss-web.xmlのoverlay設定で任意のディレクトリを
						(本例の場合は/data)を公開することで対応可能である。

						</p>
<div class="figure">
<a name="N1656F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossEAP6のjboss-web.xmlのoverlay設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;jboss-web version="7.0"
           xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee jboss-web_7_0.xsd"&gt;
  &lt;context-root&gt;myapp&lt;/context-root&gt;
  &lt;overlay&gt;/data&lt;/overlay&gt;
&lt;/jboss-web&gt;
							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>docBaseの値が相対パスの場合の移植方法</p>
<div class="figure">
<a name="N1657D"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;JBossEAP4.3のContextタグによるdocBase設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;Context path="/myapp/txt" docBase="data/txt" /&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<p>
						前提条件を以下と仮定する

						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>$JBOSS_HOME/data/txtフォルダが存在し、$JBOSS_HOME/data/txt配下にファイルが存在する。
								</p>
</li>
<li class="listitem">
<p>GETリクエストで、リクエストURL「/myapp/txt/foo.txt」で$JBOSS_HOME/data/txtフォルダ配下のファイルにアクセス可能とする。
								</p>
</li>
</ul>
</div>
<p>

						$JBOSS_HOME/dataディレクトリ配下の対象ディレクトリ(txt)を利用してシンボリックリンクを作成し、シンボリックリンク先のディレクトリをjboss-web.xmlのoverlay設定で指定する


						</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>シンボリックリンクの作成</p>
<pre class="programlisting">
ln -s JBOSS_HOME/data/txt /data/txt
								</pre>
</li>
<li class="listitem">
<p>/dataディレクトリをoverlayで公開する。</p>
<div class="figure">
<a name="N1659A"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;JBossEAP6のjboss-web.xmlのoverlay設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
&lt;jboss-web version="7.0"
           xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee jboss-web_7_0.xsd"&gt;
  &lt;context-root&gt;myapp&lt;/context-root&gt;
  &lt;overlay&gt;/data&lt;/overlay&gt;
&lt;/jboss-web&gt;
									</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
						
						
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>$JBOSS_HOME/dataディレクトリのパス配下の操作を行う場合は、システムプロパティjboss.server.data.dirで$JBOSS_HOME/dataディレクトリのパスが取得可能である</p>
</td>
</tr>
</table>
</div>
<p>
					
</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4." id="category_77"></a>
<h3 class="title">2.4.JBossWebデプロイヤー設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではWEBアプリケーションをデプロイするための、JBossWebデプロイヤー設定を以下のファイルに設定する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jbossweb.deployer/META-INF/jboss-service.xml
					</p>
</li>
</ul>
</div>
<p>
			主な設定としては、クラスローダのデフォルトの振る舞いを変える場合（Java2ClassLoadingCompliance、UseJBossWebLoader）や、
			フェイルオーバ時にjvmRouteの再設定を行う（UseJK）がある。これらの設定がデフォルトから変更されている場合は、JBossEAP6での移植を検討する必要がある。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
						Java2ClassLoadingComplianceの詳細は、
						<span class="command"><strong><a class="command" href="#JBossClassLoadSetting">JBoss独自クラスロード設定</a></strong></span>
						を参照。
					</p>
</li>
<li class="listitem">
<p>UseJBossWebLoaderについては、JBossEAP4.3独自のunified class
						loaderが採用されるため、JBossEAP6では同等な機能は存在しない。
					</p>
</li>
<li class="listitem">
<p>UseJKについては、JBossEAP4.3の場合、デフォルトfalseで、デフォルトではjvmRouteの再設定をしない。JBossEAP6の場合に、UserJKを有効にする場合、システムプロパティUseJKにtrueを設定する
                    </p>
</li>
</ul>
</div>
<p>

			
</p>
<div class="table">
<a name="N16210"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;jbossweb.deployer/META-INF/jboss-service.xmlの設定項目</b>
</p>
<div class="table-contents">
<table summary="jbossweb.deployer/META-INF/jboss-service.xmlの設定項目" border="1">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>パラメータ名</th><th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>DefaultSecurityDomain</td><td>jboss-web.xmlに設定が無かった場合のデフォルトのjbossのセキュリティドメイン設定。デフォルトは、java:/jaas/otherとなる。
							</td>
</tr>
<tr>
<td>Java2ClassLoadingCompliance</td><td>Servlet2.3仕様のWebアプリケーションクラスを最初にloadする「war first load
								model」から、親を先に読む「Java2 parent first class」に
								方法に変更する場合はtrueを設定する。デフォルトはfalseとなる。
							</td>
</tr>
<tr>
<td>UseJBossWebLoader</td><td>デフォルトではtomcatのクラスローダのようにWebアプリケーション毎のクラスローダでロードされるため、確実に分離される（war同士でクラスを参照することが出来ません）が、trueにすることで、JBoss独自のユニファイドクラスロードが適用され、ロードされたクラスはレジストリに登録され、クラスが共有可能となる（war同士でクラスを参照することが出来る）。デフォルトはfalseとなる。
							</td>
</tr>
<tr>
<td>FilteredPackages</td><td>-</td>
</tr>
<tr>
<td>LenientEjbLink</td><td>-</td>
</tr>
<tr>
<td>DeleteWorkDirOnContextDestroy</td><td>コンテンツを削除すると work ディレクトリが削除される。デフォルトはfalseとなる。</td>
</tr>
<tr>
<td>ManagerClass</td><td>コンテキストにdistributableとマークされた場合の、JBoss独自のsession
								managerクラス。デフォルトはorg.jboss.web.tomcat.service.session.JBossCacheManagerとなる。
							</td>
</tr>
<tr>
<td>SubjectAttributeName</td><td>jaasモジュールにより、認証が成功した場合に、Subjectを保存するかのフラグ。デフォルトはコメントされており、サブジェクトは保存されない。
							</td>
</tr>
<tr>
<td>SessionIdAlphabet</td><td>セッションIDを作成するためのキャラクターセット。デフォルトはコメントされおり、無効化されている。</td>
</tr>
<tr>
<td>SnapshotMode</td><td> セッションが他のノードへレプリケートされるタイミングを指定する。デフォルトは INSTANT で、INTERVAL
								を使用することが可能。
								INSTANT
								モードでは要求処理スレッドが使用され、変更は要求の最後にレプリケートされる。snapshot-interval
								オプションは無視される。
								INTERVAL モードでは、バックグラウンドタスクは snapshot-interval
								によって指定される間隔で実行され、変更されたセッションがレプリケートされる。
							</td>
</tr>
<tr>
<td>SnapshotInterval</td><td>INTERVAL が snapshot-mode
								の値として使用された時に、変更されたセッションがレプリケートされる間隔 (ミリ秒単位) 。デフォルトは2000となる。
							</td>
</tr>
<tr>
<td>UseJK</td><td>デフォルトfalse。trueの場合、フェイルオーバ時にjvmRouteの再設定を行う。</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.5." id="category_78"></a>
<h3 class="title">2.5.JBossWebクラスタ設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではJBossWebのクラスタ設定を以下のファイルに設定する。この設定が存在するの場合は、JBossのクラスタリングが有効となる。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web-cluster.sar/META-INF/jboss-service.xml
					</p>
</li>
</ul>
</div>
<p>
			
			
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JBossクラスタ設定が有効であり、Webアプリケーションのweb.xmlにdistributableタグが設定されている場合は、
					JBossのクラスタノードに、セッションレプリケーションが実施される設定となる。
				</p>
</td>
</tr>
</table>
</div>
<p>

		
</p>
<p>
		
		以下の設定項目について、移植方法を示す。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JGroups設定の移行</p>
</li>
<li class="listitem">
<p>レプリケーション設定の移行</p>
</li>
</ul>
</div>
<p>
		
		
		
</p>
</div>
<br>
<br>
<a name="tubame_2.5.1." id="category_82"></a>
<h3 class="title">2.5.1.JGroups設定の移行</h3>
<br>
<br>
<a name="tubame_2.5.1.1." id="category_83"></a>
<h3 class="title">2.5.1.1.JGroupsプロトコルスタックの設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3のクラスタ時にノード間の通信で利用するJGroupsプロトコルスタックの設定について示す。
			JGroupsプロトコルスタックの設定は、JBossWebクラスタサービスのjboss-service.xmlのconfigタグ配下に指定されているタグによって決定される。
			プロトコルはUDP又はTCPが設定可能である。
		</p>
<p>
			
			
</p>
<div class="figure">
<a name="N16287"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP4.3のJGroupsプロトコルスタックの設定($JBoss_HOME/myserver/deploy/jboss-web-cluster.sar/META-INF/jboss-service.xml)
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">

					
...
 &lt;attribute name="ClusterConfig"&gt;
            &lt;!--
            The default UDP stack:
            - If you have a multihomed machine, set the UDP protocol's bind_addr attribute to the
            appropriate NIC IP address, e.g bind_addr="192.168.0.2".
            - On Windows machines, because of the media sense feature being broken with multicast
            (even after disabling media sense) set the UDP protocol's loopback attribute to true
            
            - If your CacheMode is set to REPL_SYNC we recommend you comment 
            out the FC (flow control) protocol 
            --&gt;
            &lt;config&gt;
                &lt;UDP mcast_addr="${jboss.partition.udpGroup:230.1.2.7}" 
                     mcast_port="${jboss.webpartition.mcast_port:45577}"
		             tos="8"
		             ucast_recv_buf_size="20000000"
		             ucast_send_buf_size="640000"
		             mcast_recv_buf_size="25000000"
		             mcast_send_buf_size="640000"
		             loopback="false"
		             discard_incompatible_packets="true"
		             enable_bundling="true"
		             max_bundle_size="64000"
		             max_bundle_timeout="30"
		             use_incoming_packet_handler="true"
		             use_outgoing_packet_handler="false"
		             ip_ttl="${jgroups.udp.ip_ttl:2}"
		             down_thread="false" up_thread="false"/&gt;
		          &lt;PING timeout="2000"
		             down_thread="false" up_thread="false" num_initial_members="3"/&gt;
		          &lt;MERGE2 max_interval="100000"
		             down_thread="false" up_thread="false" min_interval="20000"/&gt;
		          &lt;FD_SOCK down_thread="false" up_thread="false"/&gt;
		          &lt;FD timeout="10000" max_tries="5" down_thread="false" up_thread="false" shun="true"/&gt;
		          &lt;VERIFY_SUSPECT timeout="1500" down_thread="false" up_thread="false"/&gt;
		          &lt;pbcast.NAKACK max_xmit_size="60000"
		                   use_mcast_xmit="false" gc_lag="0"
		                   retransmit_timeout="300,600,1200,2400,4800"
		                   down_thread="false" up_thread="false"
		                   discard_delivered_msgs="true"/&gt;
		          &lt;UNICAST timeout="300,600,1200,2400,3600"
		             down_thread="false" up_thread="false"/&gt;
		          &lt;pbcast.STABLE stability_delay="1000" desired_avg_gossip="50000"
		                   down_thread="false" up_thread="false"
		                   max_bytes="400000"/&gt;
		          &lt;pbcast.GMS print_local_addr="true" join_timeout="3000"
		                   down_thread="false" up_thread="false"
		                   join_retry_timeout="2000" shun="true"
		                   view_bundling="true"
		                   view_ack_collection_timeout="5000"/&gt;
		          &lt;FC max_credits="2000000" down_thread="false" up_thread="false"
		              min_threshold="0.10"/&gt;
		          &lt;FRAG2 frag_size="60000" down_thread="false" up_thread="false"/&gt;
		          &lt;pbcast.STATE_TRANSFER down_thread="false" up_thread="false" use_flush="false"/&gt;
           &lt;/config&gt;

           &lt;!-- 
               Alternate TCP stack: customize it for your environment, 
               change bind_addr and initial_hosts --&gt;
           &lt;!--
           &lt;config&gt;
                &lt;TCP bind_addr="thishost" start_port="7810" loopback="true"
                     tcp_nodelay="true"
	                 recv_buf_size="20000000"
	                 send_buf_size="640000"
	                 discard_incompatible_packets="true"
	                 enable_bundling="true"
	                 max_bundle_size="64000"
	                 max_bundle_timeout="30"
	                 use_incoming_packet_handler="true"
	                 use_outgoing_packet_handler="false"
	                 down_thread="false" up_thread="false"
	                 use_send_queues="false"
	                 sock_conn_timeout="300"
	                 skip_suspected_members="true"/&gt;
	            &lt;TCPPING initial_hosts="thishost[7810],otherhost[7810]" port_range="3"
	                     timeout="3000"
	                     down_thread="false" up_thread="false"
	                     num_initial_members="3"&gt;
	            &lt;MERGE2 max_interval="100000"
	                    down_thread="false" up_thread="false" min_interval="20000"/&gt;
	            &lt;FD_SOCK down_thread="false" up_thread="false"/&gt;
	            &lt;FD timeout="10000" max_tries="5" down_thread="false" up_thread="false" shun="true"/&gt;
	            &lt;VERIFY_SUSPECT timeout="1500" down_thread="false" up_thread="false"/&gt;
	            &lt;pbcast.NAKACK max_xmit_size="60000"
	                           use_mcast_xmit="false" gc_lag="0"
	                           retransmit_timeout="300,600,1200,2400,4800"
	                           down_thread="false" up_thread="false"
	                           discard_delivered_msgs="true"/&gt;
	            &lt;pbcast.STABLE stability_delay="1000" desired_avg_gossip="50000"
	                           down_thread="false" up_thread="false"
	                           max_bytes="400000"/&gt;
	            &lt;pbcast.GMS print_local_addr="true" join_timeout="3000"
	                        down_thread="false" up_thread="false"
	                        join_retry_timeout="2000" shun="true"
	                        view_bundling="true"/&gt;
	            &lt;FC max_credits="2000000" down_thread="false" up_thread="false"
	                min_threshold="0.10"/&gt;
	            &lt;FRAG2 frag_size="60000" down_thread="false" up_thread="false"/&gt;
	            &lt;pbcast.STATE_TRANSFER down_thread="false" up_thread="false" use_flush="false"/&gt;
           &lt;/config&gt;
           --&gt;

  &lt;/attribute&gt;
        
				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>JBossEAP6の場合もJBossEAP4.3と同様に、JGroupsを利用し、デフォルトでUDPプロトコルを利用したJGroupsプロトコルスタックが利用される。
			
		</p>
</div>
<br>
<br>
<a name="tubame_2.5.1.2." id="category_84"></a>
<h3 class="title">2.5.1.2.JGroupsのFC設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossのFC(フローコントロール) は、特定のクラスタノードに一時的な過負荷が発生した場合、クラスタ全体を
スローダウンさせて、OutOfMemoryErrorなどの致命的なエラーの発生を回避する機能である。</p>
<p>

</p>
<div class="figure">
<a name="N162A1"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP4.3のJGroupsのFC設定($JBoss_HOME/myserver/deploy/jboss-web-cluster.sar/META-INF/jboss-service.xml)
	</b>
</p>
<div class="figure-contents">
<pre class="programlisting">

		
...
 &lt;attribute name="ClusterConfig"&gt;
            &lt;!--
            The default UDP stack:
            - If you have a multihomed machine, set the UDP protocol's bind_addr attribute to the
            appropriate NIC IP address, e.g bind_addr="192.168.0.2".
            - On Windows machines, because of the media sense feature being broken with multicast
            (even after disabling media sense) set the UDP protocol's loopback attribute to true
            
            - If your CacheMode is set to REPL_SYNC we recommend you comment 
            out the FC (flow control) protocol 
            --&gt;
            &lt;config&gt;
                &lt;UDP mcast_addr="${jboss.partition.udpGroup:230.1.2.7}" 
                     mcast_port="${jboss.webpartition.mcast_port:45577}"
		             tos="8"
		             ucast_recv_buf_size="20000000"
		             ucast_send_buf_size="640000"
		             mcast_recv_buf_size="25000000"
		             mcast_send_buf_size="640000"
		             loopback="false"
		             discard_incompatible_packets="true"
		             enable_bundling="true"
		             max_bundle_size="64000"
		             max_bundle_timeout="30"
		             use_incoming_packet_handler="true"
		             use_outgoing_packet_handler="false"
		             ip_ttl="${jgroups.udp.ip_ttl:2}"
		             down_thread="false" up_thread="false"/&gt;
		          ...
		          &lt;FC max_credits="2000000" down_thread="false" up_thread="false"
		              min_threshold="0.10"/&gt;
		          ...
           &lt;/config&gt;

          ...

  &lt;/attribute&gt;
        
	</pre>
</div>
</div>
<p>
<br class="figure-break">

</p>
</div>
<br>
<br>
<a name="tubame_2.5.2." id="category_85"></a>
<h3 class="title">2.5.2.レプリケーション設定の移行</h3>
<br>
<br>
<a name="tubame_2.5.2.1." id="category_86"></a>
<h3 class="title">2.5.2.1.レプリケーションのモード設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
<a name="repli-mode-setting"></a>JBossEAP4.3のレプリケーションのモード設定は、
			セッション情報がクラスタグループ内の全てのノードに対して複製されるAll-to-Allレプリケーション及び
			一部のサーバにデータの複製をクラスタグループ内のノードへ配布するBuddyレプリケーションが設定可能である。
		</p>
<p>
			レプリケーションモードの設定はJBossWebクラスタサービスのjboss-service.xmlのbuddyReplicationEnabledタグがfalseに設定されてるため、
			デフォルトでAll-to-Allレプリケーションが設定される。

			</p>
<div class="figure">
<a name="N162BA"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBoss4.3のレプリケーションモード設定($JBoss_HOME/myserver/deploy/jboss-web-cluster.sar/META-INF/jboss-service.xml)
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">

					
...
&lt;attribute name="BuddyReplicationConfig"&gt;
	&lt;config&gt;
		&lt;buddyReplicationEnabled&gt;false&lt;/buddyReplicationEnabled&gt;
		&lt;buddyLocatorClass&gt;org.jboss.cache.buddyreplication.NextMemberBuddyLocator
		&lt;/buddyLocatorClass&gt;
		&lt;buddyLocatorProperties&gt;
			numBuddies = 1
			ignoreColocatedBuddies = true
		&lt;/buddyLocatorProperties&gt;

		&lt;buddyPoolName&gt;default&lt;/buddyPoolName&gt;
		&lt;buddyCommunicationTimeout&gt;2000&lt;/buddyCommunicationTimeout&gt;

		&lt;autoDataGravitation&gt;false&lt;/autoDataGravitation&gt;
		&lt;dataGravitationRemoveOnFind&gt;true&lt;/dataGravitationRemoveOnFind&gt;
		&lt;dataGravitationSearchBackupTrees&gt;true
		&lt;/dataGravitationSearchBackupTrees&gt;

	&lt;/config&gt;
&lt;/attribute&gt;
...
				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossEAP6のレプリケーションモードは、All-to-AllレプリケーションとBuddyレプリケーション相当のdistributedレプリケーション
			が存在する。JBossEAP6のデフォルトでは、All-to-Allレプリケーションが利用される。

			</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					JBossEAP6のstanaloneプロファイルでは、クラスタリングで必要なjgroupsなどの設定が含まれないため、注意すること。
					
				</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.5.2.2." id="category_87"></a>
<h3 class="title">2.5.2.2.レプリケーションの同期設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のレプリケーションの同期設定は、JBossWebクラスタサービスのjboss-service.xmlのCacheModeにより設定される。
			デフォルトはREPL_ASYNCで非同期モードでレプリケーションされる。REPL_SYNCの場合は同期モードになる。

			</p>
<div class="figure">
<a name="N162D6"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossのレプリケーション同期設定($JBoss_HOME/myserver/deploy/jboss-web-cluster.sar/META-INF/jboss-service.xml)
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">

					
&lt;server&gt;

    &lt;!-- ==================================================================== --&gt;
    &lt;!-- Defines TreeCache configuration                                      --&gt;
    &lt;!-- ==================================================================== --&gt;

	 &lt;!-- Note we are using TreeCacheAop --&gt;
    &lt;mbean code="org.jboss.cache.aop.TreeCacheAop"
        name="jboss.cache:service=TomcatClusteringCache"&gt;
        ...
        &lt;!-- Valid modes are LOCAL, REPL_ASYNC and REPL_SYNC
             
             If you use REPL_SYNC and a UDP-based ClusterConfig
             we recommend you comment out the FC (flow control)
             protocol in the ClusterConfig section below.
        --&gt;
        &lt;attribute name="CacheMode"&gt;REPL_ASYNC&lt;/attribute&gt;
				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossEAP6の場合は TODO:
		</p>
</div>
<br>
<br>
<a name="tubame_2.6." id="category_88"></a>
<h3 class="title">2.6.サーバログ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のサーバログにはlog4j実装を利用。サーバログ設定を以下のファイルに設定する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのサーバログ設定</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBOSS_HOME/myserver/conf/jboss-log4j.xml</p>
</li>
</ul>
</div>
<p>

		
</p>
<p>
			JBossEAP6のサーバログにはJBossのlogging実装が利用され、JBossEAP6のログは、ログカテゴリ（ルートロガー）とログハンドラを利用して、設定を行う。

			JBossEAP4のアペンダとJBossEAP6のハンドラの対応関係を示す。


			</p>
<div class="table">
<a name="N162F7"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JBossEAP4.3アペンダとJBossEAP6ハンドラの対応</b>
</p>
<div class="table-contents">
<table summary="JBossEAP4.3アペンダとJBossEAP6ハンドラの対応" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>JBossEAP4.3のアペンダ</th><th>JBossEAP6のハンドラ</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>FILE(org.jboss.logging.appender.DailyRollingFileAppender)
							</td><td>file-handler(periodic-rotating-file-handler)</td><td>file-handlerはデフォルトではperiodic-rotating-file-handlerが設定。指定期間が過ぎたらファイル名にタイムスタンプを追加して変更し、元の名前で新しいログファイルを作成して継続的にログを出力する。file-handlerには、periodic-rotating-file-handlerのほかにsize-rotating-flle-handlerも設定可能。size-rotating-flle-handlerは、ファイルが指定されたサイズに達した場合は、数値の接頭辞付きの名前に変更し、元の名前で新しいログファイルを作成して継続的にログを出力する
							</td>
</tr>
<tr>
<td>CONSOLE(org.apache.log4j.ConsoleAppender)</td><td>console-handler</td><td>ログを標準出力（stdout）または標準エラー出力（stderr）ストリームのいずれかに出力する。</td>
</tr>
<tr>
<td>ASYNC(org.apache.log4j.AsyncAppender)</td><td>async-handler</td><td>非同期ログを出力することができる。高遅延またはネットワークファイルシステムにログファイルを書き込むといったパフォーマンス上の問題がある場合には有用である。
							</td>
</tr>
<tr>
<td>SMTP(org.apache.log4j.net.SMTPAppender)</td><td>該当ハンドラなし
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>SYSLOG(org.apache.log4j.net.SyslogAppender)</td><td>syslog-handler</td><td>リモートのロギングサーバにログメッセージを送信することができる。複数のサーバのログを同一サーバにまとめることができる。
							</td>
</tr>
<tr>
<td>JMS(org.apache.log4j.net.JMSAppender)</td><td>該当ハンドラなし</td><td>&nbsp;</td>
</tr>
<tr>
<td>JMS(org.apache.log4j.net.JMSAppender)</td><td>該当ハンドラなし</td><td>&nbsp;</td>
</tr>
<tr>
<td>TRAP_LOG(org.apache.log4j.ext.SNMPTrapAppender)</td><td>該当ハンドラなし</td><td>&nbsp;</td>
</tr>
<tr>
<td>JMX(org.jboss.monitor.services.JMXNotificationAppender)
							</td><td>該当ハンドラなし</td><td>&nbsp;</td>
</tr>
<tr>
<td>CLUSTER(org.jboss.logging.appender.RollingFileAppender)
							</td><td>該当ハンドラなし</td><td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.7." id="category_144"></a>
<h3 class="title">2.7.EJBコンテナの移行</h3>
<br>
<br>
<a name="tubame_2.7.1." id="category_181"></a>
<h3 class="title">2.7.1.Beanのインスタンスプールの設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>EJBコンテナは、Beanのインスタンスをインスタンスプールから取得する。このBeanのインスタンスプール設定はデプロイメントデスクリプタのjboss.xmlで明示的に設定しない限り、$jboss.home/{profile}/conf/standardjboss.xmlにある設定からフォルトが適用され、インスタンスプールのサイズが決定される。</p>
<p>本書では以下のケースのBeanインスタンスプール設定をJBoss EAP6の管理CLIで設定する方法を示す。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>デプロイメントデスクリプタjboss.xmlで明示的にインスタンスプールのチューニングをしていない場合</p>
</li>
<li class="listitem">
<p>デプロイメントデスクリプタjboss.xmlで明示的にインスタンスプールのチューニングをしている場合</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_2.7.1.1." id="category_182"></a>
<h3 class="title">2.7.1.1.SLSBインスタンスプールの設定移行</h3>
<br>
<br>
<a name="tubame_2.7.1.1.1." id="category_183"></a>
<h3 class="title">2.7.1.1.1.SLSBインスタンスプール設定移行(インスタンスプール未設定)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4では$jboss.home/{profile}/conf/standardjboss.xmlの以下のコンテナ設定にしたがって、インスタンスプールの設定が行われる。standardjboss.xmlで設定を行っていない場合は、インスタンスプールのサイズの最大値に100が設定される。JBoss
			EAP 6ではデフォルトのインスタンスプールのサイズの最大値が20のため、ここではJBoss EAP 4 のデフォルトで適用される値(100)を設定する方法を示す。</p>
<div class="figure">
<a name="N16BB9"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBoss EAP4のstandardjboss.xmlによるSLSBのデフォルトコンテナ設定例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE jboss PUBLIC
   "-//JBoss//DTD JBOSS 4.2//EN"
   "http://www.jboss.org/j2ee/dtd/jboss_4_2.dtd"&gt;
&lt;jboss&gt;
    &lt;container-configurations&gt;
    &lt;container-configuration&gt;
      &lt;container-name&gt;Standard Stateless SessionBean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;stateless-unified-invoker&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.SecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.StatelessSessionInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.StatelessSessionInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.TxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.StatelessSessionInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

    &lt;container-configuration&gt;
      &lt;container-name&gt;Clustered Stateless SessionBean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;clustered-stateless-unified-invoker&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.CleanShutdownInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.SecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.StatelessSessionInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.StatelessSessionInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.TxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.StatelessSessionInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
      &lt;cluster-config&gt;
         &lt;partition-name&gt;${jboss.partition.name:DefaultPartition}&lt;/partition-name&gt;
      &lt;/cluster-config&gt;
    &lt;/container-configuration&gt;
  &lt;/container-configurations&gt;
&lt;/jboss&gt;
			</pre>
</div>
</div>
<br class="figure-break">
<p>JBoss EAP6のデフォルトのインスタンスプール設定は管理CLIにより設定する。jboss-ejb3.xmlなどで明示的にインスタンスプールの設定をしなかった場合にはこの設定がBeanに適用される。</p>
<div class="figure">
<a name="N16BC5"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBoss EAP6の管理CLIにおけるSLSBのデフォルトインスタンスプール設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
/subsystem=ejb3/strict-max-bean-instance-pool=slsb-strict-max-pool:write-attribute(name=max-pool-size,value=100)
			</pre>
</div>
</div>
<br class="figure-break">
</div>
<br>
<br>
<a name="tubame_2.7.1.1.2." id="category_184"></a>
<h3 class="title">2.7.1.1.2.SLSBインスタンスプール設定移行(インスタンスプール設定あり)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>jboss.xmlのcontainer-configurationタグのextends属性で&rdquo;Standard Stateless SessionBean&rdquo;を指定している場合、$jboss.home/{profile}/conf/standardjboss.xmlで設定しているコンテナ設定の&rdquo;Standard Stateful SessionBean&rdquo;を拡張して、Beanインスタンスプールのサイズをカスタマイズしている可能性がある。このようにjboss.xmlでBean固有のインスタンスプールのサイズをカスタマイズしている場合、以下の移行作業を行う必要がある。
        </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>管理CLIよりBean固有のインスタンスプールの登録を行い、インスタンスプールの設定を行う。インスタンスプール名は任意である。例としてBean「CustomerService」のプールを設定するとして「CustomerServicePool」とする
                </p>
</li>
</ul>
</div>
<div class="figure">
<a name="N16BDF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP5におけるインスタンスプール設定例(jboss.xml)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;enterprise-beans&gt;
&lt;session&gt;
  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
  &lt;jndi-name&gt;△△△&lt;/jndi-name&gt;
  &lt;configuration-name&gt;XXX Stateless Session Bean&lt;/configuration-name&gt;
    &lt;/session&gt;
&lt;/enterprise-beans&gt;

&lt;container-configurations&gt;
  &lt;container-configuration
    extends =&rdquo;Standard Stateless SessionBean&rdquo;&gt;
    &lt;container-name&gt;XXX Stateless Session Bean&lt;/container-name&gt;
    &lt;container-pool-conf&gt;                                 
      &lt;MinimumSize&gt;□□□&lt;/MinimumSize&gt;                   
      &lt;MaximumSize&gt;■■■&lt;/MaximumSize&gt;                                    
    &lt;/container-pool-conf&gt;
  &lt;/container-configurations&gt;
&lt;/jboss&gt;
            </pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N16BE9"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;</b>
</p>
<div class="figure-contents">
<p>JBoss EAP6のEJBにBean固有のインスタンスプール設定する場合、管理CLIによりBean固有のインスタンスプールを登録する。なお、ここで登録したプールをBeanに適用する場合は、EJBのデプロイメントデスクリプタjboss-ejb3.xmlでインスタンスプールの設定を行う必要がある。</p>
<pre class="programlisting">
				
/subsystem=ejb3/strict-max-bean-instance-pool=CustomerServicePool:add (max-pool-size=100)
			</pre>
</div>
</div>
<br class="figure-break">
</div>
<br>
<br>
<a name="tubame_2.7.1.2." id="category_185"></a>
<h3 class="title">2.7.1.2.MDBインスタンスプールの設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBoss EAP
			4では$jboss.home/{profile}/conf/standardjboss.xmlの以下のコンテナ設定にしたがって、インスタンスプールの設定が行われる。standardjboss.xmlで設定を行っていない場合は、インスタンスプールのサイズの最大値に100が設定される。JBoss
			EAP
			6ではデフォルトのインスタンスプールのサイズの最大値が20のため、ここではEAP4のデフォルトで適用される値を設定(100）を設定する方法を示す。
		</p>
<div class="figure">
<a name="N16BFF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBoss EAP4のstandardjboss.xmlによるMDBのデフォルトコンテナ設定例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE jboss PUBLIC
   "-//JBoss//DTD JBOSS 4.2//EN"
   "http://www.jboss.org/j2ee/dtd/jboss_4_2.dtd"&gt;
&lt;jboss&gt;
    
    &lt;container-configuration&gt;
      &lt;container-name&gt;Standard Message Driven Bean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;message-driven-bean&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.RunAsSecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.MessageDrivenInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

    &lt;container-configuration&gt;
      &lt;container-name&gt;Singleton Message Driven Bean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;singleton-message-driven-bean&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.RunAsSecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.MessageDrivenInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

    &lt;container-configuration&gt;
      &lt;container-name&gt;Standard Message Inflow Driven Bean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;message-inflow-driven-bean&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.RunAsSecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInrceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.MessageDrivenInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

  &lt;/container-configurations&gt;

&lt;/jboss&gt;
			</pre>
</div>
</div>
<br class="figure-break">
<p>JBoss
			EAP6のデフォルトのインスタンスプール設定は管理CLIにより設定する。jboss-ejb3.xmlなどで明示的にインスタンスプールの設定をしなかった場合にはこの設定がBeanに適用される。
		</p>
<p></p>
<pre class="programlisting">
			
/subsystem=ejb3/strict-max-bean-instance-pool=mdb-strict-max-pool:write-attribute(name=max-pool-size,value=100)
		</pre>
</div>
<br>
<br>
<a name="tubame_2.7.1.2.1." id="category_186"></a>
<h3 class="title">2.7.1.2.1.MDBインスタンスプール設定移行(インスタンスプール未設定)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBoss EAP
			4では$jboss.home/{profile}/conf/standardjboss.xmlの以下のコンテナ設定にしたがって、インスタンスプールの設定が行われる。standardjboss.xmlで設定を行っていない場合は、インスタンスプールのサイズの最大値に100が設定される。JBoss
			EAP 6ではデフォルトのインスタンスプールのサイズの最大値が20のため、ここではEAP4のデフォルトで適用される値を設定(100）を設定する方法を示す。</p>
<div class="figure">
<a name="N16C1F"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBoss EAP4のstandardjboss.xmlによるMDBのデフォルトコンテナ設定例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE jboss PUBLIC
   "-//JBoss//DTD JBOSS 4.2//EN"
   "http://www.jboss.org/j2ee/dtd/jboss_4_2.dtd"&gt;
&lt;jboss&gt;
    
    &lt;container-configuration&gt;
      &lt;container-name&gt;Standard Message Driven Bean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;message-driven-bean&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.RunAsSecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.MessageDrivenInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

    &lt;container-configuration&gt;
      &lt;container-name&gt;Singleton Message Driven Bean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;singleton-message-driven-bean&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.RunAsSecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.MessageDrivenInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

    &lt;container-configuration&gt;
      &lt;container-name&gt;Standard Message Inflow Driven Bean&lt;/container-name&gt;
      &lt;call-logging&gt;false&lt;/call-logging&gt;
      &lt;invoker-proxy-binding-name&gt;message-inflow-driven-bean&lt;/invoker-proxy-binding-name&gt;
      &lt;container-interceptors&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.LogInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.ejb.plugins.RunAsSecurityInterceptor&lt;/interceptor&gt;
        &lt;!-- CMT --&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.TxInterceptorCMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.CallValidationInrceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Container"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;!-- BMT --&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&lt;/interceptor&gt;
        &lt;interceptor transaction="Bean"&gt;org.jboss.ejb.plugins.CallValidationInterceptor&lt;/interceptor&gt;
        &lt;interceptor&gt;org.jboss.resource.connectionmanager.CachedConnectionInterceptor&lt;/interceptor&gt;
      &lt;/container-interceptors&gt;
      &lt;instance-pool&gt;org.jboss.ejb.plugins.MessageDrivenInstancePool&lt;/instance-pool&gt;
      &lt;instance-cache&gt;&lt;/instance-cache&gt;
      &lt;persistence-manager&gt;&lt;/persistence-manager&gt;
      &lt;container-pool-conf&gt;
        &lt;MaximumSize&gt;100&lt;/MaximumSize&gt;
      &lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;

  &lt;/container-configurations&gt;

&lt;/jboss&gt;
			</pre>
</div>
</div>
<br class="figure-break">
<p>JBoss EAP6のデフォルトのインスタンスプール設定は管理CLIにより設定する。jboss-ejb3.xmlなどで明示的にインスタンスプールの設定をしなかった場合にはこの設定がBeanに適用される。</p>
<p></p>
<pre class="programlisting">
                
/subsystem=ejb3/strict-max-bean-instance-pool=mdb-strict-max-pool:write-attribute(name=max-pool-size,value=100)
            </pre>
</div>
<br>
<br>
<a name="tubame_2.7.1.2.2." id="category_187"></a>
<h3 class="title">2.7.1.2.2.MDBインスタンスプール設定移行(インスタンスプール設定あり)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>jboss.xmlのcontainer-configurationタグのextends属性で&rdquo;Standard Message Driven Bean&rdquo;を指定している場合、$jboss.home/{profile}/conf/standardjboss.xmlで設定しているコンテナ設定の&rdquo;Standard Stateful SessionBean&rdquo;を拡張して、Beanインスタンスプールのサイズをカスタマイズしている可能性がある。このようにjboss.xmlでBeanインスタンスプールのサイズをカスタマイズしてい場合、以下の移行作業を行う必要がある。
        </p>
<div class="figure">
<a name="N16C3F"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP5におけるインスタンスプール設定例(jboss.xml)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;enterprise-beans&gt;
    &lt;message-driven&gt;
      &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
      &lt;destination-jndi-name&gt;●●●&lt;/destination-jndi-name&gt;
      &lt;configuration-name&gt;Message Driven Bean&lt;/configuration-name&gt;
    &lt;/message-driven&gt;
  &lt;/enterprise-beans&gt;
  &lt;container-configurations&gt;
    &lt;container-configuration extends="Standard Message Driven Bean"&gt;
      &lt;container-name&gt;Message Driven Bean&lt;/container-name&gt;
		&lt;invoker-proxy-binding-name&gt;
		message-driven-bean
		&lt;/invoker-proxy-binding-name&gt;
		&lt;container-pool-conf&gt;                                    
			&lt;MinimumSize&gt;□□□&lt;/MinimumSize&gt;                      
			&lt;MaximumSize&gt;△△△&lt;/MaximumSize&gt;             
		&lt;/container-pool-conf&gt;
    &lt;/container-configuration&gt;
  &lt;/container-configurations&gt;
            </pre>
</div>
</div>
<br class="figure-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>jboss.xmlで定義しているcontainer-configurationsのタグ全体を削除する</p>
</li>
<li class="listitem">
<p>デプロイメントデスクリプタファイル(jboss-ejb3.xml）を作成し、該当Beanに対してインスタンスプールのリファレンス設定を行う。ここではbean-instance-pool-refで設定する値は{Bean名}Poolとする</p>
</li>
<li class="listitem">
<p>管理CLIによりインスタンスプールの登録を行う。インスタンスプール名は上記のbean-instance-pool-refで設定した値を利用する</p>
</li>
</ul>
</div>
<p>JBoss EAP6のEJBにBean固有のインスタンスプール設定する場合、管理CLIによりBean固有のインスタンスプールを登録する。なお、ここで登録したプールをBeanに適用する場合は、EJBのデプロイメントデスクリプタjboss-ejb3.xmlでインスタンスプールの設定を行う必要がある。</p>
<pre class="programlisting">
                
/subsystem=ejb3/strict-max-bean-instance-pool=QueueReciverBeanPool:add (max-pool-size=100)
            </pre>
</div>
<br>
<br>
<a name="tubame_2.7.2." id="category_145"></a>
<h3 class="title">2.7.2.EntityBeanコンテナ設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではEntityBeanコンテナ設定を以下のファイルに設定する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>EntityBeanのコンテナ設定</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBOSS_HOME/myserver/conf/standardjbosscmp-jdbc</p>
</li>
</ul>
</div>
<p>


		
</p>
<p>
			JBossEAP6ではこの設定ファイルがJBossモジュールとしてjboss-as-cmp-*.jarに同梱されており、直接、設定ファイルを変更できない。このため、EntityBean用の設定をstandardjbosscmp-jdbc.xmlでチューニングしている場合は、jbosscmp-jdbc.xmlファイルのjbosscmp-jdbc/defaultsタグで設定する必要がある。
			</p>
<div class="figure">
<a name="N165BF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;jboss-as-cmp-*.jarに同梱されいるstandardjbosscmp-jdbc.xmlのdefaults設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jbosscmp-jdbc&gt;

    &lt;defaults&gt;
        &lt;datasource&gt;java:jboss/datasources/ExampleDS&lt;/datasource&gt;
        &lt;datasource-mapping&gt;Hypersonic SQL&lt;/datasource-mapping&gt;

        &lt;create-table&gt;true&lt;/create-table&gt;
        &lt;remove-table&gt;false&lt;/remove-table&gt;
        &lt;read-only&gt;false&lt;/read-only&gt;
        &lt;read-time-out&gt;300000&lt;/read-time-out&gt;
        &lt;row-locking&gt;false&lt;/row-locking&gt;
        &lt;pk-constraint&gt;true&lt;/pk-constraint&gt;
        &lt;fk-constraint&gt;false&lt;/fk-constraint&gt;
        &lt;preferred-relation-mapping&gt;foreign-key&lt;/preferred-relation-mapping&gt;
        &lt;read-ahead&gt;
            &lt;strategy&gt;on-load&lt;/strategy&gt;
            &lt;page-size&gt;1000&lt;/page-size&gt;
            &lt;eager-load-group&gt;*&lt;/eager-load-group&gt;
        &lt;/read-ahead&gt;
        &lt;list-cache-max&gt;1000&lt;/list-cache-max&gt;
        &lt;clean-read-ahead-on-load&gt;false&lt;/clean-read-ahead-on-load&gt;

        &lt;unknown-pk&gt;
            &lt;key-generator-factory&gt;UUIDKeyGeneratorFactory&lt;/key-generator-factory&gt;
            &lt;unknown-pk-class&gt;java.lang.String&lt;/unknown-pk-class&gt;
            &lt;jdbc-type&gt;VARCHAR&lt;/jdbc-type&gt;
            &lt;sql-type&gt;VARCHAR(32)&lt;/sql-type&gt;
        &lt;/unknown-pk&gt;

        &lt;entity-command name="default"/&gt;
        &lt;ql-compiler&gt;org.jboss.as.cmp.jdbc.JDBCEJBQLCompiler&lt;/ql-compiler&gt;
        &lt;throw-runtime-exceptions&gt;false&lt;/throw-runtime-exceptions&gt;
    &lt;/defaults&gt;
    ...
&lt;/jbosscmp-jdbc&gt;
    
				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_2.8." id="category_151"></a>
<h3 class="title">2.8.セキュリティ設定移行</h3>
<br>
<br>
<a name="tubame_2.8.1." id="category_152"></a>
<h3 class="title">2.8.1.セキュリティドメイン移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3は、セキュリティドメイン設定を以下のファイルに設定する。

			</p>
<div class="itemizedlist">
<p class="title">
<b>JBossのサーバログ設定</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/conf/jboss-log4j.xml</p>
</li>
</ul>
</div>
<p>
			セキュリティドメイン設定では、JBossが提供するログインモジュールの設定が行われる。アプリケーションでJBossが提供するログインモジュールを利用している場合は、JBossEAP6でも
			同等な認証機能が実現可能か、別途検討する必要がある。
			
			
		</p>
</div>
<br>
<br>
<a name="tubame_3."></a>
<h2 class="title">3.アプリケーション移行</h2>
<br>
<a name="tubame_3.1." id="category_34"></a>
<h3 class="title">3.1.Servlet移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3はServlet仕様がServlet 2.4であり、JBossEAP6は <span class="command"><strong><a class="command" href="http://download.oracle.com/otndocs/jcp/servlet-3.0-fr-oth-JSpec/" target="_top">Servlet 3.0</a></strong></span>である。Servlet仕様で非推奨となったAPIについて、代替APIを利用するように変更する。

			</p>
</div>
<br>
<br>
<a name="tubame_3.1.1." id="category_35"></a>
<h3 class="title">3.1.1.Servlet非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>チェック対象は非推奨となったAPIである。以下のドキュメントを参照して、代替APIを利用するように変更する。</p>
<p>
                        
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html</a></strong></span>
                    
</p>
</div>
<br>
<br>
<a name="tubame_3.1.2." id="category_36"></a>
<h3 class="title">3.1.2.Servlet下位互換パラメータ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3(Tomcat)では、Servlet下位互換のためにorg.apache.catalina.
			STRICT_SERVLET_COMPLIANCEというシステムプロパティがある。このプロパティはJBossEAP4.3及びJBossEAP6でもデフォルトでtrueとなり、移行後のJBossEAP6環境でとくに設定変更は必要ない。</p>
<p>
			
<span class="command"><strong><a class="command" href="https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html#Specifications" target="_top">https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html#Specifications
			</a></strong></span>
		
</p>
<div class="orderedlist">
<p class="title">
<b>TomcatのSTRICT_SERVLET_COMPLIANCEで有効になるパラメータと、JBossEAP4.3及びJBossEAP6での実装について</b>
</p>
<ol class="orderedlist" type="1">
<li class="listitem">
<p>org.apache.catalina.core.ApplicationContext.GET_RESOURCE_REQUIRE_SLASH</p>
<p>trueの場合、ServletContext.getResource()またはServletContext.getResourceAsStream() に渡されたパスは 、「/」で始まる必要がある。</p>
<p>JBossEAP4.3及びJBossEAP6(JBossWeb)にはこのシステムプロパティは存在しないが、JBossEAP4.3では、リソースのURLにスラッシュを必須としている。</p>
</li>
<li class="listitem">
<p>org.apache.catalina.core.ApplicationDispatcher.WRAP_SAME_OBJECT</p>
<p>trueの場合、アプリケーションディスパッチャに渡されるラップされたリクエストまたはレスポンスオブジェクトは、元のリクエストまたはレスポンスをラップしていることを保証するためにチェックされる。</p>
<p>JBossEAP4.3及びJBossEAP6(JBossWeb)にはこのシステムプロパティは存在しないが、STRICT_SERVLET_COMPLIANCEがtrueの場合は有効になる</p>
</li>
<li class="listitem">
<p>org.apache.catalina.core.StandardHostValve.ACCESS_SESSION</p>
<p>trueの場合、セッションに関連付けられているすべてのリクエストは、セッションの最終アクセス時刻を更新させる。これはリクエストが明示的にセッションにアクセスするかどうかに関係ない</p>
<p>JBossEAP4.3及びJBossEAP6(JBossWeb)にはこのシステムプロパティは存在しないが、STRICT_SERVLET_COMPLIANCEがtrueの場合は有効になる</p>
</li>
<li class="listitem">
<p>org.apache.catalina.session.StandardSession.ACTIVITY_CHECK</p>
<p>trueの場合、Tomcatは、各セッションのアクティブなリクエストの数を追跡する。</p>
<p>JBossEAP4.3及びJBossEAP6(JBossWeb)にはこのシステムプロパティは存在しないが、STRICT_SERVLET_COMPLIANCEがtrueの場合は有効になる</p>
</li>
<li class="listitem">
<p>org.apache.tomcat.util.http.ServerCookie.ALWAYS_ADD_EXPIRES</p>
<p>trueの場合、Tomcatはバージョン0 より後のCookie に対して、常にSetCookie ヘッダにexpire パラメータを追加する。これは、IE にSetCookie ヘッダ内のMax-Age パラメータを無視させるという、既知のIE6 とIE7 のバグの回避策である。</p>
<p>JBossEAP4.3(JBossWeb)にはこのシステムプロパティは存在しないが、JBossEAP6(JBossWeb)でこのパラメータが存在する</p>
</li>
</ol>
</div>
</div>
<br>
<br>
<a name="tubame_3.1.3." id="category_37"></a>
<h3 class="title">3.1.3.Servlet Cookieに関連する下位互換パラメータ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6(Tomcat)では、クッキーに関連する下位互換パラメータが存在する。業務アプリケーションにおけるクッキーに関連する仕様を確認し、
			必要に応じてクッキーに関連する下位互換パラメータを有効にする必要がある。
		</p>
<div class="itemizedlist">
<p class="title">
<b>JBossEAP6(Tomcat)で提供するクッキーに関連する下位互換パラメータ</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.apache.tomcat.util.http.
					ServerCookie.ALLOW_EQUALS_IN_VALUE</p>
<p>クッキーの値に=(イコール)を許可するかを指定。</p>
<p>JBossEAP4.3及びJBossEAP6でこのシステムプロパティは存在しない。クッキーの値の特殊文字を利用する場合は、以下のALLOW_HTTP_SEPARATORS_IN_V0を有効にして対応する。</p>
</li>
<li class="listitem">
<p>org.apache.tomcat.util.http.
					ServerCookie.ALLOW_HTTP_SEPARATORS_IN_V0</p>
<p>setCookie時に、クッキーのvalueに,: ()&lt;&gt;@:\"[]?={}\tの特殊文字があった場合にエラーとなり、デフォルトは許可しないが
					このパラメータを有効にすると、,: ()&lt;&gt;@:\"[]?={}\tの特殊文字があった場合にvalue全体をダブルクォートで囲む。</p>
<p>JBossEAP4.3では、このシステムプロパティは存在せず、JBossEAP6でこのシステムプロパティが存在する。
クッキーのvalueに特殊文字が含まれる場合、ALLOW_HTTP_SEPARATORS_IN_V0はfalseがデフォルトで設定され、
JBossEAP4.3上では許容されていたものが、移行後のJBossEAP6では許容されなくなり、エラーが発生する可能性がある。
この場合は、ALLOW_HTTP_SEPARATORS_IN_V0システムプロパティを有効にする必要がある。
					</p>
</li>
<li class="listitem">
<p>org.apache.tomcat.util.http.ServerCookie.FWD_SLASH_IS_SEPARATOR
				</p>
<p>クッキーの値の文字列に対して、スラッシュもエスケープする場合は、有効にする必要がある。
				</p>
<p>JBossEAP4.3(JBossWeb)は、このパラメータは存在せず、デフォルトでスラッシュをエスケープする。JBossEAP6は、このパラメータが存在し、スラッシュをエスケープしない。</p>
</li>
<li class="listitem">
<p>クッキー名のvalidationにRFC2109Validatorが利用される</p>
<p>JBossEAP4.3及びJBossEAP6にはこのValidatorは存在しないため、JBossEAP4.3からJBossEAP6への移植にあたっては検討する必要がない。</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_3.2." id="category_39"></a>
<h3 class="title">3.2.JSP移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3はJSP仕様がJSP 2.1であり、JBossEAP6はJSP　2.2である。Servlet仕様で非推奨となったAPIについて、代替APIを利用するように変更する。</p>
</div>
<br>
<br>
<a name="tubame_3.2.1." id="category_40"></a>
<h3 class="title">3.2.1.JSP非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>チェック対象は非推奨となったAPIである。以下のドキュメントを参照して、代替APIを利用するように変更する。</p>
<p>
                        
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html</a></strong></span>
                    
</p>
</div>
<br>
<br>
<a name="tubame_3.2.2." id="category_41"></a>
<h3 class="title">3.2.2.EL非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>チェック対象は非推奨となったAPIである。以下のドキュメントを参照して、代替APIを利用するように変更する。</p>
<p>
                        
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html</a></strong></span>
                    
</p>
</div>
<br>
<br>
<a name="tubame_3.2.3." id="category_42"></a>
<h3 class="title">3.2.3.JSP下位互換パラメータ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6ののJSP実装(jasper)は、JSP仕様への対応で、下位互換がなくなるものをシステムプロパティで対応可能としている。
		</p>
<p>
			
<span class="command"><strong><a class="command" href="https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html#Jasper" target="_top">https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html#Jasper
			</a></strong></span>
		
</p>
<div class="itemizedlist">
<p class="title">
<b>JSP仕様に関連するjasperのシステムプロパティ</b>
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.apache.jasper.compiler.Generator.STRICT_GET_PROPERTY</p>
<p>trueの場合、JSP2.0以降の仕様で規定され、JSPプロセッサに依存導入されたjsp:getPropertyアクションはオブジェクトリファレンスを持たなければならない。オブジェクトリファレンスを持たない場合エラーとなる。</p>
<p>
					参考：
					<span class="command"><strong><a class="command" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=48701" target="_top">https://bz.apache.org/bugzilla/show_bug.cgi?id=48701
					</a></strong></span>
				
</p>
<p>JBossEAP4.3ではこのシステムプロパティは存在せず、JBossEAP6でこのシステムプロパティが存在する。デフォルトはfalseとなるため、下位互換対応する場合は、有効にする必要がある。</p>
</li>
<li class="listitem">
<p>org.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING</p>
<p>falseの場合は、JSP属性に引用符をエスケープするための要件が緩和される。その結果、エスケープされていない引用符は、エラーを発生しなくなる</p>
<p>
					JBossEAP6ではスクリプトレット等でダブルクォートがあった場合にエスケープしない場合とエラーになる。
					参考：
					<span class="command"><strong><a class="command" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=45015" target="_top">https://bz.apache.org/bugzilla/show_bug.cgi?id=45015
					</a></strong></span>
				
</p>
<p>JBossEAP4.3ではこのシステムプロパティは存在せず、JBossEAP6でこのシステムプロパティが存在する。デフォルトでtrueとなる。</p>
</li>
<li class="listitem">
<p>org.apache.jasper.compiler.Parser.STRICT_WHITESPACE</p>
<p>falseの場合は、属性名の前に空白文字がない記述を許容する。</p>
<p>JBossEAP4.3及びJBossEAP6ではこのシステムプロパティは存在しない</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_3.3." id="category_29"></a>
<h3 class="title">3.3.JAVAEE非推奨APIの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3は、J2EE1.4仕様をサポートしており、JBossEAP6はJavaEE6をサポートしている</p>
<p>JavaEE6で非推奨となっているAPIについては、代替APIを利用するように変更する。
        </p>
</div>
<br>
<br>
<a name="tubame_3.3.1." id="category_33"></a>
<h3 class="title">3.3.1.Servlet、JSP以外の非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>チェック対象は非推奨となったAPIである。以下のドキュメントを参照して、代替APIを利用するように変更する。</p>
<p>
                        
<span class="command"><strong><a class="command" href="http://docs.oracle.com/javaee/6/api/deprecated-list.html" target="_top">http://docs.oracle.com/javaee/6/api/deprecated-list.html</a></strong></span>
                    
</p>
</div>
<br>
<br>
<a name="tubame_3.4." id="category_43"></a>
<h3 class="title">3.4.JNDI移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3では、JNDIに多くのリソースがバインドされており、アプリケーションからJNDIルックアップが可能となっている。
		</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossEAP4.3 JNDIバインドリソース</p>
<pre class="programlisting">
java: Namespace
+- ClusteredXAConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- jaas (class: javax.naming.Context)
| +- HsqlDbRealm (class:
org.jboss.security.plugins.SecurityDomainContext)
| +- messaging (class:
org.jboss.security.plugins.SecurityDomainContext)
| +- jmx-console (class:
org.jboss.security.plugins.SecurityDomainContext)
| +- JmsXARealm (class:
org.jboss.security.plugins.SecurityDomainContext)
+- TransactionPropagationContextImporter (class:
com.arjuna.ats.internal.jbossatx.jta.PropagationContextManager)
+- comp.ejb3 (class: javax.naming.Context)
| NonContext: null
+- JmsXA (class:
org.jboss.resource.adapter.jms.JmsConnectionFactoryImpl)
+- JBossCorbaNaming (class: org.omg.CosNaming.NamingContextExt)
+- DefaultDS (class: org.jboss.resource.adapter.jdbc.WrapperDataSource)
+- StdJMSPool (class: org.jboss.jms.asf.StdServerSessionPoolFactory)
+- TransactionManager (class:
com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate)
+- ClusteredConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- JBossCorbaPOA (class: org.omg.PortableServer.POA)
+- ConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- TransactionPropagationContextExporter (class:
com.arjuna.ats.internal.jbossatx.jta.PropagationContextManager)
+- DefaultJMSProvider (class: org.jboss.jms.jndi.JNDIProviderAdapter)
+- XAConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- JBossCorbaInterfaceRepositoryPOA (class: org.omg.PortableServer.POA)
+- Mail (class: javax.mail.Session)
+- comp.original (class: javax.namingMain.Context)
+- JBossCorbaORB (class: org.omg.CORBA.ORB)
+- timedCacheFactory (class: javax.naming.Context)

Global JNDI Namespace
+- ClusteredConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- XAConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- UserTransactionSessionFactory (proxy: $Proxy15 implements interface
org.jboss.tm.usertx.interfaces.UserTransactionSessionFactory)
+- console (class: org.jnp.interfaces.NamingContext)
| +- PluginManager (proxy: $Proxy58 implements interface
org.jboss.console.manager.PluginManagerMBean)
+- UUIDKeyGeneratorFactory (class:
org.jboss.ejb.plugins.keygenerator.uuid.UUIDKeyGeneratorFactory)
+- HAPartition (class: org.jnp.interfaces.NamingContext)
| +- DefaultPartition (class:
org.jboss.ha.framework.server.HAPartitionImpl)
+- topic (class: org.jnp.interfaces.NamingContext)
| +- testDurableTopic (class: org.jboss.jms.destination.JBossTopic)
| +- TopicWithOwnRedeliveryDelay (class:
org.jboss.jms.destination.JBossTopic)
| +- testTopic (class: org.jboss.jms.destination.JBossTopic)
| +- testDistributedTopic (class:
org.jboss.jms.destination.JBossTopic)
| +- TopicWithOwnDLQAndExpiryQueue (class:
org.jboss.jms.destination.JBossTopic)
| +- securedTopic (class: org.jboss.jms.destination.JBossTopic)
+- queue (class: org.jnp.interfaces.NamingContext)
| +- D (class: org.jboss.jms.destination.JBossQueue)
| +- C (class: org.jboss.jms.destination.JBossQueue)
| +- B (class: org.jboss.jms.destination.JBossQueue)
| +- A (class: org.jboss.jms.destination.JBossQueue)
| +- testQueue (class: org.jboss.jms.destination.JBossQueue)
| +- QueueWithOwnDLQAndExpiryQueue (class:
org.jboss.jms.destination.JBossQueue)
| +- PrivateDLQ (class: org.jboss.jms.destination.JBossQueue)
| +- ex (class: org.jboss.jms.destination.JBossQueue)
| +- PrivateExpiryQueue (class: org.jboss.jms.destination.JBossQueue)
| +- testDistributedQueue (class:
org.jboss.jms.destination.JBossQueue)
| +- DLQ (class: org.jboss.jms.destination.JBossQueue)
| +- QueueWithOwnRedeliveryDelay (class:
org.jboss.jms.destination.JBossQueue)
| +- ExpiryQueue (class: org.jboss.jms.destination.JBossQueue)
+- HASessionState (class: org.jnp.interfaces.NamingContext)
| +- Default (class:
org.jboss.ha.hasessionstate.server.HASessionStateImpl)
+- JAXR (class: org.apache.ws.scout.registry.ConnectionFactoryImpl)
+- ConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
+- UserTransaction (class:
org.jboss.tm.usertx.client.ClientUserTransaction)
+- invokers (class: org.jnp.interfaces.NamingContext)
| +- kwatanabe-PC (class: org.jnp.interfaces.NamingContext)
| | +- iiop (class: org.jboss.invocation.iiop.IIOPInvoker)
+- jmx (class: org.jnp.interfaces.NamingContext)
| +- invoker (class: org.jnp.interfaces.NamingContext)
| | +- RMIAdaptor (proxy: $Proxy57 implements interface
org.jboss.jmx.adaptor.rmi.RMIAdaptor,interface
org.jboss.jmx.adaptor.rmi.RMIAdaptorExt)
| +- rmi (class: org.jnp.interfaces.NamingContext)
| | +- RMIAdaptor[link -&gt; jmx/invoker/RMIAdaptor] (class:
javax.naming.LinkRef)
+- HiLoKeyGeneratorFactory (class:
org.jboss.ejb.plugins.keygenerator.hilo.HiLoKeyGeneratorFactory)
+- ClusteredXAConnectionFactory (class:
org.jboss.jms.client.JBossConnectionFactory)
		</pre>
</li>
</ul>
</div>
<p>JBossEAP6では管理CLIのjndi-viewコマンドを利用して、JNDIにバインドされている情報を確認できる。移行後の環境でもJBossのJNDIサービスにバインドされたオブジェクトを利用する場合は、JNDI名に変更がないか確認し、変更がある場合は、JNDI名を移植する。</p>
<div class="figure">
<a name="N15DD5"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLIのjndi-viewコマンド実行結果(standalone-full-haプロファイル)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
[standalone@2e3799aba350:9999 /] /subsystem=naming:jndi-view
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "java: contexts" =&gt; {
            "java:" =&gt; {
                "ConnectionFactory" =&gt; {
                    "class-name" =&gt; "org.hornetq.jms.client.HornetQJMSConnectionFactory",
                    "value" =&gt; "HornetQConnectionFactory [serverLocator=ServerLocatorImpl [initialConnectors=[TransportConfiguration(name=in-vm, factory=org-hornetq-core-remoting-impl-invm-InVMConnectorFactory) ?server-id=0], discoveryGroupConfiguration=null], clientID=null, dupsOKBatchSize=1048576, transactionBatchSize=1048576, readOnly=false]"
                },
                "JmsXA" =&gt; {
                    "class-name" =&gt; "java.lang.Object",
                    "value" =&gt; "?"
                },
                "TransactionManager" =&gt; {
                    "class-name" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate",
                    "value" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate@1ef13d9a"
                },
                "jms" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"queue" =&gt; {
                        "class-name" =&gt; "javax.naming.Context",
                        "children" =&gt; {
                            "DLQ" =&gt; {
                                "class-name" =&gt; "org.hornetq.jms.client.HornetQQueue",
                                "value" =&gt; "HornetQQueue[DLQ]"
                            },
                            "ExpiryQueue" =&gt; {
                                "class-name" =&gt; "org.hornetq.jms.client.HornetQQueue",
                                "value" =&gt; "HornetQQueue[ExpiryQueue]"
                            }
                        }
                    }}
                },
                "jboss" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "value" =&gt; "org.jboss.as.naming.WritableServiceBasedNamingStore@6692872c"
                },
                "ejb" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"mgmt" =&gt; {
                        "class-name" =&gt; "javax.naming.Context",
                        "children" =&gt; {"MEJB" =&gt; {
                            "class-name" =&gt; "javax.management.j2ee.ManagementHome",
                            "value" =&gt; "Proxy for remote EJB EJBHomeLocator{appName='jsr-77', moduleName='jsr-77', distinctName='', beanName='EJB', view='interface javax.management.j2ee.ManagementHome'}"
                        }}
                    }}
                }
            },
            "java:jboss" =&gt; {
                "ORB" =&gt; {
                    "class-name" =&gt; "org.jacorb.orb.ORB",
                    "value" =&gt; "org.jacorb.orb.ORB@76d85c1a"
                },
                "TransactionManager" =&gt; {
                    "class-name" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate",
                    "value" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate@1ef13d9a"
                },
                "TransactionSynchronizationRegistry" =&gt; {
                    "class-name" =&gt; "com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionSynchronizationRegistryImple",
                    "value" =&gt; "com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionSynchronizationRegistryImple@12f8c201"
                },
                "UserTransaction" =&gt; {
                    "class-name" =&gt; "org.jboss.tm.usertx.client.ServerVMClientUserTransaction",
                    "value" =&gt; "org.jboss.tm.usertx.client.ServerVMClientUserTransaction@aff933f"
                },
                "corbanaming" =&gt; {
                    "class-name" =&gt; "org.omg.CosNaming._NamingContextExtStub",
                    "value" =&gt; "IOR:000000000000002B49444C3A6F6D672E6F72672F436F734E616D696E672F4E616D696E67436F6E746578744578743A312E3000000000000100000000000000B0000102000000000A3132372E302E302E31000DC8000000114A426F73732F4E616D696E672F726F6F74000000000000040000000000000008000000004A414300000000010000020000000000001000100000001050100010001010900000002050100010001010000000014000000080000001A00000DC90000002100000030000000000000000100000000000000220000000000000000000000000000000000000000000000000000000000000000"
                },
                "irpoa" =&gt; {
                    "class-name" =&gt; "org.jacorb.poa.POA",
                    "value" =&gt; "org.jacorb.poa.POA@6af31fe8"
                },
                "jaas" =&gt; {
                    "class-name" =&gt; "com.sun.proxy.$Proxy34",
                    "value" =&gt; "java:jboss/jaas/ Context proxy"
                },
                "poa" =&gt; {
                    "class-name" =&gt; "org.jacorb.poa.POA",
                    "value" =&gt; "org.jacorb.poa.POA@56d0f892"
                },
                "infinispan" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {
                        "container" =&gt; {
                            "class-name" =&gt; "javax.naming.Context",
                            "children" =&gt; {"web" =&gt; {
                                "class-name" =&gt; "org.jboss.as.clustering.infinispan.DefaultCacheContainer",
                                "value" =&gt; "web"
                            }}
                        },
                        "cache" =&gt; {
                            "class-name" =&gt; "javax.naming.Context",
                            "children" =&gt; {"web" =&gt; {
                                "class-name" =&gt; "javax.naming.Context",
                                "children" =&gt; {"repl" =&gt; {
                                    "class-name" =&gt; "org.jboss.as.clustering.infinispan.DefaultCacheContainer$DelegatingCache",
                                    "value" =&gt; "Cache 'repl'@2e3799aba350/web"
                                }}
                            }}
                        }
                    }
                },
                "datasources" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"ExampleDS" =&gt; {
                        "class-name" =&gt; "org.jboss.jca.adapters.jdbc.WrapperDataSource",
                        "value" =&gt; "org.jboss.jca.adapters.jdbc.WrapperDataSource@3c10064c"
                    }}
                },
                "mail" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"Default" =&gt; {
                        "class-name" =&gt; "javax.mail.Session",
                        "value" =&gt; "javax.mail.Session@371a1f8f"
                    }}
                }
            },
            "java:jboss/exported" =&gt; {"jms" =&gt; {
                "class-name" =&gt; "javax.naming.Context",
                "children" =&gt; {"RemoteConnectionFactory" =&gt; {
                    "class-name" =&gt; "org.hornetq.jms.client.HornetQJMSConnectionFactory",
                    "value" =&gt; "HornetQConnectionFactory [serverLocator=ServerLocatorImpl [initialConnectors=[TransportConfiguration(name=netty, factory=org-hornetq-core-remoting-impl-netty-NettyConnectorFactory) ?port=5445&amp;host=172-17-0-202], discoveryGroupConfiguration=null], clientID=null, dupsOKBatchSize=1048576, transactionBatchSize=1048576, readOnly=false]"
                }}
            }},
            "java:global" =&gt; undefined
        }
            </pre>
</div>
</div>
<br class="figure-break">
</div>
<br>
<br>
<a name="tubame_3.4.1." id="category_164"></a>
<h3 class="title">3.4.1.EJBのJNDI名移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
<a name="ejbJndiName"></a>
			JBossEAP4.3のEJBは以下のような命名規則でJNDI名にバインドされる。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>REMOTE EJB</p>
<p>EAR-MYAPP/EJB名/remote</p>
</li>
<li class="listitem">
<p>LOCAL EJB</p>
<p>EAR-MYAPP/EJB名/local</p>
</li>
</ul>
</div>
<p>
		
</p>
<p>
			JBossEAP6では、JavaEE6でJNDI名が標準化されており、app、module、globalなどのスコープ名を利用した標準化されたJNDI名となる。


			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>EJBのJNDI名</p>
<p>java:&lt;スコープ&gt;[/&lt;アプリケーション名&gt;]/&lt;モジュール名&gt;/&lt;Bean名&gt;[!&lt;完全修飾インタフェース名&gt;]
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>スコープ:app、module,global,ejbが指定可能。</p>
<p>リモートクライアントからのリモートEJB呼び出しの場合は「ejb」を利用してJNDIルックアップを行う必要がある。
							</p>
</li>
<li class="listitem">
<p>アプリケーション名:セッションBeanがearファイル内にパッケージ化されている場合にのみ必要</p>
</li>
<li class="listitem">
<p>モジュール名:セッションBeanがパッケージ化されているモジュールの名前</p>
</li>
<li class="listitem">
<p>Bean名:セッションBeanの名前</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>


			EJB自体のJNDI名の設定がJBossEAP6のjboss-ejb3.xmlでは定義できなくなっているため、jboss.xmlのsession/jndi-nameタグや、entity/jndi-nameタグで設定したJNDI名をクライアント側で参照している場合、
			プログラムや設定ファイルで指定しているJNDI名を修正する必要がある。



			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>jboss.xmlで設定されたsession/jndi-nameタグや、entity/jndi-nameタグで設定されたJNDI名を利用して、EJBをルックアップしている場合
					</p>
<div class="figure">
<a name="N16680"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossEAP6のjboss-ejb3.xmlのEJBのJNDI名設定例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							   ...
	    &lt;enterprise-beans&gt;
	        &lt;session&gt;
	            &lt;ejb-name&gt;OrzBean&lt;/ejb-name&gt;
	            &lt;!-- ★ no use in jboss-ejb3.xml
	            &lt;jndi-name&gt;OrzBean&lt;/jndi-name&gt;
	            --&gt;
	         &lt;/session&gt;
	    &lt;/enterprise-beans&gt;
   ...
  
  //modify ejb jndi-name
  //home = (OrzBeanHome) initialContext.lookup("OrzBean");
  home = (OrzBeanHome) initialContext.lookup("java:app/orz-ejb-module/OrzEJB!orz.ejb.OrzBeanHome");
  
						</pre>
</div>
</div>
<br class="figure-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>リモートEJBを呼び出す場合、EAR-MYAPP/EJB名/remoteなどのJNDI名を利用してJNDIルックアップするため、クライアント側のJNDI名の修正は必須となる。ただしIIOP対応のEJBについてはjboss-ejb3.xmlで対応可能である
						</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<p>


		
</p>
<p></p>
</div>
<br>
<br>
<a name="tubame_3.4.2." id="category_170"></a>
<h3 class="title">3.4.2.JNDIクライアント移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JavaEE6でJNDI名が標準化されており、InitailaContextインスタンスを利用してルックアップ際にしているJNDI名を変更する必要がある。
        </p>
</div>
<br>
<br>
<a name="tubame_3.4.3." id="category_171"></a>
<h3 class="title">3.4.3.JNDIクライアント(jnpプロトコル)移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossでは、JNDIを利用する場合、jnpプロトコルを利用する。

			jnpプロトコル利用の設定は以下の２つが存在する

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>
						実行時のクラスパス内に「jndi.properties」というファイルを置き、そのファイルからこれらのパラメータが読み込む方法。

						</p>
<div class="figure">
<a name="N16751"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;jndi.properties</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
java.naming.factory.url.pkgs=org.jboss.naming:org.jnp.interfaces
java.naming.provider.url=jnp://XXX.XXX.XXX.XXX:1099
							</pre>
</div>
</div>
<p>
<br class="figure-break">

					
</p>
</li>
<li class="listitem">
<p>プログラムコードで指定する方法。</p>
<div class="figure">
<a name="N1675F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;プログラムコード(jnp設定)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
Properties props = new Properties();
props.put(InitialContext.INITIAL_CONTEXT_FACTORY,"org.jnp.interfaces.NamingContextFactory");
props.put(InitialContext.URL_PKG_PREFIXES,"org.jboss.naming:org.jnp.interfaces");    
props.put(InitialContext.PROVIDER_UR,"jnp://XXX.XXX.XXX.XXX:1099");

Context ctx = new InitialContext(props);

ctx.lookup("ejb/testBean");  
						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
		
</p>
<p>

			jnpプロトコルの利用については、接続先のJBossEAPのバージョンによって修正方法が異なる。接続先がJBossEAP4及びJBossEAP5の場合は、JBossのクライアント向けに提供されるライブラリを利用することで、APIの修正は発生しない。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>接続先がJBossEAP4及びJBossEAP5の場合</p>
<p>JBossのクライアント向けに提供されるライブラリを利用することで、APIの修正は発生しない。</p>
</li>
<li class="listitem">
<p>接続先がJBossEAP6の場合</p>
<p>接続プロトコルとしてjnpは利用できないため、以下のようにAPIを修正する必要がある。</p>
<div class="figure">
<a name="N16777"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;プログラムコード</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
Properties props = new Properties();
props.put(InitialContext.PROVIDER_URL, "remote://localhost:4447");
props.put(InitialContext.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
InitialContext initialContext = new InitialContext(props);
						</pre>
</div>
</div>
<br class="figure-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>jboss-ejb-client.propertiesをクラスパスに通して、以下のように呼び出すことも可能です。
						</p>
<div class="figure">
<a name="N16784"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;プログラムコード</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
Properties props = new Properties();
props.put(InitialContext.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
InitialContext initialContext = new InitialContext(props);
							</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N1678E"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;jboss-ejb-client.properties</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default
remote.connection.default.host=localhost
remote.connection.default.port = 4447
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
							</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.5." id="category_44"></a>
<h3 class="title">3.5.HA-JNDI移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3では、クラスタワイドにJNDIでバインドされたリソースをJBossのHA-JNDI機能で提供可能としている。通常のJNDI利用時はデフォルトで1099ポートを利用するが、HA-JNDI機能利用時は、1100ポートを利用する。</p>
<pre class="programlisting">
java.naming.provider.url=server1_ip:1100,server2_ip:1100
        </pre>
</div>
<br>
<br>
<a name="tubame_3.6." id="category_46"></a>
<h3 class="title">3.6.EJB移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3
			はJ2EE1.4に準拠したアプリケーションサーバでEJBコンテナとして、EJB2.0、EJB2.1及びEJB3系が動作する。JBossEAP6でも同様に、EJB2.0、EJB2.1及びEJB3系は動作する。

		</p>
<p>
			EJBの移植については以下が発生する

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>jboss.xmlをjboss-ejb3.xmlへ移植する。詳細は<span class="command"><strong><a class="command" href="#jbossxmlPorting">jboss.xml移行</a></strong></span>を参照。</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.6.1." id="category_153"></a>
<h3 class="title">3.6.1.EJB(IIOP)移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAPの場合IIOPの実装は以下で実装できる。それぞれの移植方法について示す。

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>jboss.xmlでinvoker-proxy-binding-nameにIIOPを設定している</p>
<div class="figure">
<a name="N16619"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;jboss.xmlによるinvoker-proxy-binding-name設定例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jboss&gt;
    &lt;enterprise-beans&gt;
        &lt;session&gt;
            &lt;ejb-name&gt;ExampleIiopBean&lt;/ejb-name&gt;
            &lt;!-- if you don't specify jndi-name, ejb-name is used as jndi-name --&gt;
            &lt;!-- &lt;jndi-name&gt;ejb/Hello&lt;/jndi-name&gt; --&gt; 

            &lt;!-- IIOP Configuration --&gt;
            &lt;configuration-name&gt;Standard Stateless SessionBean&lt;/configuration-name&gt;
            &lt;invoker-bindings&gt;
                &lt;invoker&gt;
                    &lt;invoker-proxy-binding-name&gt;iiop&lt;/invoker-proxy-binding-name&gt;
                &lt;/invoker&gt;
            &lt;/invoker-bindings&gt;

        &lt;/session&gt;
    &lt;/enterprise-beans&gt;
&lt;/jboss&gt;
						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>EJBにIIOP(org.jboss.annotation.ejb.IIOP)アノテーションを設定する</p>
</li>
<li class="listitem">
<p>EJBにIIOP(org.jboss.ejb3.annotation.IIOP)アノテーションを設定する(JBossEAP5)
					</p>
<div class="figure">
<a name="N16629"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;IIOP(org.jboss.ejb3.annotation.IIOP)アノテーション設定例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							

@Stateless
@RemoteHome(ExampleIiopBeanHome.class)
@IIOP
public class ExampleIiopBean {
						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>

		
</p>
<p>
			EJBにIIOP(org.jboss.ejb3.annotation.IIOP)アノテーションを設定している(JBossEAP5)場合の移植方法を示す。

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>org.jboss.ejb3.annotation.IIOPアノテーションを削除する</p>
</li>
<li class="listitem">
<p>jboss.xmlが存在する場合はjboss-ejb3.xmlに移植し、jboss.xmlが存在しない場合はjboss-ejb3.xmlを作成し、IIOP対応のEJBにするためにassembly-descriptor設定を行う。
					</p>
<div class="figure">
<a name="N1663D"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jboss-ejb3.xmlのassembly-descriptor設定例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
               xmlns="http://java.sun.com/xml/ns/javaee"
               xmlns:iiop="urn:iiop"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                  http://java.sun.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-spec-2_0.xsd
                  urn:iiop jboss-ejb-iiop_1_0.xsd"
               version="3.1"
               impl-version="2.0"&gt;
    &lt;assembly-descriptor&gt;
        &lt;iiop:iiop&gt;
            &lt;ejb-name&gt;ExampleIiopBean&lt;/ejb-name&gt;
            &lt;iiop:binding-name&gt;iiop/ExampleIiopBean&lt;/iiop:binding-name&gt;
        &lt;/iiop:iiop&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;
						</pre>
</div>
</div>
<br class="figure-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>iiop:binding-nameについては、EJBクライアントが設定しているJNDI名を設定してください。
							EJBクライアントがEJB名(上記の場合はExampleIiopBean）でルックアップしている場合は、
							iiop:binding-nameの設定は不要です。
						</p>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_3.6.1.1." id="category_166"></a>
<h3 class="title">3.6.1.1.IIOPクライアントの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossのIIOPクライアントは、以下のようなAPI(クライアントのクラスパス上のjndi.propertiesでも対応可能)で、InitialContextを作成して、ルックアップを行うが、API観点では、移植を行う必要がない。

			</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>ただし、クライアント側のシステムプロパティcom.sun.CORBA.ORBUseDynamicStubをtrueに設定する必要があるので注意すること。
                
                </p>
<pre class="programlisting">
					
System.setProperty("com.sun.CORBA.ORBUseDynamicStub", "true");
				</pre>
<p>
				
</p>
</td>
</tr>
</table>
</div>
<p>

			
</p>
<div class="figure">
<a name="N166BE"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JBossのIIOPクライアントのInitialContext作成例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
    private static InitialContext getInitialContext() throws NamingException {
    	
    	final Properties env = new Properties();
    	// set com.sun.CORBA.ORBUseDynamicStub property
    	System.setProperty("com.sun.CORBA.ORBUseDynamicStub", "true");
        env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.cosnaming.CNCtxFactory");
        env.put(Context.PROVIDER_URL,"corbaloc:iiop:localhost:3528/JBoss/Naming/root");
        
    	InitialContext context = null;
    	try {
    		context = new InitialContext(env);
    	} catch (NamingException e) {
    		throw e;
    	}
    	return context;
    }
				</pre>
</div>
</div>
<p>
<br class="figure-break">
            
            参考:https://access.redhat.com/ja/solutions/428213
		</p>
</div>
<br>
<br>
<a name="tubame_3.7." id="category_47"></a>
<h3 class="title">3.7.JMS移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3 はJ2EE1.4に準拠したアプリケーションサーバでJMSコンテナとして動作する。
JBossEAP6の場合は、TODO:</p>
</div>
<br>
<br>
<a name="tubame_3.8." id="category_48"></a>
<h3 class="title">3.8.Webサービス移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3 はJ2EE1.4に準拠したアプリケーションサーバでWebサービス(JAX-RPC)のコンテナとして動作する。</p>
<p>JBossEAP6の場合は、TODO:</p>
</div>
<br>
<br>
<a name="tubame_3.9." id="category_55"></a>
<h3 class="title">3.9.CORBA連携移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3では、JBoss上にデプロイされたIIOP接続可能なEJBと連携可能なように、IIOPプロトコルを利用した連携が可能となっている。
		</p>
<p>
			クライアント側は、InitialContext作成時に、Context.PROVIDER_URLに「corbaloc:iiop:hostname:3528/JBoss/Naming/root」を設定して、
			InitialContextのインスタンスを作成し、JNDIルックアップする。
			JBossEAP6でも同様な方法でIIOP接続が可能だが、クライアント側は、システムプロパティcom.sun.CORBA.ORBUseDynamicStubをtrueに設定する必要がある。
			
		</p>
<p>
			なお、IIOP接続で、JBossが提供するjacorbへの依存している場合は、JBossEAP7ではjacorbが削除される可能性が高いため、注意すること

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>CORBAとの連携部分の実装がjacorbのパッケージ(org.jacorg.*)に依存している</p>
</li>
<li class="listitem">
<p>クラスパスにjacorb.propertiesを配置している</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_3.10." id="category_57"></a>
<h3 class="title">3.10.JMX移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3でJMXでMBeanの情報を監視する場合、Java標準のJMXAPI以外に、JBoss独自の方法でもMBeanの情報を取得可能となっている。
JBossEAP6の場合、JBossのRMIAdaptorは利用できないため、Java標準のJMXAPIを利用するように変更する。

<span class="command"><strong><a class="command" href="https://tomcat.apache.org/tomcat-8.0-doc/monitoring.html" target="_top">https://tomcat.apache.org/tomcat-8.0-doc/monitoring.html</a></strong></span>

   
</p>
<pre class="programlisting">
 package jp.co.ntt.oss.webg.rmi.adaptor.sample;

 import javax.management.ObjectName;
 import javax.naming.InitialContext;

 import org.jboss.jmx.adaptor.rmi.RMIAdaptor;

 public class RmiAdaptorSample {

 	public static void main(String[] args) throws Exception {
 		InitialContext ic = new InitialContext();
 		RMIAdaptor server = (RMIAdaptor) ic.lookup("jmx/invoker/RMIAdaptor");

 		String apName = (String) server.getAttribute(new ObjectName(
 				"jboss.system:type=ServerConfig"), "ServerName");

 		System.out.println("apName:" + apName);

 	}
 }
   </pre>
<p>


</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>TODO:JBossEAP6の場合は</p>
</td>
</tr>
</table>
</div>
<p>

</p>
</div>
<br>
<br>
<a name="tubame_3.11." id="category_188"></a>
<h3 class="title">3.11.JBossCache移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4及びJBossEAP5ではJBoss Cache(org.jboss.cache)が利用可能であったが、JBossEAP6では利用できない。</p>
<p>なお、JBossEAP6では、JBossEAP6本体で利用するキャシュ機能がInfinispanを利用した実装されているため、キャッシュ機能をアプリケーション側で利用する場合は、org.infinispanパッケージを
        利用して実装するが、この場合は、JBossEAP6のサブスクリプションの範囲ではサポートされない(JBoss DataGridのサブスクリプションが必須)ので、注意すること。
        
        </p>
</div>
<br>
<br>
<a name="tubame_3.12." id="category_58"></a>
<h3 class="title">3.12.デプロイメントディスクリプタ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>ここでは、JBossで利用可能なデプロイメントディスクリプタの移行方法について示す。</p>
</div>
<br>
<br>
<a name="tubame_3.12.1." id="category_59"></a>
<h3 class="title">3.12.1.web.xml移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			web.xmlの移植は以下について示す。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossWeb(catalina)のServlet移行</p>
</li>
<li class="listitem">
<p>JBossWebのServlet移行</p>
</li>
<li class="listitem">
<p>JBossWebのServletパラメータ移行</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_3.12.1.1." id="category_92"></a>
<h3 class="title">3.12.1.1.JBossWeb(catalina)のServlet移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のJBossWEBで提供されているcatalina(org.apache.catalina)のHttpServletは以下が存在する。
			
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.apache.catalina.servlets.CGIServlet</p>
</li>
<li class="listitem">
<p>org.apache.catalina.servlets.DefaultServlet</p>
</li>
<li class="listitem">
<p>org.apache.catalina.servlets.InvokerServlet</p>
</li>
<li class="listitem">
<p>org.apache.catalina.servlets.WebdavServlet</p>
</li>
<li class="listitem">
<p>org.apache.catalina.manager.host.HostManagerServlet</p>
</li>
<li class="listitem">
<p>org.apache.catalina.manager.JMXProxyServlet</p>
</li>
<li class="listitem">
<p>org.apache.catalina.manager.StatusManagerServlet</p>
</li>
</ul>
</div>
<p>

			TODO: JBossEAP6
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.1.2." id="category_94"></a>
<h3 class="title">3.12.1.2.JBossWebのServlet移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のJBossWEB(org.jboss)で提供されるServletは以下が存在する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>org.jboss.web.php.Handler</p>
<p>PHP Gatewayを可能とするSerlvet</p>
</li>
</ul>
</div>
<p>

			JBoss独自の機能となるため、移行後の環境でも、上記の機能が必要とする場合は、別途検討が必要である。
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.1.3." id="category_95"></a>
<h3 class="title">3.12.1.3.JBossWebのServletパラメータ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>web.xmlのcotext-nameでorg.jbossパッケージで指定されたパラメータが指定された場合、
JBossEAP6での代替方法を別途検討する必要がある。</p>
<p>たとえば以下のような設定があった場合、
       </p>
<pre class="programlisting">
&lt;web-app&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;org.jboss.jbossfaces.WAR_BUNDLES_JSF_IMPL&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
  &lt;/context-param&gt;
       </pre>
<p>
       
       JBossはJ2EEサーバのため、JSF実装がjboss-web.deployer/jsf-libs配下に配置されており、通常は、この実装を利用するが、WARに同梱されたJSFライブラリの実装が利用可能なように
org.jboss.jbossfaces.WAR_BUNDLES_JSF_IMPLパラメータが存在する。

       </p>
<p>JBossEAP6場合は、TODO</p>
</div>
<br>
<br>
<a name="tubame_3.12.2." id="category_60"></a>
<h3 class="title">3.12.2.jboss-web.xml移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
<a name="jboss-web-deployment-descriptor"></a>
			JBossEAP4.3のjboss-web.xmlでは以下の項目が設定可能である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Webコンテナとして一般的なWeb設定(context-root、virtual-hostタグ、use-session-cookiesタグ、resource-refタグ)</p>
</li>
<li class="listitem">
<p>JBoss独自のセキュリティ設定(security-domainタグ、jacc-star-role-allowタグ、run-as-principalタグ)</p>
</li>
<li class="listitem">
<p>JBoss独自のサービス依存性設定(dependsタグ)</p>
</li>
<li class="listitem">
<p>JBoss独自のセッションレプリケーション設定(replication-configタグ)</p>
</li>
<li class="listitem">
<p>JBoss独自クラスロード設定(class-loadingタグ)</p>
</li>
<li class="listitem">
<p>J2EEモジュール(EJB,MDB,WebService)の設定(ejb-refタグ、ejb-local-refタグ、message-destination-refタグ、message-destinationタグ、webservice-descriptionタグ)</p>
</li>
</ul>
</div>
<p>
			
			JBossEAP6の場合はTODO
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.2.1." id="category_61"></a>
<h3 class="title">3.12.2.1.Webコンテナとして一般的なWeb設定(context-root、virtual-hostタグ、use-session-cookiesタグ、resource-refタグ)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Webコンテナとして一般的なWeb設定(jboss-web.xml)についてJBossEAP6での対応方法を示す。</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>context-rootタグ</p>
<p> アプリケーションのコンテキストルートを設定。</p>
</li>
<li class="listitem">
<p>virtual-hostタグ</p>
<p>仮想ホストの設定で、JBossEAP6の場合はTODO:</p>
</li>
<li class="listitem">
<p>use-session-cookiesタグ</p>
<p>セッション管理でクッキーの利用有無が設定可能。デフォルトはtrueでクッキーを利用したセッション管理が有効である。falseにすることで
 クッキーを利用したセッション管理を実施しないように制御が可能。JBossEAP6の場合は、web.xmlのsession-configタグのtracking-modelタグにURLを設定することで、クッキーを利用したセッション管理が無効となる。
 </p>
<pre class="programlisting">
  &lt;session-config&gt;
   &lt;tracking-mode&gt;URL&lt;/tracking-mode&gt;
 &lt;/session-config&gt;
 </pre>
<p>
 
</p>
</li>
<li class="listitem">
<p>resource-refタグ、resource-env-ref-nameタグ</p>
<p>Webコンテナからのリソースリファレンス設定が可能である。
                  </p>
<pre class="programlisting">
  &lt;resource-ref&gt;
      &lt;res-ref-name&gt;jdbc/postgresDS&lt;/res-ref-name&gt;
      &lt;jndi-name&gt;java:/postgresDS&lt;/jndi-name&gt;
  &lt;/resource-ref&gt;
                  </pre>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_3.12.2.2." id="category_62"></a>
<h3 class="title">3.12.2.2.JBoss独自のセキュリティ設定(security-domainタグ、jacc-star-role-allowタグ、run-as-principalタグ)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			jboss-web.xmlのセキュリティ設定で以下の項目が設定可能である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>security-domainタグ</p>
</li>
<li class="listitem">
<p>jacc-star-role-allowタグ</p>
</li>
<li class="listitem">
<p>run-as-principalタグ</p>
</li>
</ul>
</div>
<p>
        これらの設定を利用している場合、JBossのセキュリティドメインや、JBossの認証機構を利用している可能性がある。
     業務要件からJBossEAP6のセキュリティ機能で代替可能か別途検討する必要がある。
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.2.3." id="category_63"></a>
<h3 class="title">3.12.2.3.JBoss独自のサービス依存性設定(dependsタグ)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			jboss-web.xmlのdependsタグでJBossサービスへの依存性設定が可能である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>dependsタグ</p>
<p>JBossEAP6へ移植する場合はTODO:</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.12.2.4." id="category_64"></a>
<h3 class="title">3.12.2.4.JBoss独自のセッションレプリケーション設定(replication-configタグ)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			jboss-web.xmlのreplication-configタグにより、デフォルトのWebアプリケーションのレプリケーション設定を上書き可能となっている。

			</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JBossEAP4.3のreplication-configタグの設定についてドキュメントがないため、設定値についてはJBoss EAP6の<span class="command"><strong><a class="command" href="https://access.redhat.com/documentation/ja-JP/JBoss_Enterprise_Application_Platform/6/html/Development_Guide/chap-Clustering_in_Web_Applications.html" target="_top">Clustering</a></strong></span> のドキュメントを参照。
				</p>
</td>
</tr>
</table>
</div>
<p>
            
		
</p>
<p>
		jboss-web.xmlのreplication-configタグによりレプリケーション設定を上書きしている場合、レプリケーション設定の上書き設定を行った理由を確認するとともに、JBossEAP6でのレプリケーション方式で問題ないか、別途移植検討を行う必要がある。
    JBossEAP4.3のレプリケーション方法については、<span class="command"><strong><a class="command" href="#repli-mode-setting">レプリケーションのモード設定移行</a></strong></span>を参照。
		
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.2.5." id="category_65"></a>
<h3 class="title">3.12.2.5.JBoss独自クラスロード設定(class-loadingタグ)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
<a name="JBossClassLoadSetting"></a>jboss-web.xmlでJBoss独自クラスロード設定(class-loadingタグ)と
		</p>
<p>
			class-loadingの設定がない場合、Webアプリケーション(WEBINF/lib/*.jar)より、$JBOSS_HOME/myserver/lib/配下のクラスが優先されて読みこまれる。そのため、アプリケーションで$JBOSS_HOME/myserver/libのライブラリでなく、Webアプリケーション(WEBINF/lib/*.jar)
			を先に読むために以下のようなclass-loading設定を行う場合がある。
			
			</p>
<pre class="programlisting">
&lt;jboss-web&gt;
  &lt;class-loading java2ClassLoadingCompliance="false"&gt;
   &lt;loader-repository&gt;
com.example:archive=unique-archive-name
     &lt;loader-repository-config&gt;java2ParentDelegation=false&lt;/loader-repository-config&gt;
   &lt;/loader-repository&gt;
 &lt;/class-loading&gt;
&lt;/jboss-web&gt; 
				</pre>
<p>

			
</p>
<div class="itemizedlist">
<p>参考：<span class="command"><strong><a class="command" href="https://developer.jboss.org/wiki/JbossClassLoadingUseCases" target="_top">JBoss ClassLoading</a></strong></span>
                            
</p>
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>java2ClassLoadingCompliance</p>
<p>デフォルトはtrueで、Servlet 仕様のWeb アプリケーションクラスローダを優先せず、親に委譲する(Java2
						parent delegation class loading model)
						つまり、$JBOSS_HOME/myserver/libのライブラリのクラスが先にロードされる。 Servlet 仕様通り、Web
						アプリケーションのクラスローダを優先させる場合はfalseにする必要がある。
					</p>
</li>
<li class="listitem">
<p>java2ParentDelegation</p>
<p>この設定がfalseの場合、
						JBossのクラスローダは、UnifiedLoaderRepositoryも親子関係を構成するが、親への委譲をしなくなり、
						 trueの場合は、親への委譲を行う。
					</p>
</li>
</ul>
</div>
<p>

			

		
</p>
<p>
			JBossEAP6の場合は、TODO:
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.2.6." id="category_66"></a>
<h3 class="title">3.12.2.6.J2EEモジュール(EJB,MDB,WebService)の設定(ejb-refタグ、ejb-local-refタグ、message-destination-refタグ、message-destinationタグ、webservice-descriptionタグ)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3のjboss-web.xmlで以下のタグが設定されている場合は、TODO:

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>ejb-ref</p>
</li>
<li class="listitem">
<p>ejb-local-ref</p>
</li>
<li class="listitem">
<p>message-destination-ref</p>
</li>
<li class="listitem">
<p>webservice-description</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.12.3." id="category_102"></a>
<h3 class="title">3.12.3.context.xml移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
<a name="CONTEXT_PORTING"></a>
			JBossWEBではWebアプリケーションごとにコンテキスト設定がcontext.xmlで設定可能である。

			JBossWEBのcontext設定については、
			<span class="command"><strong><a class="command" href="https://docs.jboss.org/jbossweb/2.1.x/config/context.html" target="_top">The Context Container</a></strong></span>
			を参照。

			ドキュメントでは「Nested Components」に以下の項目が存在するため、これらの設定が可能となる。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Global Resources</p>
</li>
<li class="listitem">
<p>Loader</p>
</li>
<li class="listitem">
<p>Manager</p>
</li>
<li class="listitem">
<p>Realm</p>
</li>
<li class="listitem">
<p>Resources</p>
</li>
<li class="listitem">
<p>Valve</p>
</li>
</ul>
</div>
<p>

			
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					JBossのデフォルトのコンテキスト設定は以下ファイルで設定されている。

					</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/myserver/deploy/jboss-web.deployer/context.xml
							</p>
<p>
								このcontext.xmlでは、以下設定がされている

								</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>Manager</p>
<p>セッション永続化設定の無効化設定</p>
</li>
<li class="listitem">
<p>InstanceListener</p>
<p>JBoss独自のorg.jboss.web.tomcat.security.RunAsListenerが設定されている。
								このorg.jboss.web.tomcat.security.RunAsListenerはサーブレットのライフサイクルに合わせて、Principal情報(org.jboss.security.RunAsIdentity)を登録、削除する機能を提供している。JBossのJAAS機能（JBossが提供する認証・認可機構を利用したセキュリティ機能）を利用している場合以外は、影響はない。</p>
</li>
</ul>
</div>
<p>

							
</p>
</li>
</ul>
</div>
<p>
				
</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_3.12.4." id="category_104"></a>
<h3 class="title">3.12.4.jboss.xml移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
<a name="jbossxmlPorting"></a>
			JBossではJBoss独自のデプロイメントディスクリプタとしてjboss.xmlが存在する。jboss.xmlでEJB設定を行っている場合、
			以下の手順でJBoss EAP6用のjboss-ejb3.xmlに移行を行う。


			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>デプロイメントデスクリプタのdtd宣言を削除し、jbossタグを修正する</p>
<div class="figure">
<a name="N1649B"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;修正例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
&lt;!DOCTYPE jboss PUBLIC "-//JBoss//DTD JBOSS 4.2//EN" "http://www.jboss.org/j2ee/dtd/jboss_4_2.dtd"&gt;
--&gt;

&lt;!--
&lt;jboss&gt;
--&gt;   
  
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
version="3.1" impl-version="2.0"&gt;

	
&lt;/jboss&gt;
	
						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>jboss.xmlのファイル名をjboss-ejb3.xmlにリネームする</p>
</li>
<li class="listitem">
<p>JBossEAP6ではEJBのJNDI名の命名規則(詳細は<span class="command"><strong><a class="command" href="#ejbJndiName">EJBのJNDI名の移行</a></strong></span>を参照)が変更されているため、設定変更が必要な以下のタグはJBossEAP6(javaEE6仕様の基づいた）命名規則にしたがい、JBossEAP6でバインドされるJNDI名に変更する。
					</p>
<p>
						設定値の変更が必要なタグ

						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>リソースリファレンス設定</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; ">
<li class="listitem">
<p>//enterprise-beans/session/resource-ref/jndi-name</p>
</li>
<li class="listitem">
<p>//enterprise-beans/entity/resource-ref/jndi-name</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>EJBリファレンス設定</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; ">
<li class="listitem">
<p>//enterprise-beans/entity/ejb-rej/jndi-name</p>
</li>
<li class="listitem">
<p>//enterprise-beans/session/ejb-rej/jndi-name</p>
</li>
<li class="listitem">
<p>//enterprise-beans/message-driven/ejb-rej/jndi-name
										</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>MDB</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; ">
<li class="listitem">
<p>//enterprise-beans/message-driven/destination-jndi-name
										</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>
						
						 EntityBeanのリソースリファレンス(データソース)設定(//enterprise-beans/entity/resource-ref/jndi-name)例を示す。
						</p>
<div class="figure">
<a name="N164D1"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;修正元例(jboss.xml) EntityBeanのリソースリファレンス(データソース)設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;jboss&gt;
  &lt;enterprise-beans&gt;
    &lt;entity&gt;
        &lt;ejb-name&gt;MessageEntity&lt;/ejb-name&gt;
        &lt;jndi-name&gt;ex/MessageEntity&lt;/jndi-name&gt;
        &lt;resource-ref&gt;
            &lt;res-ref-name&gt;jdbc/exampleDataSource&lt;/res-ref-name&gt;
            &lt;jndi-name&gt;exampleDataSource&lt;/jndi-name&gt;
        &lt;/resource-ref&gt;
    &lt;/entity&gt;
	        
							</pre>
</div>
</div>
<p>
<br class="figure-break">

						
</p>
<div class="figure">
<a name="N164DC"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;修正先例(jboss-ejb3.xml)　EntityBeanのリソースリファレンス(データソース)設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd" version="3.1" impl-version="2.0"&gt;
                 
  &lt;enterprise-beans&gt;
    &lt;entity&gt;
       &lt;ejb-name&gt;MessageEntity&lt;/ejb-name&gt;
       &lt;resource-ref&gt;
          &lt;res-ref-name&gt;jdbc/exampleDataSource&lt;/res-ref-name&gt;
          &lt;jndi-name&gt;java:jboss/datasources/exampleDataSource&lt;/jndi-name&gt;
        &lt;/resource-ref&gt;
    &lt;/entity&gt;
&lt;jboss&gt;
    
							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
						
						EntityBeanのリソースリファレンス(EJB)」設定(//enterprise-beans/entity/ejb-rej/jndi-name)例を示す。
						</p>
<div class="figure">
<a name="N164E7"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;修正元例(jboss.xml) EntityBeanのリソースリファレンス(EJB)設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;jboss&gt;
  &lt;enterprise-beans&gt;
    &lt;entity&gt;
      &lt;ejb-name&gt;MessageEntity&lt;/ejb-name&gt;
        &lt;ejb-ref&gt;
          &lt;ejb-ref-name&gt;ejb/otherBean&lt;/ejb-ref-name&gt;
          &lt;jndi-name&gt;otherBean&lt;/jndi-name&gt;
         &lt;/ejb-ref&gt;
    &lt;/entity&gt;
    
							</pre>
</div>
</div>
<p>
<br class="figure-break">

						
</p>
<div class="figure">
<a name="N164F2"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;修正先例(jboss-ejb3.xml)　EntityBeanのリソースリファレンス(EJB)設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd" version="3.1" impl-version="2.0"&gt;
                 
  &lt;enterprise-beans&gt;
    &lt;entity&gt;
        &lt;ejb-name&gt;MessageEntity&lt;/ejb-name&gt;
        &lt;jndi-name&gt;ex/MessageEntity&lt;/jndi-name&gt;
        &lt;ejb-ref&gt;
        	&lt;ejb-ref-name&gt;ejb/otherBean&lt;/ejb-ref-name&gt;
        	&lt;jndi-name&gt;java:app/ex-app/OtherBean!packageName.OtherBean&lt;/jndi-name&gt;
    	&lt;/ejb-ref&gt;
    &lt;/entity&gt;
&lt;jboss&gt;
    
							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
						
					
</p>
</li>
</ul>
</div>
<p>






			移植できないタグは以下設定については、デプロイメントディスクリプタでは対応できないため、別途対応を行う。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>EJBのjndi-name設定(//enterprise-beans/session/jndi-name及びenterprise-beans/entity/jndi-name)</p>
<p>EJBクライアントが//enterprise-beans/session/jndi-name及び//enterprise-beans/entity/jndi-nameで設定されたJNDI名を利用している場合は、JBossEAP6(javaEE6仕様の基づいた）命名規則にしたがい、
						クライアント側でjndiルックアップ時のjndi名を変更する
					</p>
<div class="figure">
<a name="N16504"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;修正先例(jboss-ejb3.xml)　EJBのJNDI名設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd" version="3.1" impl-version="2.0"&gt;
                 
  &lt;enterprise-beans&gt;
    &lt;session&gt;
	  &lt;ejb-name&gt;MusicLibraryEJB&lt;/ejb-name&gt;
	  &lt;!--
	  &lt;jndi-name&gt;MusicLibraryEJB.MusicLibraryHome&lt;/jndi-name&gt;
	  --&gt;
	&lt;/session&gt;
&lt;jboss&gt;


//Object home = (MusicLibraryHome) ctx.lookup("MusicLibraryEJB.MusicLibraryHome");
Object home = (MusicLibraryHome) ctx.lookup("ejb:/bands-ejb21-module/MusicLibraryEJB!examples.ejb20.relationships.bands.MusicLibraryHome");
    

							</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>コンテナ設定のcontainer-configurations(jboss/container-configurations)
					</p>
<p>container-configurationsでは、EJBのインスタンスプールのチューニングなどに利用されることが多いが、JBossEAP6では、デプロイメントディスクリプタの定義ではEJBのインスタンスプールのチューニング設定をしない。
					</p>
</li>
</ul>
</div>
<p>






		
</p>
</div>
<br>
<br>
<a name="tubame_3.12.5." id="category_105"></a>
<h3 class="title">3.12.5.j2eeクライアントデプロイメントディスクリプタ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			J2EE1.4に準拠したアプリケーションサーバでは、J2EEクライアントアプリケーションをデプロイ可能で、JBossEAP4.3の場合、以下のデプロイメントディスクリプタが利用可能である

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>application-client.xml</p>
<p>J2EE標準のクライアントアプリケーション用のデプロイメントディスクリプタ</p>
</li>
<li class="listitem">
<p>jboss-client.xml</p>
<p>JBoss独自のクライアントアプリケーション用のデプロイメントディスクリプタ</p>
</li>
</ul>
</div>
<p>

JBossEAP6の場合は、TODO
		</p>
</div>
<br>
<br>
<a name="tubame_3.12.6." id="category_150"></a>
<h3 class="title">3.12.6.jbosscmp-jdbc.xml移行</h3>
<br>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="N165D3"></a>1.&nbsp;jbosscmp-jdbc.xml</h2>
</div>
</div>
</div>
<p>
			jbosscmp-jdbc.xmlは、JBossEAP6でも利用可能なデプロイメントディスクリプタであるが、以下点について、移植する必要がある。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>//jbosscmp-jdbc/defaults/datasourceを設定している場合、JBossEAP6で登録したデータソースのJNDI名に変更する</p>
<div class="figure">
<a name="N165DC"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;修正例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                            
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE jbosscmp-jdbc PUBLIC
   "-//JBoss//DTD JBOSSCMP-JDBC 4.2//EN"
   "http://www.jboss.org/j2ee/dtd/jbosscmp-jdbc_4_2.dtd"&gt;
  &lt;jbosscmp-jdbc&gt;
    &lt;defaults&gt;
       &lt;!--
       &lt;datasource&gt;java:PostgresDS&lt;/datasource&gt;
       --&gt;
       &lt;datasource&gt;java:/jboss/datasources/PostgresDS&lt;/datasource&gt;
       &lt;datasource-mapping&gt;PostgreSQL 8.0&lt;/datasource-mapping&gt;
    &lt;/defaults&gt;
    ...
&lt;/jbosscmp-jdbc&gt;
                        </pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
			
			
			
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>jbosscmp-jdbc.xmlはJBossEAP4.3のstandardjbosscmp-jdbc.xmlファイルのオーバライドを行うが、JBossEAP6では、standardjbosscmp-jdbc.xmlファイルはjboss-as-cmp-*.jarに存在する。そのため、JBossEAP4.3でstandardjbosscmp-jdbc.xmlをチューニングしている場合は、jbosscmp-jdbc.xmlのjbosscmp-jdbc/defaultsでオーバライドを行う必要がある。
                
                </p>
<div class="figure">
<a name="N165EA"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-as-cmp-*.jarに存在するstandardjbosscmp-jdbc.xml(抜粋)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                        
&lt;jbosscmp-jdbc&gt;
    &lt;defaults&gt;
        &lt;datasource&gt;java:jboss/datasources/ExampleDS&lt;/datasource&gt;
        &lt;datasource-mapping&gt;Hypersonic SQL&lt;/datasource-mapping&gt;

        &lt;create-table&gt;true&lt;/create-table&gt;
        &lt;remove-table&gt;false&lt;/remove-table&gt;
        &lt;read-only&gt;false&lt;/read-only&gt;
        &lt;read-time-out&gt;300000&lt;/read-time-out&gt;
        &lt;row-locking&gt;false&lt;/row-locking&gt;
        &lt;pk-constraint&gt;true&lt;/pk-constraint&gt;
        &lt;fk-constraint&gt;false&lt;/fk-constraint&gt;
        &lt;preferred-relation-mapping&gt;foreign-key&lt;/preferred-relation-mapping&gt;
        &lt;read-ahead&gt;
            &lt;strategy&gt;on-load&lt;/strategy&gt;
            &lt;page-size&gt;1000&lt;/page-size&gt;
            &lt;eager-load-group&gt;*&lt;/eager-load-group&gt;
        &lt;/read-ahead&gt;
        &lt;list-cache-max&gt;1000&lt;/list-cache-max&gt;
        &lt;clean-read-ahead-on-load&gt;false&lt;/clean-read-ahead-on-load&gt;

        &lt;unknown-pk&gt;
            &lt;key-generator-factory&gt;UUIDKeyGeneratorFactory&lt;/key-generator-factory&gt;
            &lt;unknown-pk-class&gt;java.lang.String&lt;/unknown-pk-class&gt;
            &lt;jdbc-type&gt;VARCHAR&lt;/jdbc-type&gt;
            &lt;sql-type&gt;VARCHAR(32)&lt;/sql-type&gt;
        &lt;/unknown-pk&gt;

        &lt;entity-command name="default"/&gt;
        &lt;ql-compiler&gt;org.jboss.as.cmp.jdbc.JDBCEJBQLCompiler&lt;/ql-compiler&gt;
        &lt;throw-runtime-exceptions&gt;false&lt;/throw-runtime-exceptions&gt;
    &lt;/defaults&gt;
    ...
&lt;/jbosscmp-jdbc&gt;
                    </pre>
</div>
</div>
<p>
<br class="figure-break">
                
</p>
</td>
</tr>
</table>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.13." id="category_50"></a>
<h3 class="title">3.13.デプロイメント移行</h3>
<br>
<br>
<a name="tubame_3.13.1." id="category_51"></a>
<h3 class="title">3.13.1.Web ARchive(WAR)移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP4.3は、Web
			ARchive(WAR)形式をデプロイできる。JBossEAP6でも同様にWAR形式はデプロイ可能だが、
			context.xmlは、JBossEAP6では利用できないため、移植を行う必要がある。
		</p>
<pre class="programlisting">
[xxx].war
|-- META-INF/
      | -- MANIFEST.MF
|-- WEB-INF/
      |-- jboss-web.xml *1
      |-- context.xml *2
      |-- web.xml
|-- lib/
      |--foo.jar
      |-- bar.jar
      
		</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>jboss-web.xml</p>
<p>jboss-web.xmlについては、<span class="command"><strong><a class="command" href="#jboss-web-deployment-descriptor">jboss-web.xml移行</a></strong></span>を参照。</p>
</li>
<li class="listitem">
<p>context.xml</p>
<p>context.xmlについては、TODO<span class="command"><strong><a class="command" href="#CONTEXT_PORTING">context.xml移行</a></strong></span>を参照</p>
</li>
<li class="listitem">
<p>web.xml</p>
<p>web.xmlでcontext-param等によりJBoss独自のパラメータ設定を行っている場合、JBossEAP6に移植可能か調査する必要がある</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_3.13.2." id="category_52"></a>
<h3 class="title">3.13.2.Enterprise ARchive(EAR)移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>アプリケーションがJ2EEサーバ上でデプロイ可能なEnterprise
			ARchive(EAR)形式を利用している場合、JBossEAP4.3及びJBossEAP6では
			デプロイ可能だが、jboss-appはTODO
		</p>
<pre class="programlisting">
[xxx].ear
|-- META-INF/
|   |-- MANIFEST.MF		
|   |-- application.xml
|   |-- jboss-app.xml
|-- test.war
|-- ejb.jar
|-- lib/			
	|-- foo.jar
	|-- bar.jar
		</pre>
</div>
<br>
<br>
<a name="tubame_3.13.3." id="category_53"></a>
<h3 class="title">3.13.3.Resource Adapter aRchive(RAR)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Resource Adapter aRchive(RAR) の略で、JBossEAP4.3及びJBossEAP6（J2EEサーバ）ではリソースアダプタが利用可能だが、RARを業務アプリケーションで作成し、JBossEAP4.3上にデプロイし利用している場合、TODO
  </p>
<pre class="programlisting">
  [xxx].rar
  |-- META-INF/
  |   |-- MANIFEST.MF		
  |   |-- ra.xml
  |-- foo.jar
  
  </pre>
</div>
<br>
<br>
<a name="tubame_3.13.4." id="category_54"></a>
<h3 class="title">3.13.4.Service ARchive(SAR)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBosEAP4.3ではMBeanをJBoss独自のSAR（Service ARchive）としてデプロイ可能である。
JBossEAP6ではTODO。</p>
<p>JBoss MBeanサービスの利用例としては、org.jboss.varia.scheduler.Schedulerを利用したスケジュールサービスが
あるが、JBossEAP6では、TODO</p>
<pre class="programlisting">
[xxx].sar
|-- META-INF/
|   |-- MANIFEST.MF		
|   |-- jboss-service.xml
|-- test.war
|-- ejb.jar
</pre>
</div>
<br>
<br>
<a name="tubame_3.14." id="category_168"></a>
<h3 class="title">3.14.アプリケーションの参照ライブラリの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>ここでは、アプリケーションで参照しているライブラリ(JBossが提供するライブラリでなく、アプリケーションが業務用に個別に準備しているライブラリ）が
			デプロイメント内に存在せず、$JBOSS_HOME/libや$JBOSS_HOME/myserver/libに配置している場合の移植方法について示す。
		</p>
<p>アプリケーションで参照しているライブラリは、JBossのモジュールとして登録して、対応する。</p>
<p>本例では、hogehogeutil-1.0-SNAPSHOT.jarをhoge.hoge.utilとしてモジュールに登録し、アプリケーションから参照できるようにアプリケーション内の
			jboss-deployment-structure.xmlでhoge.hoge.utilへの依存性を設定する方法を示す。



		</p>
<p>

			
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>hoge.hoge.utilモジュール登録例</p>
<div class="orderedlist">
<ol class="orderedlist" type="a">
<li class="listitem">
<p>module.xmlを作成する。</p>
<div class="figure">
<a name="N166E3"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;module.xml</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
									
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;module xmlns="urn:jboss:module:1.1" name="hoge.hoge.util"&gt;
    &lt;resources&gt;
        &lt;resource-root path="hogehogeutil-1.0-SNAPSHOT.jar"/&gt;
    &lt;/resources&gt;
&lt;/module&gt;
								</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>JBossのモジュールとして認識されるように、JBOSS_HOME/modules/配下に配置する。</p>
<p>
								
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>$JBOSS_HOME/modules/配下にmodule.xmlのnameで設定した階層のフォルダを作成する
										</p>
</li>
<li class="listitem">
<p>作成したフォルダにモジュールとして登録するjarとmodule.xmlを配置する</p>
<div class="figure">
<a name="N166F9"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;モジュールディレクトリ構成</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
												
$JBOSS_HOME/modules/hoge/hoge/util/
                                |- module.xml
                                |- hogehogeutil-1.0-SNAPSHOT.jar
											</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
							
</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>jboss-deployment-structure.xmlの依存性設定例</p>
<p>モジュールを参照するWEBアプリケーション側は、依存性解決するために、
						jboss-deployment-structure.xmlを作成し、dependenciesに参照するモジュール名を指定する。

					</p>
<div class="figure">
<a name="N16709"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jboss-deployment-structure.xml設定例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
 &lt;jboss-deployment-structure xmlns="urn:jboss:deployment-structure:1.2"&gt;
	&lt;deployment&gt;
		&lt;dependencies&gt;
		    &lt;module name="hoge.hoge.util" /&gt;
		&lt;/dependencies&gt;
	&lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;
						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
            
            
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>jboss-deployment-structure.xmlは、WARの場合は、WEB-INF配下にjboss-deployment-structure.xmlを配置する。EARの場合は、META-INF配下に配置する。</p>
</td>
</tr>
</table>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.15." id="category_56"></a>
<h3 class="title">3.15.アプリケーションロギング移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossEAP4.3ではサーバのロギング実装として、Log4jライブラリを利用しており、アプリケーションログでもLog4jを利用している場合が多い。

			Log4j設定としては、以下の2つが存在する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Log4jの設定をアプリケーション内で完結させる方法(Log4jを利用してアプリケーション専用ログにロギイングを行う)</p>
</li>
<li class="listitem">
<p>Log4jの設定をJBossのログ出力設定にマージする方法</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_3.15.1." id="category_165"></a>
<h3 class="title">3.15.1.Log4jの設定をアプリケーション内で完結させる方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Log4jの設定をアプリケーション内で完結させる方法(Log4jを利用してアプリケーション専用ログにロギイングを行う)について示す。
		</p>
<p>
			EARアプリケーションでの対応を示す。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossEAP4.3では$JBOSS_HOME/myserver/libにlog4jのライブラリが配置されており、
EARアプリケーションがlog4jのライブラリを保持せず、EAR内に同梱しているlog4jの設定ファイルを利用して、アプリケーション専用のログ出力が可能である。</p>
<pre class="programlisting">
 EAR
  |-example.war
        ※war内のclassesフォルダ配下にlog4j.xmlやlog4.propertiesが配置。
  |-example.jar(ejb)
  META-INF
     | -application.xml
					</pre>
<p>JBossEAP6では、JBossのモジュールとしてlog4jライブラリ(JBOSS_HOME/modules/system/layers/base/org/apache/log4j)が登録されており、上記のEARの構成の場合、設定変更(jboss-deployment-structure.xmlによる明示的な依存関係の設定）は必要なく、JBossEAP6上でもアプリケーション専用のログ出力が可能である。</p>
</li>
</ul>
</div>
<p>




		
</p>
</div>
<br>
<br>
</BODY>
</HTML>
